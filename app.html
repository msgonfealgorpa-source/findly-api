<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Findly Sage Ultimate - AI Shopping Intelligence</title>
    <meta name="description" content="Findly Sage - Revolutionary AI-powered shopping intelligence platform">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ═══════════════════════════════════════════════════════════════
           FINDLY SAGE ULTIMATE - REVOLUTIONARY DESIGN SYSTEM
           Version 6.0 - World-Class Shopping Intelligence
        ═══════════════════════════════════════════════════════════════ */

        /* ═══ ROOT VARIABLES ═══ */
        :root {
            /* Primary Palette */
            --primary-50: #eef2ff;
            --primary-100: #e0e7ff;
            --primary-200: #c7d2fe;
            --primary-300: #a5b4fc;
            --primary-400: #818cf8;
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --primary-700: #4338ca;
            --primary-800: #3730a3;
            --primary-900: #312e81;

            /* Accent Colors */
            --accent-cyan: #06b6d4;
            --accent-emerald: #10b981;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-violet: #8b5cf6;
            --accent-sky: #0ea5e9;

            /* Neutral Scale */
            --neutral-50: #fafafa;
            --neutral-100: #f4f4f5;
            --neutral-200: #e4e4e7;
            --neutral-300: #d4d4d8;
            --neutral-400: #a1a1aa;
            --neutral-500: #71717a;
            --neutral-600: #52525b;
            --neutral-700: #3f3f46;
            --neutral-800: #27272a;
            --neutral-900: #18181b;
            --neutral-950: #09090b;

            /* Semantic Colors */
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;

            /* Dark Theme (Default) */
            --bg-canvas: #030712;
            --bg-surface: #0f172a;
            --bg-elevated: #1e293b;
            --bg-card: rgba(30, 41, 59, 0.7);
            --bg-glass: rgba(255, 255, 255, 0.03);
            --bg-glass-hover: rgba(255, 255, 255, 0.06);

            --border-subtle: rgba(255, 255, 255, 0.05);
            --border-default: rgba(255, 255, 255, 0.1);
            --border-emphasis: rgba(255, 255, 255, 0.15);
            --border-glow: rgba(99, 102, 241, 0.4);

            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --text-muted: #64748b;
            --text-inverse: #0f172a;

            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --gradient-secondary: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-mesh: radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                            radial-gradient(at 80% 0%, rgba(139, 92, 246, 0.1) 0px, transparent 50%),
                            radial-gradient(at 0% 50%, rgba(6, 182, 212, 0.1) 0px, transparent 50%),
                            radial-gradient(at 80% 50%, rgba(236, 72, 153, 0.08) 0px, transparent 50%),
                            radial-gradient(at 0% 100%, rgba(99, 102, 241, 0.1) 0px, transparent 50%);
            --gradient-noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");

            /* Shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 40px -10px rgba(99, 102, 241, 0.5);
            --shadow-glow-lg: 0 0 60px -15px rgba(99, 102, 241, 0.6);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);

            /* Border Radius */
            --radius-xs: 4px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --radius-3xl: 32px;
            --radius-full: 9999px;

            /* Spacing */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;
            --space-16: 64px;

            /* Typography */
            --font-sans: 'IBM Plex Sans Arabic', 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-display: 'Space Grotesk', 'IBM Plex Sans Arabic', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: 500ms cubic-bezier(0.34, 1.56, 0.64, 1);

            /* Z-Index Scale */
            --z-dropdown: 100;
            --z-sticky: 200;
            --z-fixed: 300;
            --z-modal-backdrop: 400;
            --z-modal: 500;
            --z-popover: 600;
            --z-tooltip: 700;
            --z-toast: 800;
        }

        /* ═══ LIGHT THEME ═══ */
        .light-mode {
            --bg-canvas: #f8fafc;
            --bg-surface: #ffffff;
            --bg-elevated: #f1f5f9;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-glass: rgba(0, 0, 0, 0.02);
            --bg-glass-hover: rgba(0, 0, 0, 0.04);

            --border-subtle: rgba(0, 0, 0, 0.04);
            --border-default: rgba(0, 0, 0, 0.08);
            --border-emphasis: rgba(0, 0, 0, 0.12);

            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
            --text-inverse: #f8fafc;
        }

        /* ═══ RESET & BASE ═══ */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        body {
            font-family: var(--font-sans);
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-canvas);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Background Effects */
        .bg-effects {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        .bg-mesh {
            position: absolute;
            inset: 0;
            background: var(--gradient-mesh);
            opacity: 0.8;
        }

        .bg-noise {
            position: absolute;
            inset: 0;
            background: var(--gradient-noise);
            opacity: 0.5;
        }

        .bg-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 64px 64px;
            mask-image: radial-gradient(ellipse 80% 60% at 50% 0%, black 40%, transparent 100%);
            -webkit-mask-image: radial-gradient(ellipse 80% 60% at 50% 0%, black 40%, transparent 100%);
        }

        .bg-orbs {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: var(--primary-500);
            top: -200px;
            left: 20%;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 300px;
            height: 300px;
            background: var(--accent-violet);
            top: 30%;
            right: -100px;
            animation-delay: -7s;
        }

        .orb-3 {
            width: 350px;
            height: 350px;
            background: var(--accent-cyan);
            bottom: -150px;
            left: 10%;
            animation-delay: -14s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* ═══ TYPOGRAPHY ═══ */
        .text-gradient {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .text-glow {
            text-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        /* ═══ HEADER ═══ */
        .header {
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            padding: var(--space-4) var(--space-6);
            background: rgba(3, 7, 18, 0.8);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--border-subtle);
        }

        .light-mode .header {
            background: rgba(248, 250, 252, 0.9);
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-6);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .brand-logo {
            width: 44px;
            height: 44px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }

        .brand-logo::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.2) 50%, transparent 60%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-tagline {
            font-size: 0.7rem;
            color: var(--text-muted);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        /* Icon Button */
        .btn-icon {
            width: 42px;
            height: 42px;
            border-radius: var(--radius-lg);
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: all var(--transition-fast);
            position: relative;
        }

        .btn-icon:hover {
            background: var(--bg-glass-hover);
            border-color: var(--border-default);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .btn-icon:active {
            transform: translateY(0);
        }

        .btn-icon .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-canvas);
        }

        /* Language Dropdown */
        .dropdown-wrapper {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 180px;
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all var(--transition-fast);
            z-index: var(--z-dropdown);
            overflow: hidden;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .dropdown-item {
            padding: var(--space-3) var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            transition: background var(--transition-fast);
            border-bottom: 1px solid var(--border-subtle);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--bg-glass-hover);
        }

        .dropdown-item .flag {
            font-size: 1.25rem;
        }

        .dropdown-item .lang-name {
            flex: 1;
        }

        /* ═══ MAIN CONTENT ═══ */
        .main-content {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-12) var(--space-6);
        }

        /* ═══ HERO SECTION ═══ */
        .hero {
            text-align: center;
            margin-bottom: var(--space-12);
        }

        .energy-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-full);
            margin-bottom: var(--space-6);
            font-size: 0.875rem;
        }

        .energy-badge i {
            color: #fbbf24;
        }

        .energy-badge .count {
            background: var(--gradient-primary);
            color: white;
            padding: 2px 10px;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.8rem;
        }

        .greeting {
            font-size: 1.125rem;
            color: var(--primary-400);
            font-weight: 600;
            margin-bottom: var(--space-2);
        }

        .hero-title {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: var(--space-4);
            letter-spacing: -1px;
        }

        .hero-title .line {
            display: block;
        }

        .hero-title .highlight {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .hero-subtitle {
            font-size: 1.125rem;
            color: var(--text-tertiary);
            max-width: 500px;
            margin: 0 auto var(--space-8);
            line-height: 1.7;
        }

        /* ═══ SEARCH SECTION ═══ */
        .search-section {
            max-width: 700px;
            margin: 0 auto var(--space-10);
        }

        .ai-toggle {
            display: inline-flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-5);
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-full);
            margin-bottom: var(--space-5);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .ai-toggle:hover {
            border-color: var(--primary-400);
            background: rgba(99, 102, 241, 0.05);
        }

        .ai-toggle i {
            color: var(--primary-400);
            font-size: 1.1rem;
        }

        .ai-toggle span {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .ai-toggle input[type="checkbox"] {
            width: 44px;
            height: 24px;
            appearance: none;
            background: var(--bg-elevated);
            border-radius: var(--radius-full);
            position: relative;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .ai-toggle input[type="checkbox"]::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: var(--text-muted);
            border-radius: 50%;
            transition: all var(--transition-fast);
        }

        .ai-toggle input[type="checkbox"]:checked {
            background: var(--primary-500);
        }

        .ai-toggle input[type="checkbox"]:checked::before {
            transform: translateX(20px);
            background: white;
        }

        .search-container {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--space-5) var(--space-8);
            padding-right: 70px;
            padding-left: 65px;
            font-family: inherit;
            font-size: 1.125rem;
            background: var(--bg-card);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-2xl);
            color: var(--text-primary);
            text-align: center;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-400);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15), var(--shadow-glow);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .voice-btn {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.25rem;
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            color: var(--primary-400);
            background: rgba(99, 102, 241, 0.1);
        }

        .voice-btn.recording {
            color: var(--danger);
            animation: pulse-ring 1.5s infinite;
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .search-btn {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-xl);
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: var(--shadow-glow);
        }

        .search-btn:active {
            transform: translateY(-50%) scale(0.98);
        }

        /* Quick Filters */
        .quick-filters {
            display: flex;
            justify-content: center;
            gap: var(--space-3);
            flex-wrap: wrap;
            margin-top: var(--space-5);
        }

        .filter-chip {
            padding: var(--space-2) var(--space-4);
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            color: var(--text-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            transition: all var(--transition-fast);
        }

        .filter-chip:hover {
            background: var(--bg-glass-hover);
            border-color: var(--primary-400);
            color: var(--primary-400);
            transform: translateY(-2px);
        }

        .filter-chip i {
            font-size: 0.9rem;
        }

        /* ═══ CATEGORIES ═══ */
        .categories {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: var(--space-3);
            margin-bottom: var(--space-10);
        }

        .category-card {
            padding: var(--space-5) var(--space-3);
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .category-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-400);
            box-shadow: var(--shadow-glow);
        }

        .category-card:hover::before {
            opacity: 0.05;
        }

        .category-card i {
            font-size: 1.75rem;
            color: var(--primary-400);
            margin-bottom: var(--space-2);
            position: relative;
            z-index: 1;
        }

        .category-card span {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            display: block;
            position: relative;
            z-index: 1;
        }

        /* ═══ INVITE CARD ═══ */
        .invite-card {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-6);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.08));
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: var(--space-8);
        }

        .invite-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary-400);
            box-shadow: var(--shadow-glow);
        }

        .invite-card .icon {
            font-size: 1.5rem;
        }

        .invite-card .text {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ═══ RESULTS SECTION ═══ */
        .results-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }

        /* ═══ PRODUCT CARD - REVOLUTIONARY DESIGN ═══ */
        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-2xl);
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: cardEnter 0.5s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .product-card:nth-child(1) { animation-delay: 0.1s; }
        .product-card:nth-child(2) { animation-delay: 0.2s; }
        .product-card:nth-child(3) { animation-delay: 0.3s; }
        .product-card:nth-child(4) { animation-delay: 0.4s; }
        .product-card:nth-child(5) { animation-delay: 0.5s; }

        @keyframes cardEnter {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-card:hover {
            border-color: var(--border-default);
        }

        .product-header {
            display: flex;
            gap: var(--space-5);
            padding: var(--space-6);
        }

        .product-image-wrapper {
            flex-shrink: 0;
            width: 200px;
            height: 200px;
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            position: relative;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: var(--space-3);
            transition: transform var(--transition-normal);
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badge {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            padding: var(--space-1) var(--space-2);
            background: var(--gradient-success);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            border-radius: var(--radius-md);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .product-title {
            font-size: 1.15rem;
            font-weight: 600;
            line-height: 1.5;
            margin-bottom: var(--space-3);
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-pricing {
            display: flex;
            align-items: baseline;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .current-price {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--success);
        }

        .old-price {
            font-size: 1rem;
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .discount-badge {
            padding: var(--space-1) var(--space-2);
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: var(--radius-md);
        }

        /* ═══ VERDICT SECTION ═══ */
        .verdict-section {
            padding: var(--space-4) var(--space-6);
            background: var(--bg-glass);
            border-top: 1px solid var(--border-subtle);
            border-bottom: 1px solid var(--border-subtle);
        }

        .verdict-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }

        .verdict-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .verdict-icon.buy {
            background: rgba(16, 185, 129, 0.15);
        }

        .verdict-icon.wait {
            background: rgba(245, 158, 11, 0.15);
        }

        .verdict-icon.avoid {
            background: rgba(239, 68, 68, 0.15);
        }

        .verdict-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .verdict-title.buy { color: var(--success); }
        .verdict-title.wait { color: var(--warning); }
        .verdict-title.avoid { color: var(--danger); }

        .verdict-reason {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* ═══ INTELLIGENCE GRID ═══ */
        .intel-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-3);
            padding: var(--space-5) var(--space-6);
        }

        .intel-item {
            padding: var(--space-4);
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .intel-item .icon {
            font-size: 1.25rem;
            margin-bottom: var(--space-2);
        }

        .intel-item .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-1);
        }

        .intel-item .value {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .intel-item .value.good { color: var(--success); }
        .intel-item .value.warning { color: var(--warning); }
        .intel-item .value.danger { color: var(--danger); }

        /* ═══ PROGRESS BAR ═══ */
        .progress-section {
            padding: var(--space-4) var(--space-6);
            border-top: 1px solid var(--border-subtle);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .progress-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .progress-value {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary-400);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-elevated);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
        }

        .progress-fill.high { background: var(--gradient-success); }
        .progress-fill.medium { background: var(--gradient-warning); }
        .progress-fill.low { background: var(--gradient-danger); }

        /* ═══ ANALYSIS PANEL ═══ */
        .analysis-panel {
            padding: var(--space-5) var(--space-6);
            background: var(--bg-glass);
            border-top: 1px solid var(--border-subtle);
        }

        .analysis-title {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-400);
            margin-bottom: var(--space-4);
        }

        .analysis-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        .metric-card {
            padding: var(--space-4);
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
        }

        .metric-card .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: var(--space-2);
        }

        .metric-card .metric-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            font-size: 0.75rem;
            margin-top: var(--space-1);
        }

        .metric-trend.up { color: var(--success); }
        .metric-trend.down { color: var(--danger); }
        .metric-trend.stable { color: var(--text-muted); }

        /* ═══ ACTION BUTTONS ═══ */
        .action-buttons {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-5) var(--space-6);
        }

        .btn {
            flex: 1;
            padding: var(--space-4) var(--space-5);
            border-radius: var(--radius-xl);
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            text-decoration: none;
            transition: all var(--transition-fast);
            border: none;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--bg-glass);
            border: 1px solid var(--border-default);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            border-color: var(--primary-400);
            color: var(--primary-400);
        }

        .btn-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .btn-warning:hover {
            background: var(--warning);
            color: white;
        }

        /* ═══ COUPON SECTION ═══ */
        .coupon-section {
            padding: var(--space-4) var(--space-6);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border-top: 1px solid var(--border-subtle);
        }

        .coupon-card {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-3);
            background: var(--bg-card);
            border: 1px dashed var(--success);
            border-radius: var(--radius-lg);
        }

        .coupon-code {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--success);
            letter-spacing: 1px;
        }

        .coupon-discount {
            padding: var(--space-1) var(--space-2);
            background: var(--success);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: var(--radius-md);
        }

        .coupon-copy {
            margin-right: auto;
            padding: var(--space-2) var(--space-3);
            background: var(--success);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .coupon-copy:hover {
            filter: brightness(1.1);
        }

        /* ═══ CHAT BUBBLE ═══ */
        .chat-bubble {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            width: 64px;
            height: 64px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg), var(--shadow-glow);
            z-index: var(--z-fixed);
            transition: all var(--transition-fast);
        }

        .chat-bubble:hover {
            transform: scale(1.1);
        }

        .chat-bubble .unread-dot {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid var(--primary-500);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ═══ CHAT WINDOW ═══ */
        .chat-window {
            position: fixed;
            bottom: calc(64px + var(--space-6));
            right: var(--space-6);
            width: 400px;
            max-width: calc(100vw - var(--space-12));
            height: 550px;
            max-height: calc(100vh - 150px);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-2xl);
            display: none;
            flex-direction: column;
            box-shadow: var(--shadow-2xl);
            z-index: var(--z-fixed);
            overflow: hidden;
        }

        .chat-window.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chat-header {
            padding: var(--space-5);
            background: var(--gradient-primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .chat-avatar {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .chat-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .chat-status .dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity var(--transition-fast);
        }

        .chat-close:hover {
            opacity: 1;
        }

        .chat-messages {
            flex: 1;
            padding: var(--space-5);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .message {
            max-width: 85%;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-xl);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .message.bot {
            background: var(--bg-elevated);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-sm);
        }

        .message.user {
            background: var(--gradient-primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-sm);
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        .chat-input-area {
            padding: var(--space-4);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            gap: var(--space-3);
        }

        .chat-input {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            transition: all var(--transition-fast);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        .chat-send {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-send:hover {
            transform: scale(1.05);
        }

        /* ═══ AUTH OVERLAY ═══ */
        .auth-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-canvas);
            z-index: var(--z-modal-backdrop);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-6);
        }

        .auth-overlay.hidden {
            display: none;
        }

        .auth-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-2xl);
            padding: var(--space-10);
            width: 100%;
            max-width: 440px;
            text-align: center;
            box-shadow: var(--shadow-2xl);
        }

        .auth-logo {
            width: 72px;
            height: 72px;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-4);
            font-size: 2rem;
            color: white;
            box-shadow: var(--shadow-glow);
        }

        .auth-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--space-2);
        }

        .auth-subtitle {
            color: var(--text-muted);
            margin-bottom: var(--space-8);
        }

        .auth-input {
            width: 100%;
            padding: var(--space-4);
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            margin-bottom: var(--space-3);
            transition: all var(--transition-fast);
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        .auth-buttons {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-5);
        }

        .auth-buttons .btn {
            flex: 1;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin: var(--space-6) 0;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-subtle);
        }

        .google-btn {
            width: 100%;
            padding: var(--space-4);
            background: white;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-inverse);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            transition: all var(--transition-fast);
        }

        .google-btn:hover {
            background: var(--neutral-50);
            transform: translateY(-2px);
        }

        .auth-links {
            margin-top: var(--space-8);
            font-size: 0.85rem;
        }

        .auth-links a {
            color: var(--text-muted);
            text-decoration: none;
            margin: 0 var(--space-2);
            transition: color var(--transition-fast);
        }

        .auth-links a:hover {
            color: var(--primary-400);
        }

        /* ═══ MODALS ═══ */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal-backdrop);
            padding: var(--space-6);
        }

        .modal-backdrop.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            width: 100%;
            max-width: 480px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalEnter 0.3s ease;
        }

        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }

        .modal-header i {
            font-size: 1.5rem;
            color: var(--primary-400);
        }

        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-body {
            margin-bottom: var(--space-6);
        }

        .modal-footer {
            display: flex;
            gap: var(--space-3);
        }

        /* ═══ UPGRADE SECTION ═══ */
        .upgrade-section {
            background: var(--bg-card);
            border: 2px solid var(--danger);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            text-align: center;
            margin: var(--space-8) auto;
            max-width: 500px;
        }

        .upgrade-icon {
            width: 72px;
            height: 72px;
            background: rgba(239, 68, 68, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-4);
            font-size: 2rem;
        }

        .upgrade-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger);
            margin-bottom: var(--space-3);
        }

        .upgrade-text {
            color: var(--text-secondary);
            margin-bottom: var(--space-6);
        }

        .upgrade-btn {
            background: var(--gradient-primary);
            color: white;
            padding: var(--space-4) var(--space-8);
            border: none;
            border-radius: var(--radius-full);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        /* ═══ LOADING STATE ═══ */
        .loading-container {
            text-align: center;
            padding: var(--space-12);
        }

        .loading-spinner {
            width: 56px;
            height: 56px;
            border: 3px solid var(--border-subtle);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-4);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-muted);
        }

        /* ═══ STATUS MESSAGE ═══ */
        .status-message {
            padding: var(--space-4) var(--space-5);
            border-radius: var(--radius-xl);
            font-weight: 500;
            margin: var(--space-4) 0;
        }

        .status-message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }

        .status-message.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        .status-message.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: var(--info);
        }

        /* ═══ FOOTER ═══ */
        .footer {
            text-align: center;
            padding: var(--space-8) var(--space-6);
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-subtle);
            margin-top: var(--space-12);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--space-6);
            margin-bottom: var(--space-4);
        }

        .footer-links a {
            color: var(--text-tertiary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        .footer-links a:hover {
            color: var(--primary-400);
        }

        /* ═══ RESPONSIVE DESIGN ═══ */
        @media (max-width: 1024px) {
            .product-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .product-image-wrapper {
                width: 180px;
                height: 180px;
            }

            .intel-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .analysis-metrics {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: var(--space-3) var(--space-4);
            }

            .brand-tagline {
                display: none;
            }

            .main-content {
                padding: var(--space-6) var(--space-4);
            }

            .hero-title {
                font-size: 2rem;
            }

            .search-input {
                padding: var(--space-4) var(--space-6);
                padding-right: 55px;
                padding-left: 55px;
                font-size: 1rem;
            }

            .voice-btn {
                right: 12px;
                width: 38px;
                height: 38px;
            }

            .search-btn {
                width: 42px;
                height: 42px;
                left: 6px;
            }

            .categories {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--space-2);
            }

            .category-card {
                padding: var(--space-4) var(--space-2);
            }

            .category-card i {
                font-size: 1.4rem;
            }

            .product-image-wrapper {
                width: 150px;
                height: 150px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .intel-grid {
                grid-template-columns: repeat(2, 1fr);
                padding: var(--space-4);
            }

            .chat-window {
                right: var(--space-4);
                bottom: calc(56px + var(--space-4));
                width: calc(100vw - var(--space-8));
            }

            .chat-bubble {
                right: var(--space-4);
                bottom: var(--space-4);
                width: 56px;
                height: 56px;
            }
        }

        @media (max-width: 480px) {
            .categories {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-chip {
                justify-content: center;
            }

            .intel-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ═══ ACCESSIBILITY ═══ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        *:focus-visible {
            outline: 2px solid var(--primary-400);
            outline-offset: 2px;
        }

        /* Selection */
        ::selection {
            background: rgba(99, 102, 241, 0.3);
            color: var(--text-primary);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-elevated);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-default);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-emphasis);
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="bg-mesh"></div>
        <div class="bg-orbs">
            <div class="orb orb-1"></div>
            <div class="orb orb-2"></div>
            <div class="orb orb-3"></div>
        </div>
        <div class="bg-grid"></div>
        <div class="bg-noise"></div>
    </div>

    <!-- Chat Bubble -->
    <div class="chat-bubble" onclick="toggleChat()">
        <i class="fas fa-comments"></i>
        <span class="unread-dot"></span>
    </div>

    <!-- Chat Window -->
    <div class="chat-window" id="chat-window">
        <div class="chat-header">
            <div class="chat-header-content">
                <div class="chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <div class="chat-title">Findly AI Assistant</div>
                    <div class="chat-status">
                        <span class="dot"></span>
                        <span id="chat-status-text">متصل الآن</span>
                    </div>
                </div>
            </div>
            <button class="chat-close" onclick="toggleChat()">&times;</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="message bot">
                مرحباً! 👋 أنا Findly Sage، مساعدك الذكي للتسوق. كيف يمكنني مساعدتك اليوم؟
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chat-input" placeholder="اكتب رسالتك..." onkeypress="handleChatKey(event)">
            <button class="chat-send" onclick="sendChatMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Auth Overlay -->
    <div class="auth-overlay" id="auth-overlay" style="display: none;">
        <div class="auth-card">
            <div class="auth-logo">
                <i class="fas fa-wand-magic-sparkles"></i>
            </div>
            <h1 class="auth-title text-gradient">Findly Sage</h1>
            <p class="auth-subtitle" id="auth-subtitle">سجل دخولك لتبدأ البحث الذكي</p>
            <input type="email" class="auth-input" id="auth-email" placeholder="البريد الإلكتروني">
            <input type="password" class="auth-input" id="auth-password" placeholder="كلمة المرور">
            <div class="auth-buttons">
                <button class="btn btn-primary" onclick="handleLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    <span id="auth-login-text">تسجيل دخول</span>
                </button>
                <button class="btn btn-secondary" onclick="handleRegister()">
                    <i class="fas fa-user-plus"></i>
                    <span id="auth-register-text">إنشاء حساب</span>
                </button>
            </div>
            <div class="auth-divider">
                <span id="auth-or-text">أو</span>
            </div>
            <button class="google-btn" onclick="loginWithGoogle()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="20">
                <span id="auth-google-text">متابعة بـ Google</span>
            </button>
            <div class="auth-links">
                <a href="#" id="auth-privacy">سياسة الخصوصية</a>
                <a href="#" id="auth-terms">الشروط</a>
                <a href="#" id="auth-about">من نحن</a>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-backdrop" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-user-cog"></i>
                <h3 id="profile-title">الملف الشخصي</h3>
            </div>
            <div class="modal-body">
                <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: var(--space-2);" id="profile-name-label">الاسم</label>
                <input type="text" class="auth-input" id="profile-name-input" placeholder="أدخل اسمك">
                <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin: var(--space-4) 0 var(--space-2);" id="profile-budget-label">الميزانية ($)</label>
                <input type="number" class="auth-input" id="profile-budget-input" placeholder="أقصى ميزانية">
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" style="flex: 2;" onclick="saveProfile()">
                    <i class="fas fa-check"></i>
                    <span id="profile-save-text">حفظ التغييرات</span>
                </button>
                <button class="btn btn-secondary" onclick="closeModal('profile-modal')">
                    <span id="profile-close-text">إغلاق</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Watchlist Modal -->
    <div class="modal-backdrop" id="watchlist-modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-bell"></i>
                <h3 id="watchlist-title">قائمة المراقبة</h3>
            </div>
            <div class="modal-body" id="watchlist-content">
                <p style="color: var(--text-muted); text-align: center; padding: var(--space-8);">
                    لا توجد منتجات في القائمة
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="width: 100%;" onclick="closeModal('watchlist-modal')">
                    <span id="watchlist-close-text">إغلاق</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <div class="brand">
                <div class="brand-logo">
                    <i class="fas fa-wand-magic-sparkles"></i>
                </div>
                <div class="brand-text">
                    <div class="brand-name">Findly Sage</div>
                    <div class="brand-tagline" id="brand-tagline">AI Shopping Intelligence</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-icon" onclick="toggleTheme()" title="تبديل المظهر">
                    <i class="fas fa-circle-half-stroke"></i>
                </button>
                <div class="dropdown-wrapper">
                    <button class="btn-icon" onclick="toggleLangMenu()" title="اللغة">
                        <i class="fas fa-globe"></i>
                    </button>
                    <div class="dropdown-menu" id="lang-menu">
                        <div class="dropdown-item" onclick="setLang('ar')">
                            <span class="flag">🇸🇦</span>
                            <span class="lang-name">العربية</span>
                        </div>
                        <div class="dropdown-item" onclick="setLang('en')">
                            <span class="flag">🇺🇸</span>
                            <span class="lang-name">English</span>
                        </div>
                        <div class="dropdown-item" onclick="setLang('fr')">
                            <span class="flag">🇫🇷</span>
                            <span class="lang-name">Français</span>
                        </div>
                        <div class="dropdown-item" onclick="setLang('de')">
                            <span class="flag">🇩🇪</span>
                            <span class="lang-name">Deutsch</span>
                        </div>
                        <div class="dropdown-item" onclick="setLang('es')">
                            <span class="flag">🇪🇸</span>
                            <span class="lang-name">Español</span>
                        </div>
                        <div class="dropdown-item" onclick="setLang('tr')">
                            <span class="flag">🇹🇷</span>
                            <span class="lang-name">Türkçe</span>
                        </div>
                    </div>
                </div>
                <button class="btn-icon" onclick="openWatchlist()" title="قائمة المراقبة">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="watch-badge" style="display: none;">0</span>
                </button>
                <button class="btn-icon" onclick="openProfile()" title="الملف الشخصي">
                    <i class="fas fa-user-circle"></i>
                </button>
                <button class="btn-icon" onclick="logout()" title="تسجيل الخروج">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero">
            <div class="energy-badge">
                <i class="fas fa-bolt"></i>
                <span id="energy-label">طاقة البحث:</span>
                <span class="count" id="energy-count">∞</span>
            </div>
            <p class="greeting" id="greeting-text">مرحباً، أيها الباحث</p>
            <h1 class="hero-title">
                <span class="line" id="hero-line1">مستشارك الذكي</span>
                <span class="line"><span class="highlight" id="hero-line2">للتسوق الذكي</span></span>
            </h1>
            <p class="hero-subtitle" id="hero-subtitle">اكتشف أفضل المنتجات والأسعار بمساعدة الذكاء الاصطناعي المتقدم</p>
        </section>

        <!-- Search Section -->
        <section class="search-section">
            <div class="ai-toggle" onclick="toggleAiMode()">
                <i class="fas fa-brain"></i>
                <span id="ai-mode-label">وضع التحليل العميق</span>
                <input type="checkbox" id="ai-mode-checkbox">
            </div>
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="ابحث عن أي منتج..." onkeypress="handleSearchKey(event)">
                <button class="voice-btn" id="voice-btn" onclick="startVoice()">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="search-btn" onclick="performSearch()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="quick-filters">
                <div class="filter-chip" onclick="quickFilter('cheap')">
                    <i class="fas fa-tags"></i>
                    <span id="filter-cheap">الأقل سعراً</span>
                </div>
                <div class="filter-chip" onclick="quickFilter('top')">
                    <i class="fas fa-star"></i>
                    <span id="filter-top">الأعلى تقييماً</span>
                </div>
                <div class="filter-chip" onclick="quickFilter('new')">
                    <i class="fas fa-fire"></i>
                    <span id="filter-new">الأحدث</span>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section class="categories">
            <div class="category-card" onclick="quickSearch('ألعاب')">
                <i class="fas fa-gamepad"></i>
                <span id="cat-games">ألعاب</span>
            </div>
            <div class="category-card" onclick="quickSearch('جمال')">
                <i class="fas fa-spa"></i>
                <span id="cat-beauty">جمال</span>
            </div>
            <div class="category-card" onclick="quickSearch('منزل ذكي')">
                <i class="fas fa-home"></i>
                <span id="cat-home">منزل</span>
            </div>
            <div class="category-card" onclick="quickSearch('هواتف')">
                <i class="fas fa-mobile-alt"></i>
                <span id="cat-phones">هواتف</span>
            </div>
            <div class="category-card" onclick="quickSearch('لابتوب')">
                <i class="fas fa-laptop"></i>
                <span id="cat-laptops">لابتوب</span>
            </div>
            <div class="category-card" onclick="quickSearch('ساعات')">
                <i class="fas fa-clock"></i>
                <span id="cat-watches">ساعات</span>
            </div>
        </section>

        <!-- Invite Card -->
        <div class="invite-card" onclick="copyInviteLink()">
            <span class="icon">🚀</span>
            <span class="text" id="invite-text">ادعُ أصدقاءك الآن - مكافآت قادمة قريباً!</span>
        </div>

        <!-- Status Container -->
        <div id="status-container"></div>

        <!-- Results Container -->
        <div class="results-container" id="results"></div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-links">
            <a href="#" id="footer-privacy">سياسة الخصوصية</a>
            <a href="#" id="footer-terms">شروط الاستخدام</a>
            <a href="#" id="footer-about">من نحن</a>
        </div>
        <p>© 2024 Findly Sage. جميع الحقوق محفوظة.</p>
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCI_q5lkgRY4133ua4RlG5TeiCqJ5N5KTU",
            authDomain: "findly-ede17.firebaseapp.com",
            projectId: "findly-ede17",
            storageBucket: "findly-ede17.firebasestorage.app",
            messagingSenderId: "503212830017",
            appId: "1:503212830017:web:9afb64c19822bbe7f645c0",
            measurementId: "G-X1Q3WDP50N"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        window.auth = auth;
        window.provider = provider;

        onAuthStateChanged(auth, (user) => {
            const overlay = document.getElementById('auth-overlay');
            if (user) {
                overlay.classList.add('hidden');
                localStorage.setItem('findly_uid', user.uid);
                if (user.displayName) {
                    localStorage.setItem('fn', user.displayName);
                    updateGreeting();
                }
            } else {
                overlay.classList.remove('hidden');
            }
        });

        window.loginWithGoogle = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        };

        window.handleLogin = async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            if (!email || !password) {
                alert(getT('fillFields'));
                return;
            }
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        };

        window.handleRegister = async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            if (!email || !password) {
                alert(getT('fillFields'));
                return;
            }
            if (password.length < 6) {
                alert(getT('weakPassword'));
                return;
            }
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                alert(getT('registerSuccess'));
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        };

        window.logout = () => {
            if (confirm(getT('logoutConfirm'))) {
                signOut(auth);
            }
        };
    </script>

    <script>
        // ═══════════════════════════════════════════════════════════════
        // FINDLY SAGE ULTIMATE - APPLICATION LOGIC
        // ═══════════════════════════════════════════════════════════════

        // Configuration
        const API_BASE = 'https://findly-api-production.up.railway.app';

        // State
        let currentLang = localStorage.getItem('findly_lang') || 'ar';
        let aiModeEnabled = false;

        // ═══ TRANSLATIONS ═══
        const translations = {
            ar: {
                energyLabel: 'طاقة البحث:',
                greeting: 'مرحباً،',
                seeker: 'أيها الباحث',
                heroLine1: 'مستشارك الذكي',
                heroLine2: 'للتسوق الذكي',
                heroSubtitle: 'اكتشف أفضل المنتجات والأسعار بمساعدة الذكاء الاصطناعي المتقدم',
                aiModeLabel: 'وضع التحليل العميق',
                searchPlaceholder: 'ابحث عن أي منتج...',
                filterCheap: 'الأقل سعراً',
                filterTop: 'الأعلى تقييماً',
                filterNew: 'الأحدث',
                catGames: 'ألعاب',
                catBeauty: 'جمال',
                catHome: 'منزل',
                catPhones: 'هواتف',
                catLaptops: 'لابتوب',
                catWatches: 'ساعات',
                inviteText: 'ادعُ أصدقاءك الآن - مكافآت قادمة قريباً!',
                buy: 'شراء الآن',
                watch: 'راقب السعر',
                analyze: 'تحليل متقدم',
                loading: 'جاري البحث...',
                noResults: 'لا توجد نتائج',
                error: 'حدث خطأ، حاول مرة أخرى',
                copied: 'تم نسخ رابط الدعوة!',
                saved: 'تم الحفظ!',
                watchlistEmpty: 'لا توجد منتجات في القائمة',
                watchlistAdded: 'تمت الإضافة لقائمة المراقبة!',
                fillFields: 'الرجاء إدخال البريد وكلمة المرور',
                weakPassword: 'كلمة المرور يجب أن تكون 6 أحرف على الأقل',
                registerSuccess: 'تم إنشاء الحساب بنجاح!',
                logoutConfirm: 'هل تريد تسجيل الخروج؟',
                // Product Card
                price: 'السعر',
                timing: 'التوقيت',
                confidence: 'الثقة',
                analysis: 'التحليل',
                excellent: 'ممتاز',
                good: 'جيد',
                high: 'مرتفع',
                willDrop: 'سينخفض',
                willRise: 'سيرتفع',
                stable: 'مستقر',
                personalized: 'مخصص',
                general: 'عام',
                // Verdicts
                greatDeal: 'صفقة ممتازة!',
                goodDeal: 'صفقة جيدة',
                fairPrice: 'سعر عادل',
                waitBit: 'انتظر قليلاً',
                overpriced: 'سعر مرتفع',
                greatDealReason: 'السعر ممتاز والوقت مناسب للشراء',
                waitReason: 'السعر قد ينخفض قريباً',
                overpricedReason: 'يوجد خيارات أفضل بسعر أقل',
                // Modals
                profileTitle: 'الملف الشخصي',
                profileNameLabel: 'الاسم',
                profileBudgetLabel: 'الميزانية ($)',
                profileSave: 'حفظ التغييرات',
                profileClose: 'إغلاق',
                watchlistTitle: 'قائمة المراقبة',
                watchlistClose: 'إغلاق',
                // Auth
                authSubtitle: 'سجل دخولك لتبدأ البحث الذكي',
                authLogin: 'تسجيل دخول',
                authRegister: 'إنشاء حساب',
                authOr: 'أو',
                authGoogle: 'متابعة بـ Google',
                authPrivacy: 'سياسة الخصوصية',
                authTerms: 'الشروط',
                authAbout: 'من نحن',
                // Analysis
                market: 'السوق',
                avgPrice: 'متوسط السعر',
                competitors: 'المنافسين',
                dealScore: 'نقاط الصفقة',
                forecast: 'التوقعات',
                trend: 'الاتجاه',
                expectedPrice: 'السعر المتوقع',
                valueForMoney: 'القيمة مقابل السعر',
                savings: 'التوفير المحتمل',
                bestStore: 'أفضل متجر',
                // Upgrade
                upgradeTitle: 'انتهت المحاولات المجانية',
                upgradeText: 'لقد استخدمت جميع عمليات البحث المجانية. قم بالترقية للمتابعة.',
                upgradeBtn: 'ترقية الآن',
                paymentUnavailable: 'خدمة الدفع غير متاحة حالياً',
                paymentError: 'خطأ في خدمة الدفع',
                // Chat
                chatConnected: 'متصل الآن',
                chatPlaceholder: 'اكتب رسالتك...',
                chatError: 'حدث خطأ في الاتصال',
                chatDefaultReply: '🤔 عذراً، لم أفهم. حاول مرة أخرى.',
                // Voice
                voiceNotSupported: 'متصفحك لا يدعم البحث الصوتي'
            },
            en: {
                energyLabel: 'Search Energy:',
                greeting: 'Hello,',
                seeker: 'Seeker',
                heroLine1: 'Your Smart Advisor',
                heroLine2: 'for Smart Shopping',
                heroSubtitle: 'Discover the best products and prices with advanced AI assistance',
                aiModeLabel: 'Deep Analysis Mode',
                searchPlaceholder: 'Search for any product...',
                filterCheap: 'Lowest Price',
                filterTop: 'Top Rated',
                filterNew: 'Newest',
                catGames: 'Games',
                catBeauty: 'Beauty',
                catHome: 'Home',
                catPhones: 'Phones',
                catLaptops: 'Laptops',
                catWatches: 'Watches',
                inviteText: 'Invite friends now - Rewards coming soon!',
                buy: 'Buy Now',
                watch: 'Watch Price',
                analyze: 'Advanced Analysis',
                loading: 'Searching...',
                noResults: 'No results found',
                error: 'An error occurred, please try again',
                copied: 'Invite link copied!',
                saved: 'Saved!',
                watchlistEmpty: 'No products in the list',
                watchlistAdded: 'Added to watchlist!',
                fillFields: 'Please enter email and password',
                weakPassword: 'Password must be at least 6 characters',
                registerSuccess: 'Account created successfully!',
                logoutConfirm: 'Do you want to logout?',
                price: 'Price',
                timing: 'Timing',
                confidence: 'Confidence',
                analysis: 'Analysis',
                excellent: 'Excellent',
                good: 'Good',
                high: 'High',
                willDrop: 'Will Drop',
                willRise: 'Will Rise',
                stable: 'Stable',
                personalized: 'Personalized',
                general: 'General',
                greatDeal: 'Great Deal!',
                goodDeal: 'Good Deal',
                fairPrice: 'Fair Price',
                waitBit: 'Wait a Bit',
                overpriced: 'Overpriced',
                greatDealReason: 'Excellent price, good time to buy',
                waitReason: 'Price might drop soon',
                overpricedReason: 'Better options available at lower prices',
                profileTitle: 'Profile',
                profileNameLabel: 'Name',
                profileBudgetLabel: 'Budget ($)',
                profileSave: 'Save Changes',
                profileClose: 'Close',
                watchlistTitle: 'Watchlist',
                watchlistClose: 'Close',
                authSubtitle: 'Sign in to start smart search',
                authLogin: 'Sign In',
                authRegister: 'Sign Up',
                authOr: 'or',
                authGoogle: 'Continue with Google',
                authPrivacy: 'Privacy Policy',
                authTerms: 'Terms',
                authAbout: 'About',
                market: 'Market',
                avgPrice: 'Average Price',
                competitors: 'Competitors',
                dealScore: 'Deal Score',
                forecast: 'Forecast',
                trend: 'Trend',
                expectedPrice: 'Expected Price',
                valueForMoney: 'Value for Money',
                savings: 'Potential Savings',
                bestStore: 'Best Store',
                upgradeTitle: 'Free Searches Exhausted',
                upgradeText: 'You have used all free searches. Upgrade to continue.',
                upgradeBtn: 'Upgrade Now',
                paymentUnavailable: 'Payment service unavailable',
                paymentError: 'Payment service error',
                chatConnected: 'Online',
                chatPlaceholder: 'Type your message...',
                chatError: 'Connection error',
                chatDefaultReply: "🤔 Sorry, I didn't understand. Try again.",
                voiceNotSupported: 'Your browser does not support voice search'
            },
            fr: {
                energyLabel: 'Énergie:',
                greeting: 'Bonjour,',
                seeker: 'Chercheur',
                heroLine1: 'Votre Conseiller',
                heroLine2: 'Shopping Intelligent',
                heroSubtitle: 'Découvrez les meilleurs produits avec l\'IA',
                aiModeLabel: 'Mode Analyse Profonde',
                searchPlaceholder: 'Rechercher un produit...',
                filterCheap: 'Moins Cher',
                filterTop: 'Mieux Notés',
                filterNew: 'Nouveautés',
                catGames: 'Jeux',
                catBeauty: 'Beauté',
                catHome: 'Maison',
                catPhones: 'Téléphones',
                catLaptops: 'Ordinateurs',
                catWatches: 'Montres',
                inviteText: 'Invitez vos amis - Récompenses à venir!',
                buy: 'Acheter',
                watch: 'Surveiller',
                analyze: 'Analyse',
                loading: 'Recherche...',
                noResults: 'Aucun résultat',
                error: 'Erreur, réessayez',
                copied: 'Lien copié!',
                saved: 'Enregistré!',
                watchlistEmpty: 'Liste vide',
                watchlistAdded: 'Ajouté!',
                fillFields: 'Veuillez remplir les champs',
                weakPassword: 'Mot de passe trop court',
                registerSuccess: 'Compte créé!',
                logoutConfirm: 'Déconnexion?',
                price: 'Prix',
                timing: 'Timing',
                confidence: 'Confiance',
                analysis: 'Analyse',
                excellent: 'Excellent',
                good: 'Bon',
                high: 'Élevé',
                willDrop: 'Baisse',
                willRise: 'Hausse',
                stable: 'Stable',
                personalized: 'Personnalisé',
                general: 'Général',
                greatDeal: 'Super Affaire!',
                goodDeal: 'Bonne Affaire',
                fairPrice: 'Prix Juste',
                waitBit: 'Attendez',
                overpriced: 'Trop Cher',
                greatDealReason: 'Prix excellent, bon moment',
                waitReason: 'Le prix peut baisser',
                overpricedReason: 'Meilleures options disponibles',
                profileTitle: 'Profil',
                profileNameLabel: 'Nom',
                profileBudgetLabel: 'Budget ($)',
                profileSave: 'Enregistrer',
                profileClose: 'Fermer',
                watchlistTitle: 'Liste de Surveillance',
                watchlistClose: 'Fermer',
                authSubtitle: 'Connectez-vous',
                authLogin: 'Connexion',
                authRegister: 'Inscription',
                authOr: 'ou',
                authGoogle: 'Continuer avec Google',
                authPrivacy: 'Confidentialité',
                authTerms: 'Conditions',
                authAbout: 'À propos',
                market: 'Marché',
                avgPrice: 'Prix Moyen',
                competitors: 'Concurrents',
                dealScore: 'Score',
                forecast: 'Prévision',
                trend: 'Tendance',
                expectedPrice: 'Prix Attendu',
                valueForMoney: 'Rapport Qualité/Prix',
                savings: 'Économies',
                bestStore: 'Meilleur Magasin',
                upgradeTitle: 'Recherches Épuisées',
                upgradeText: 'Passez à la version supérieure',
                upgradeBtn: 'Mettre à Niveau',
                paymentUnavailable: 'Paiement indisponible',
                paymentError: 'Erreur de paiement',
                chatConnected: 'En ligne',
                chatPlaceholder: 'Écrivez...',
                chatError: 'Erreur de connexion',
                chatDefaultReply: '🤔 Désolé, réessayez.',
                voiceNotSupported: 'Recherche vocale non supportée'
            },
            de: {
                energyLabel: 'Energie:',
                greeting: 'Hallo,',
                seeker: 'Sucher',
                heroLine1: 'Ihr Berater',
                heroLine2: 'Smartes Shopping',
                heroSubtitle: 'Entdecken Sie die besten Produkte mit KI',
                aiModeLabel: 'Tiefenanalyse',
                searchPlaceholder: 'Produkt suchen...',
                filterCheap: 'Günstigste',
                filterTop: 'Bestbewertet',
                filterNew: 'Neueste',
                catGames: 'Spiele',
                catBeauty: 'Schönheit',
                catHome: 'Heim',
                catPhones: 'Handys',
                catLaptops: 'Laptops',
                catWatches: 'Uhren',
                inviteText: 'Freunde einladen - Belohnungen kommen!',
                buy: 'Kaufen',
                watch: 'Beobachten',
                analyze: 'Analyse',
                loading: 'Suche...',
                noResults: 'Keine Ergebnisse',
                error: 'Fehler, versuchen Sie erneut',
                copied: 'Link kopiert!',
                saved: 'Gespeichert!',
                watchlistEmpty: 'Liste leer',
                watchlistAdded: 'Hinzugefügt!',
                fillFields: 'Bitte füllen Sie alle Felder',
                weakPassword: 'Passwort zu kurz',
                registerSuccess: 'Konto erstellt!',
                logoutConfirm: 'Abmelden?',
                price: 'Preis',
                timing: 'Zeitpunkt',
                confidence: 'Vertrauen',
                analysis: 'Analyse',
                excellent: 'Ausgezeichnet',
                good: 'Gut',
                high: 'Hoch',
                willDrop: 'Fallen',
                willRise: 'Steigen',
                stable: 'Stabil',
                personalized: 'Personalisiert',
                general: 'Allgemein',
                greatDeal: 'Toller Deal!',
                goodDeal: 'Guter Deal',
                fairPrice: 'Fairer Preis',
                waitBit: 'Warten',
                overpriced: 'Überteuert',
                greatDealReason: 'Ausgezeichneter Preis',
                waitReason: 'Preis könnte sinken',
                overpricedReason: 'Bessere Optionen verfügbar',
                profileTitle: 'Profil',
                profileNameLabel: 'Name',
                profileBudgetLabel: 'Budget ($)',
                profileSave: 'Speichern',
                profileClose: 'Schließen',
                watchlistTitle: 'Beobachtungsliste',
                watchlistClose: 'Schließen',
                authSubtitle: 'Anmelden',
                authLogin: 'Anmelden',
                authRegister: 'Registrieren',
                authOr: 'oder',
                authGoogle: 'Mit Google fortfahren',
                authPrivacy: 'Datenschutz',
                authTerms: 'AGB',
                authAbout: 'Über uns',
                market: 'Markt',
                avgPrice: 'Durchschnittspreis',
                competitors: 'Wettbewerber',
                dealScore: 'Deal-Score',
                forecast: 'Prognose',
                trend: 'Trend',
                expectedPrice: 'Erwarteter Preis',
                valueForMoney: 'Preis-Leistung',
                savings: 'Ersparnis',
                bestStore: 'Bester Shop',
                upgradeTitle: 'Kostenlose Suchen aufgebraucht',
                upgradeText: 'Upgraden Sie für mehr',
                upgradeBtn: 'Jetzt Upgraden',
                paymentUnavailable: 'Zahlung nicht verfügbar',
                paymentError: 'Zahlungsfehler',
                chatConnected: 'Online',
                chatPlaceholder: 'Nachricht schreiben...',
                chatError: 'Verbindungsfehler',
                chatDefaultReply: '🤔 Entschuldigung, versuchen Sie erneut.',
                voiceNotSupported: 'Sprachsuche nicht unterstützt'
            },
            es: {
                energyLabel: 'Energía:',
                greeting: 'Hola,',
                seeker: 'Buscador',
                heroLine1: 'Tu Asesor',
                heroLine2: 'Compras Inteligentes',
                heroSubtitle: 'Descubre los mejores productos con IA',
                aiModeLabel: 'Modo Análisis Profundo',
                searchPlaceholder: 'Buscar producto...',
                filterCheap: 'Más Barato',
                filterTop: 'Mejor Valorados',
                filterNew: 'Más Nuevos',
                catGames: 'Juegos',
                catBeauty: 'Belleza',
                catHome: 'Hogar',
                catPhones: 'Teléfonos',
                catLaptops: 'Portátiles',
                catWatches: 'Relojes',
                inviteText: 'Invita amigos - ¡Recompensas pronto!',
                buy: 'Comprar',
                watch: 'Vigilar',
                analyze: 'Análisis',
                loading: 'Buscando...',
                noResults: 'Sin resultados',
                error: 'Error, intenta de nuevo',
                copied: '¡Enlace copiado!',
                saved: '¡Guardado!',
                watchlistEmpty: 'Lista vacía',
                watchlistAdded: '¡Añadido!',
                fillFields: 'Complete todos los campos',
                weakPassword: 'Contraseña muy corta',
                registerSuccess: '¡Cuenta creada!',
                logoutConfirm: '¿Cerrar sesión?',
                price: 'Precio',
                timing: 'Momento',
                confidence: 'Confianza',
                analysis: 'Análisis',
                excellent: 'Excelente',
                good: 'Bueno',
                high: 'Alto',
                willDrop: 'Bajará',
                willRise: 'Subirá',
                stable: 'Estable',
                personalized: 'Personalizado',
                general: 'General',
                greatDeal: '¡Gran Oferta!',
                goodDeal: 'Buena Oferta',
                fairPrice: 'Precio Justo',
                waitBit: 'Espera',
                overpriced: 'Caro',
                greatDealReason: 'Excelente precio',
                waitReason: 'El precio puede bajar',
                overpricedReason: 'Mejores opciones disponibles',
                profileTitle: 'Perfil',
                profileNameLabel: 'Nombre',
                profileBudgetLabel: 'Presupuesto ($)',
                profileSave: 'Guardar',
                profileClose: 'Cerrar',
                watchlistTitle: 'Lista de Seguimiento',
                watchlistClose: 'Cerrar',
                authSubtitle: 'Iniciar sesión',
                authLogin: 'Entrar',
                authRegister: 'Registrarse',
                authOr: 'o',
                authGoogle: 'Continuar con Google',
                authPrivacy: 'Privacidad',
                authTerms: 'Términos',
                authAbout: 'Acerca de',
                market: 'Mercado',
                avgPrice: 'Precio Medio',
                competitors: 'Competidores',
                dealScore: 'Puntuación',
                forecast: 'Pronóstico',
                trend: 'Tendencia',
                expectedPrice: 'Precio Esperado',
                valueForMoney: 'Relación Calidad-Precio',
                savings: 'Ahorro',
                bestStore: 'Mejor Tienda',
                upgradeTitle: 'Búsquedas Agotadas',
                upgradeText: 'Actualiza para continuar',
                upgradeBtn: 'Actualizar',
                paymentUnavailable: 'Pago no disponible',
                paymentError: 'Error de pago',
                chatConnected: 'En línea',
                chatPlaceholder: 'Escribe tu mensaje...',
                chatError: 'Error de conexión',
                chatDefaultReply: '🤔 Lo siento, intenta de nuevo.',
                voiceNotSupported: 'Búsqueda por voz no soportada'
            },
            tr: {
                energyLabel: 'Enerji:',
                greeting: 'Merhaba,',
                seeker: 'Aranan',
                heroLine1: 'Akıllı Danışmanınız',
                heroLine2: 'Akıllı Alışveriş',
                heroSubtitle: 'AI ile en iyi ürünleri keşfedin',
                aiModeLabel: 'Derin Analiz Modu',
                searchPlaceholder: 'Ürün ara...',
                filterCheap: 'En Ucuz',
                filterTop: 'En Çok Beğenilen',
                filterNew: 'En Yeni',
                catGames: 'Oyunlar',
                catBeauty: 'Güzellik',
                catHome: 'Ev',
                catPhones: 'Telefonlar',
                catLaptops: 'Dizüstü',
                catWatches: 'Saatler',
                inviteText: 'Arkadaşlarını davet et - Ödüller geliyor!',
                buy: 'Satın Al',
                watch: 'İzle',
                analyze: 'Analiz',
                loading: 'Aranıyor...',
                noResults: 'Sonuç bulunamadı',
                error: 'Hata, tekrar deneyin',
                copied: 'Link kopyalandı!',
                saved: 'Kaydedildi!',
                watchlistEmpty: 'Liste boş',
                watchlistAdded: 'Eklendi!',
                fillFields: 'Tüm alanları doldurun',
                weakPassword: 'Şifre çok kısa',
                registerSuccess: 'Hesap oluşturuldu!',
                logoutConfirm: 'Çıkış yapmak istiyor musunuz?',
                price: 'Fiyat',
                timing: 'Zamanlama',
                confidence: 'Güven',
                analysis: 'Analiz',
                excellent: 'Mükemmel',
                good: 'İyi',
                high: 'Yüksek',
                willDrop: 'Düşecek',
                willRise: 'Yükselecek',
                stable: 'Kararlı',
                personalized: 'Kişisel',
                general: 'Genel',
                greatDeal: 'Harika Fırsat!',
                goodDeal: 'İyi Fırsat',
                fairPrice: 'Adil Fiyat',
                waitBit: 'Bekleyin',
                overpriced: 'Pahalı',
                greatDealReason: 'Mükemmel fiyat',
                waitReason: 'Fiyat düşebilir',
                overpricedReason: 'Daha iyi seçenekler var',
                profileTitle: 'Profil',
                profileNameLabel: 'İsim',
                profileBudgetLabel: 'Bütçe ($)',
                profileSave: 'Kaydet',
                profileClose: 'Kapat',
                watchlistTitle: 'İzleme Listesi',
                watchlistClose: 'Kapat',
                authSubtitle: 'Giriş yapın',
                authLogin: 'Giriş',
                authRegister: 'Kayıt',
                authOr: 'veya',
                authGoogle: 'Google ile devam',
                authPrivacy: 'Gizlilik',
                authTerms: 'Şartlar',
                authAbout: 'Hakkında',
                market: 'Pazar',
                avgPrice: 'Ortalama Fiyat',
                competitors: 'Rakipler',
                dealScore: 'Fırsat Puanı',
                forecast: 'Tahmin',
                trend: 'Trend',
                expectedPrice: 'Beklenen Fiyat',
                valueForMoney: 'Fiyat/Performans',
                savings: 'Tasarruf',
                bestStore: 'En İyi Mağaza',
                upgradeTitle: 'Ücretsiz Aramalar Tükendi',
                upgradeText: 'Devam etmek için yükseltin',
                upgradeBtn: 'Yükselt',
                paymentUnavailable: 'Ödeme mevcut değil',
                paymentError: 'Ödeme hatası',
                chatConnected: 'Çevrimiçi',
                chatPlaceholder: 'Mesajınızı yazın...',
                chatError: 'Bağlantı hatası',
                chatDefaultReply: '🤔 Üzgünüm, tekrar deneyin.',
                voiceNotSupported: 'Sesli arama desteklenmiyor'
            }
        };

        function getT(key) {
            return translations[currentLang]?.[key] || translations.ar[key] || key;
        }

        function updateUI() {
            // Update all text elements
            document.getElementById('energy-label').textContent = getT('energyLabel');
            document.getElementById('hero-line1').textContent = getT('heroLine1');
            document.getElementById('hero-line2').textContent = getT('heroLine2');
            document.getElementById('hero-subtitle').textContent = getT('heroSubtitle');
            document.getElementById('ai-mode-label').textContent = getT('aiModeLabel');
            document.getElementById('search-input').placeholder = getT('searchPlaceholder');
            document.getElementById('filter-cheap').textContent = getT('filterCheap');
            document.getElementById('filter-top').textContent = getT('filterTop');
            document.getElementById('filter-new').textContent = getT('filterNew');
            document.getElementById('cat-games').textContent = getT('catGames');
            document.getElementById('cat-beauty').textContent = getT('catBeauty');
            document.getElementById('cat-home').textContent = getT('catHome');
            document.getElementById('cat-phones').textContent = getT('catPhones');
            document.getElementById('cat-laptops').textContent = getT('catLaptops');
            document.getElementById('cat-watches').textContent = getT('catWatches');
            document.getElementById('invite-text').textContent = getT('inviteText');
            document.getElementById('auth-subtitle').textContent = getT('authSubtitle');
            document.getElementById('auth-login-text').textContent = getT('authLogin');
            document.getElementById('auth-register-text').textContent = getT('authRegister');
            document.getElementById('auth-or-text').textContent = getT('authOr');
            document.getElementById('auth-google-text').textContent = getT('authGoogle');
            document.getElementById('auth-privacy').textContent = getT('authPrivacy');
            document.getElementById('auth-terms').textContent = getT('authTerms');
            document.getElementById('auth-about').textContent = getT('authAbout');
            document.getElementById('profile-title').textContent = getT('profileTitle');
            document.getElementById('profile-name-label').textContent = getT('profileNameLabel');
            document.getElementById('profile-budget-label').textContent = getT('profileBudgetLabel');
            document.getElementById('profile-save-text').textContent = getT('profileSave');
            document.getElementById('profile-close-text').textContent = getT('profileClose');
            document.getElementById('watchlist-title').textContent = getT('watchlistTitle');
            document.getElementById('watchlist-close-text').textContent = getT('watchlistClose');
            document.getElementById('footer-privacy').textContent = getT('authPrivacy');
            document.getElementById('footer-terms').textContent = getT('authTerms');
            document.getElementById('footer-about').textContent = getT('authAbout');
            document.getElementById('chat-status-text').textContent = getT('chatConnected');
            document.getElementById('chat-input').placeholder = getT('chatPlaceholder');

            // Update HTML direction
            document.getElementById('main-html').lang = currentLang;
            document.getElementById('main-html').dir = currentLang === 'ar' ? 'rtl' : 'ltr';

            updateGreeting();
        }

        function updateGreeting() {
            const name = localStorage.getItem('fn') || getT('seeker');
            document.getElementById('greeting-text').textContent = getT('greeting') + ' ' + name;
        }

        // ═══ THEME ═══
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        }

        // ═══ LANGUAGE ═══
        function toggleLangMenu() {
            document.getElementById('lang-menu').classList.toggle('active');
        }

        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('findly_lang', lang);
            toggleLangMenu();
            updateUI();
        }

        // ═══ AI MODE ═══
        function toggleAiMode() {
            aiModeEnabled = !aiModeEnabled;
            document.getElementById('ai-mode-checkbox').checked = aiModeEnabled;
        }

        // ═══ SEARCH ═══
        function handleSearchKey(e) {
            if (e.key === 'Enter') performSearch();
        }

        async function performSearch() {
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;

            const container = document.getElementById('status-container');
            const resultsBox = document.getElementById('results');

            container.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">${getT('loading')}</p>
                </div>
            `;
            resultsBox.innerHTML = '';

            try {
                const uid = localStorage.getItem('findly_uid') || 'guest';
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}&lang=${currentLang}&uid=${uid}`);
                const data = await response.json();

                container.innerHTML = '';

                if (data.error === 'ENERGY_EMPTY') {
                    container.innerHTML = `
                        <div class="upgrade-section">
                            <div class="upgrade-icon">
                                <i class="fas fa-battery-empty"></i>
                            </div>
                            <h3 class="upgrade-title">${getT('upgradeTitle')}</h3>
                            <p class="upgrade-text">${getT('upgradeText')}</p>
                            <button class="upgrade-btn" onclick="openUpgrade()">
                                <i class="fas fa-crown"></i> ${getT('upgradeBtn')}
                            </button>
                        </div>
                    `;
                    return;
                }

                if (!data.results || data.results.length === 0) {
                    container.innerHTML = `<div class="status-message error"><i class="fas fa-search"></i> ${getT('noResults')}</div>`;
                    return;
                }

                displayResults(data.results);

            } catch (error) {
                container.innerHTML = `<div class="status-message error"><i class="fas fa-exclamation-triangle"></i> ${getT('error')}</div>`;
                console.error('Search error:', error);
            }
        }

        function displayResults(results) {
            const container = document.getElementById('results');
            container.innerHTML = '';

            results.forEach((product, index) => {
                const card = createProductCard(product, index);
                container.appendChild(card);
            });
        }

        function createProductCard(product, index) {
            const card = document.createElement('div');
            card.className = 'product-card';

            const price = product.numericPrice || 0;
            const intel = product.intelligence || {};
            const verdict = intel.finalVerdict || {};
            const priceIntel = intel.priceIntel || {};
            const forecastIntel = intel.forecastIntel || {};
            const valueIntel = intel.valueIntel || {};

            // Determine verdict class
            let verdictClass = 'buy';
            let verdictIcon = 'fa-check-circle';
            if (verdict.decision === 'WAIT' || verdict.decision === 'WAIT_PRICE_DROP') {
                verdictClass = 'wait';
                verdictIcon = 'fa-clock';
            } else if (verdict.decision === 'OVERPRICED' || verdict.decision === 'OVER_BUDGET') {
                verdictClass = 'avoid';
                verdictIcon = 'fa-exclamation-triangle';
            }

            // Price evaluation
            let priceEval = getT('good');
            if (priceIntel.score >= 75) priceEval = getT('excellent');
            else if (priceIntel.score < 50) priceEval = getT('high');

            // Trend evaluation
            let trendEval = getT('stable');
            if (forecastIntel.trend === 'down') trendEval = getT('willDrop');
            else if (forecastIntel.trend === 'up') trendEval = getT('willRise');

            // Analysis type
            let analysisType = getT('general');
            if (valueIntel.learningBoost > 0) analysisType = getT('personalized');

            // Confidence percentage
            const confidence = verdict.confidence || 60;

            // Average price calculation
            const avgPrice = priceIntel.average || price;
            const savings = price < avgPrice ? Math.round((avgPrice - price) / avgPrice * 100) : 0;

            card.innerHTML = `
                <div class="product-header">
                    <div class="product-image-wrapper">
                        <img class="product-image" src="${product.thumbnail || 'https://via.placeholder.com/200'}" alt="${product.title}" onerror="this.src='https://via.placeholder.com/200'">
                        ${savings > 10 ? `<span class="product-badge">${getT('excellent')}</span>` : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.title || getT('analysis')}</h3>
                        <div class="product-pricing">
                            <span class="current-price">$${price || '—'}</span>
                            ${priceIntel.average && price < priceIntel.average ? `
                                <span class="old-price">$${Math.round(priceIntel.average)}</span>
                                <span class="discount-badge">-${savings}%</span>
                            ` : ''}
                        </div>
                    </div>
                </div>

                ${verdict.decision ? `
                <div class="verdict-section">
                    <div class="verdict-header">
                        <div class="verdict-icon ${verdictClass}">
                            <i class="fas ${verdictIcon}"></i>
                        </div>
                        <div>
                            <div class="verdict-title ${verdictClass}">${verdict.title || (verdictClass === 'buy' ? getT('greatDeal') : verdictClass === 'wait' ? getT('waitBit') : getT('overpriced'))}</div>
                        </div>
                    </div>
                    <p class="verdict-reason">${verdict.reason || (verdictClass === 'buy' ? getT('greatDealReason') : verdictClass === 'wait' ? getT('waitReason') : getT('overpricedReason'))}</p>
                </div>
                ` : ''}

                <div class="intel-grid">
                    <div class="intel-item">
                        <div class="icon">💰</div>
                        <div class="label">${getT('price')}</div>
                        <div class="value ${priceIntel.score >= 70 ? 'good' : priceIntel.score < 50 ? 'danger' : ''}">${priceEval}</div>
                    </div>
                    <div class="intel-item">
                        <div class="icon">📈</div>
                        <div class="label">${getT('timing')}</div>
                        <div class="value ${forecastIntel.trend === 'down' ? 'good' : forecastIntel.trend === 'up' ? 'danger' : ''}">${trendEval}</div>
                    </div>
                    <div class="intel-item">
                        <div class="icon">🎯</div>
                        <div class="label">${getT('confidence')}</div>
                        <div class="value">${confidence}%</div>
                    </div>
                    <div class="intel-item">
                        <div class="icon">🧠</div>
                        <div class="label">${getT('analysis')}</div>
                        <div class="value">${analysisType}</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-label">${getT('dealScore')}</span>
                        <span class="progress-value">${valueIntel.score || 50}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${valueIntel.score >= 70 ? 'high' : valueIntel.score >= 40 ? 'medium' : 'low'}" style="width: ${valueIntel.score || 50}%"></div>
                    </div>
                </div>

                ${aiModeEnabled ? `
                <div class="analysis-panel">
                    <div class="analysis-title">
                        <i class="fas fa-chart-line"></i>
                        ${getT('analyze')}
                    </div>
                    <div class="analysis-metrics">
                        <div class="metric-card">
                            <div class="metric-label">${getT('avgPrice')}</div>
                            <div class="metric-value">$${Math.round(avgPrice)}</div>
                            <div class="metric-trend ${price < avgPrice ? 'up' : 'down'}">
                                <i class="fas fa-${price < avgPrice ? 'arrow-down' : 'arrow-up'}"></i>
                                ${savings}% ${getT('savings')}
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">${getT('competitors')}</div>
                            <div class="metric-value">${valueIntel.competitors || 0}</div>
                            <div class="metric-trend stable">
                                <i class="fas fa-store"></i>
                                ${getT('market')}
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">${getT('expectedPrice')}</div>
                            <div class="metric-value">$${forecastIntel.expectedPrice || price}</div>
                            <div class="metric-trend ${forecastIntel.trend === 'down' ? 'down' : forecastIntel.trend === 'up' ? 'up' : 'stable'}">
                                <i class="fas fa-${forecastIntel.trend === 'down' ? 'arrow-down' : forecastIntel.trend === 'up' ? 'arrow-up' : 'minus'}"></i>
                                ${trendEval}
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">${getT('bestStore')}</div>
                            <div class="metric-value">${verdict.bestStore || product.source || '—'}</div>
                            <div class="metric-trend stable">
                                <i class="fas fa-check"></i>
                                ${getT('valueForMoney')}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <div class="action-buttons">
                    ${product.link && product.link !== '#' ? `
                    <a class="btn btn-primary" href="${API_BASE}/go?url=${encodeURIComponent(product.link)}" target="_blank">
                        <i class="fas fa-shopping-cart"></i>
                        ${getT('buy')}
                    </a>
                    ` : ''}
                    <button class="btn btn-warning" onclick="addToWatchlist('${(product.title || '').replace(/'/g, "\\'")}', ${price}, '${product.link || ''}')">
                        <i class="fas fa-bell"></i>
                        ${getT('watch')}
                    </button>
                </div>
            `;

            return card;
        }

        function quickSearch(query) {
            document.getElementById('search-input').value = query;
            performSearch();
        }

        function quickFilter(type) {
            const input = document.getElementById('search-input');
            input.value += ' ' + type;
            performSearch();
        }

        // ═══ VOICE ═══
        function startVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert(getT('voiceNotSupported'));
                return;
            }

            const recognition = new SpeechRecognition();
            const voiceBtn = document.getElementById('voice-btn');

            recognition.lang = currentLang === 'ar' ? 'ar-SA' : 'en-US';
            recognition.interimResults = false;

            recognition.onstart = () => voiceBtn.classList.add('recording');
            recognition.onend = () => voiceBtn.classList.remove('recording');
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('search-input').value = transcript;
                performSearch();
            };
            recognition.onerror = () => voiceBtn.classList.remove('recording');

            recognition.start();
        }

        // ═══ CHAT ═══
        function toggleChat() {
            document.getElementById('chat-window').classList.toggle('active');
        }

        function handleChatKey(e) {
            if (e.key === 'Enter') sendChatMessage();
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            const container = document.getElementById('chat-messages');

            // Add user message
            container.innerHTML += `<div class="message user">${message}</div>`;
            input.value = '';
            container.scrollTop = container.scrollHeight;

            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, userId: localStorage.getItem('findly_uid') || 'guest' })
                });
                const data = await response.json();
                container.innerHTML += `<div class="message bot">${data.reply || data.response || getT('chatDefaultReply')}</div>`;
            } catch (error) {
                container.innerHTML += `<div class="message bot">⚠️ ${getT('chatError')}</div>`;
            }

            container.scrollTop = container.scrollHeight;
        }

        // ═══ WATCHLIST ═══
        function addToWatchlist(name, price, link) {
            let watchlist = JSON.parse(localStorage.getItem('findly_watchlist') || '[]');
            watchlist.push({ name, price, link, addedAt: Date.now() });
            localStorage.setItem('findly_watchlist', JSON.stringify(watchlist));
            updateWatchBadge();
            alert('✅ ' + getT('watchlistAdded'));
        }

        function updateWatchBadge() {
            const watchlist = JSON.parse(localStorage.getItem('findly_watchlist') || '[]');
            const badge = document.getElementById('watch-badge');
            if (watchlist.length > 0) {
                badge.textContent = watchlist.length;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function openWatchlist() {
            document.getElementById('watchlist-modal').classList.add('active');
            const watchlist = JSON.parse(localStorage.getItem('findly_watchlist') || '[]');
            const content = document.getElementById('watchlist-content');

            if (watchlist.length === 0) {
                content.innerHTML = `<p style="color: var(--text-muted); text-align: center; padding: var(--space-8);">${getT('watchlistEmpty')}</p>`;
            } else {
                content.innerHTML = watchlist.map((item, i) => `
                    <div style="padding: var(--space-4); background: var(--bg-glass); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); margin-bottom: var(--space-3);">
                        <p style="font-weight: 600; margin-bottom: var(--space-1);">${item.name}</p>
                        <p style="color: var(--success); font-weight: 700;">$${item.price || '—'}</p>
                    </div>
                `).join('');
            }
        }

        // ═══ PROFILE ═══
        function openProfile() {
            document.getElementById('profile-modal').classList.add('active');
            document.getElementById('profile-name-input').value = localStorage.getItem('fn') || '';
            document.getElementById('profile-budget-input').value = localStorage.getItem('user_budget') || '';
        }

        function saveProfile() {
            localStorage.setItem('fn', document.getElementById('profile-name-input').value);
            localStorage.setItem('user_budget', document.getElementById('profile-budget-input').value);
            closeModal('profile-modal');
            updateGreeting();
            alert('✅ ' + getT('saved'));
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // ═══ INVITE ═══
        function copyInviteLink() {
            const uid = localStorage.getItem('findly_uid') || 'guest';
            const link = `${window.location.origin}${window.location.pathname}?ref=${uid}`;
            navigator.clipboard.writeText(link).then(() => {
                alert('✅ ' + getT('copied'));
            }).catch(() => {
                alert(link);
            });
        }

        // ═══ UPGRADE ═══
        async function openUpgrade() {
            const uid = localStorage.getItem('findly_uid') || 'guest_' + Date.now();
            try {
                const response = await fetch(`${API_BASE}/create-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uid })
                });
                const data = await response.json();
                if (data.url) {
                    window.open(data.url, '_blank');
                } else {
                    alert(getT('paymentUnavailable'));
                }
            } catch (error) {
                alert(getT('paymentError'));
            }
        }

        // ═══ INITIALIZATION ═══
        window.onload = () => {
            // Load theme
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
            }

            updateUI();
            updateWatchBadge();

            // Check for upgrade success
            if (window.location.search.includes('upgrade=success')) {
                localStorage.setItem('findly_pro', 'true');
                alert('🎉 ' + (currentLang === 'ar' ? 'تم تفعيل اشتراكك بنجاح!' : 'Subscription activated successfully!'));
            }
        };

        // Close dropdowns on outside click
        window.onclick = (e) => {
            if (!e.target.closest('.dropdown-wrapper')) {
                document.getElementById('lang-menu').classList.remove('active');
            }
            if (e.target.classList.contains('modal-backdrop')) {
                e.target.classList.remove('active');
            }
        };
    </script>
</body>
</html>
