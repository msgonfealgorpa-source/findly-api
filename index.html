<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findly AI | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„ ÙˆØ§Ù„Ù…ØµØ­Ø­</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #7c3aed; }
        body.dark-mode { background-color: #0f172a; color: #f8fafc; --card-bg: rgba(255,255,255,0.05); }
        body.light-mode { background-color: #f1f5f9; color: #1e293b; --card-bg: white; }
        body { font-family: 'Cairo', sans-serif; transition: 0.3s; min-height: 100vh; overflow-x: hidden; }
        
        .hero-gradient { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .glass { background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .interest-chip { cursor: pointer; transition: 0.2s; border: 1px solid rgba(124, 58, 237, 0.3); }
        .interest-chip.selected { background: #7c3aed; color: white; border-color: #7c3aed; }
        .hidden { display: none !important; }
        .product-card { transition: 0.3s ease; }
        .product-card:hover { transform: translateY(-8px); }
    </style>
</head>
<body class="dark-mode">

<section id="auth-screen" class="min-h-screen flex items-center justify-center p-6 bg-[#0f172a]">
    <div class="glass p-8 rounded-[2.5rem] w-full max-w-md shadow-2xl border border-purple-500/20">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-black text-white">Findly<span class="text-yellow-400">.</span></h1>
            <p class="text-gray-400 text-sm mt-2" id="auth-subtitle">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶</p>
        </div>
        
        <div id="auth-error" class="hidden mb-4 p-3 rounded-xl bg-red-500/20 text-red-400 text-xs text-center"></div>

        <form id="auth-form" class="space-y-4">
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 text-white outline-none focus:border-purple-500 transition">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 text-white outline-none focus:border-purple-500 transition">
            
            <div id="interests-section" class="hidden space-y-3">
                <p class="text-xs font-bold text-purple-400">Ø§Ø®ØªØ± Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©:</p>
                <div class="flex flex-wrap gap-2" id="interests-grid">
                    <span class="interest-chip px-3 py-1 rounded-full text-xs text-gray-300" data-val="Ù‡ÙˆØ§ØªÙ">ğŸ“± Ù‡ÙˆØ§ØªÙ</span>
                    <span class="interest-chip px-3 py-1 rounded-full text-xs text-gray-300" data-val="Ø³Ù…Ø§Ø¹Ø§Øª">ğŸ§ Ø³Ù…Ø§Ø¹Ø§Øª</span>
                    <span class="interest-chip px-3 py-1 rounded-full text-xs text-gray-300" data-val="Ø³Ø§Ø¹Ø§Øª">âŒš Ø³Ø§Ø¹Ø§Øª</span>
                    <span class="interest-chip px-3 py-1 rounded-full text-xs text-gray-300" data-val="Ø­ÙˆØ§Ø³ÙŠØ¨">ğŸ’» Ø­ÙˆØ§Ø³ÙŠØ¨</span>
                </div>
            </div>

            <button type="submit" id="submit-btn" class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold shadow-lg hover:bg-purple-700 transition active:scale-95">Ø¯Ø®ÙˆÙ„</button>
        </form>
        
        <button onclick="toggleAuthMode()" id="switch-mode-btn" class="w-full mt-6 text-sm text-gray-400 hover:text-purple-400 transition text-center">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
    </div>
</section>

<section id="app-screen" class="hidden">
    <header class="hero-gradient text-white pb-24 pt-10 rounded-b-[4rem] shadow-2xl relative">
        <div class="max-w-6xl mx-auto px-6 relative z-10">
            <nav class="flex justify-between items-center mb-10">
                <div class="text-3xl font-extrabold cursor-pointer" onclick="location.reload()">Findly<span class="text-yellow-400">.</span></div>
                <div class="flex items-center gap-3">
                    <button onclick="showProfile()" class="bg-white/10 px-4 py-2 rounded-xl hover:bg-white/20 transition font-bold text-sm">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
                    <button id="theme-toggle" class="bg-white/10 p-2 rounded-xl hover:bg-white/20 transition">ğŸŒ™</button>
                    <select id="lang-select" class="bg-white/10 border-none rounded-xl text-sm p-2 outline-none text-white cursor-pointer">
                        <option value="ar" class="text-black">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="en" class="text-black">English</option>
                    </select>
                </div>
            </nav>

            <div class="text-center max-w-3xl mx-auto">
                <div id="welcome-msg" class="mb-4 text-yellow-300 font-bold opacity-90"></div>
                <h1 id="hero-title" class="text-4xl md:text-5xl font-extrabold mb-8 leading-tight"></h1>
                <div class="relative max-w-2xl mx-auto shadow-2xl rounded-[2.5rem] bg-white p-2 flex items-center group">
                    <input id="search-input" type="text" class="w-full py-4 px-6 text-gray-900 outline-none text-lg rounded-[2rem]">
                    <button onclick="executeSearch()" id="search-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-[2rem] font-bold transition shadow-lg"></button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 -mt-10 relative z-20 pb-32">
        <div id="cats-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-16"></div>
        <div class="mb-8">
            <h2 class="text-3xl font-extrabold" id="results-title"></h2>
            <p class="text-sm opacity-60 mt-2 text-center" id="status"></p>
        </div>
        <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </main>
</section>

<section id="profile-screen" class="hidden min-h-screen bg-[#0f172a] p-6 flex items-center justify-center">
    <div class="max-w-lg w-full glass p-10 rounded-[3rem] border border-purple-500/20 text-center">
        <div class="w-24 h-24 bg-purple-600 rounded-full mx-auto mb-6 flex items-center justify-center text-4xl shadow-lg">ğŸ‘¤</div>
        <h2 class="text-3xl font-black mb-2">Ø­Ø³Ø§Ø¨ÙŠ</h2>
        <p class="text-gray-400 mb-8 font-bold" id="profile-email"></p>
        
        <div class="text-right mb-10">
            <h3 class="font-bold text-sm mb-4 text-purple-400">Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:</h3>
            <div id="profile-interests" class="flex flex-wrap gap-2 justify-center"></div>
        </div>
        
        <div class="flex flex-col gap-3">
            <button onclick="backToApp()" class="w-full py-4 bg-white/5 rounded-2xl font-bold hover:bg-white/10 transition">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø­Ø«</button>
            <button onclick="logout()" class="w-full py-4 bg-red-500/20 text-red-400 rounded-2xl font-bold border border-red-500/20 hover:bg-red-500 hover:text-white transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>
</section>

<script>
// --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
const API_URL = "https://findly-api.onrender.com";
let isLoginMode = true;
let selectedInterests = [];
let currentLang = localStorage.getItem('f_lang') || 'ar';

const translations = {
    ar: {
        heroTitle: "Ø§Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø®ÙŠØ§Ø± Ø´Ø±Ø§Ø¡ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù",
        placeholder: "Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« Ø§Ù„ÙŠÙˆÙ…ØŸ",
        searchBtn: "Ø¨Ø­Ø« Ø°ÙƒÙŠ", buying: "Ø´Ø±Ø§Ø¡", searching: "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...",
        noResults: "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.", resultsTitle: "ØªÙˆØµÙŠØ§Øª Findly Ø§Ù„Ø°ÙƒÙŠØ©",
        cats: ["ğŸ“± Ù‡ÙˆØ§ØªÙ", "ğŸ§ Ø³Ù…Ø§Ø¹Ø§Øª", "âŒš Ø³Ø§Ø¹Ø§Øª", "ğŸ’» Ø­ÙˆØ§Ø³ÙŠØ¨"],
        greet: { morning: "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± â˜€ï¸", afternoon: "Ø·Ø§Ø¨ ÙŠÙˆÙ…Ùƒ âœ¨", evening: "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± ğŸŒ™", night: "Ù„ÙŠÙ„Ø© Ø³Ø¹ÙŠØ¯Ø© ğŸ’¤" }
    },
    en: {
        heroTitle: "Find the Best Purchase in Seconds",
        placeholder: "What are you looking for today?",
        searchBtn: "Smart Search", buying: "Buy", searching: "â³ Analyzing...",
        noResults: "âŒ No results found.", resultsTitle: "Smart Recommendations",
        cats: ["ğŸ“± Phones", "ğŸ§ Audio", "âŒš Watches", "ğŸ’» Laptops"],
        greet: { morning: "Good Morning â˜€ï¸", afternoon: "Good Afternoon âœ¨", evening: "Good Evening ğŸŒ™", night: "Good Night ğŸ’¤" }
    }
};

// --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Auth Logic) ---
function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    document.getElementById('auth-subtitle').innerText = isLoginMode ? "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶" : "Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ ÙˆØ§Ø®ØªØ± Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ";
    document.getElementById('interests-section').classList.toggle('hidden', isLoginMode);
    document.getElementById('submit-btn').innerText = isLoginMode ? "Ø¯Ø®ÙˆÙ„" : "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨";
    document.getElementById('switch-mode-btn').innerText = isLoginMode ? "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯" : "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ";
}

document.querySelectorAll('.interest-chip').forEach(chip => {
    chip.onclick = () => {
        chip.classList.toggle('selected');
        const val = chip.getAttribute('data-val');
        if(selectedInterests.includes(val)) selectedInterests = selectedInterests.filter(i => i !== val);
        else selectedInterests.push(val);
    };
});

document.getElementById('auth-form').onsubmit = async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const path = isLoginMode ? '/login' : '/register';
    const body = isLoginMode ? { email, password } : { email, password, interests: selectedInterests };

    try {
        const res = await fetch(`${API_URL}${path}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const data = await res.json();
        if(res.ok) {
            if(isLoginMode) {
                localStorage.setItem('f_token', data.token);
                initApp();
            } else {
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨! Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù†");
                toggleAuthMode();
            }
        } else { showError(data.message); }
    } catch { showError("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±"); }
};

function showError(msg) {
    const err = document.getElementById('auth-error');
    err.innerText = msg;
    err.classList.remove('hidden');
}

// --- Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
async function initApp() {
    document.getElementById('auth-screen').classList.add('hidden');
    document.getElementById('profile-screen').classList.add('hidden');
    document.getElementById('app-screen').classList.remove('hidden');
    updateUI(currentLang);
}

function updateUI(lang) {
    currentLang = lang;
    localStorage.setItem('f_lang', lang);
    const t = translations[lang];
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.getElementById('hero-title').innerText = t.heroTitle;
    document.getElementById('search-input').placeholder = t.placeholder;
    document.getElementById('search-btn').innerText = t.searchBtn;
    document.getElementById('results-title').innerText = t.resultsTitle;
    
    document.getElementById('cats-container').innerHTML = t.cats.map(c => 
        `<div onclick="quickSearch('${c.split(' ')[1] || c}')" class="glass p-5 rounded-2xl text-center font-bold cursor-pointer hover:bg-purple-600 hover:text-white transition shadow-sm">${c}</div>`
    ).join('');

    const hour = new Date().getHours();
    const greet = hour < 12 ? t.greet.morning : hour < 17 ? t.greet.afternoon : hour < 21 ? t.greet.evening : t.greet.night;
    document.getElementById('welcome-msg').innerText = greet;
}

// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù…ÙŠ /me
async function showProfile() {
    const token = localStorage.getItem('f_token');
    try {
        const res = await fetch(`${API_URL}/me`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();
        if(res.ok) {
            document.getElementById('app-screen').classList.add('hidden');
            document.getElementById('profile-screen').classList.remove('hidden');
            document.getElementById('profile-email').innerText = data.email;
            document.getElementById('profile-interests').innerHTML = data.interests.map(i => 
                `<span class="bg-purple-500/20 text-purple-300 px-4 py-2 rounded-xl text-xs border border-purple-500/20 font-bold">${i}</span>`
            ).join('') || '<p class="text-xs opacity-50">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</p>';
        } else { logout(); }
    } catch { logout(); }
}

function backToApp() {
    document.getElementById('profile-screen').classList.add('hidden');
    document.getElementById('app-screen').classList.remove('hidden');
}

function logout() {
    localStorage.removeItem('f_token');
    location.reload();
}

async function executeSearch() {
    const q = document.getElementById('search-input').value.trim();
    if (!q) return;

    const status = document.getElementById('status');
    const resultsDiv = document.getElementById('results');
    const t = translations[currentLang];

    status.innerText = t.searching;
    resultsDiv.innerHTML = '';

    try {
        const response = await fetch(`${API_URL}/search?q=${encodeURIComponent(q)}`);
        const data = await response.json();

        if (!data.top || data.top.length === 0) {
            status.innerText = t.noResults;
            return;
        }

        data.top.forEach(item => {
            resultsDiv.innerHTML += `
                <div class="glass p-5 rounded-[2rem] flex flex-col h-full product-card">
                    <img src="${item.image}" class="w-full h-40 object-contain rounded-2xl mb-4 bg-white/5" onerror="this.src='https://via.placeholder.com/150'">
                    <h3 class="font-bold text-sm mb-4 flex-grow">${item.name}</h3>
                    <div class="mt-auto flex justify-between items-center border-t border-white/10 pt-4">
                        <span class="text-xl font-black text-purple-400">${item.price || 'â€”'}</span>
                        <a href="${item.link}" target="_blank" class="bg-purple-600 text-white px-5 py-2 rounded-xl text-xs font-bold hover:bg-purple-700 transition">${t.buying}</a>
                    </div>
                </div>`;
        });
        status.innerText = `âœ”ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.top.length} Ù†ØªØ§Ø¦Ø¬.`;
    } catch { status.innerText = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„."; }
}

function quickSearch(v) { document.getElementById('search-input').value = v; executeSearch(); }

// --- Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ---
document.getElementById('lang-select').onchange = (e) => updateUI(e.target.value);
document.getElementById('theme-toggle').onclick = () => {
    document.body.classList.toggle('dark-mode');
    document.body.classList.toggle('light-mode');
};

if(localStorage.getItem('f_token')) initApp();
</script>
</body>
</html>
