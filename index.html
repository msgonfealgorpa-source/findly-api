<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Findly Sage Ultimate</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
    /* --- Core Variables & Reset --- */
    :root {
        --primary: #8b5cf6;
        --primary-glow: rgba(139, 92, 246, 0.5);
        --secondary: #6366f1;
        --bg-dark: #020617;
        --bg-card: rgba(30, 41, 59, 0.7);
        --text-main: #f8fafc;
        --text-muted: #94a3b8;
        --glass-border: rgba(255, 255, 255, 0.08);
        --gradient: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
        --success: #10b981;
        --danger: #ef4444;
        --font-main: 'Readex Pro', sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); outline: none; -webkit-tap-highlight-color: transparent; }
    
    body {
        background-color: var(--bg-dark);
        color: var(--text-main);
        min-height: 100vh;
        overflow-x: hidden;
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
            radial-gradient(circle at 90% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 40%);
    }

    /* --- UI Components --- */
    .navbar {
        display: flex; justify-content: space-between; align-items: center;
        padding: 20px 5%;
        backdrop-filter: blur(10px);
        position: sticky; top: 0; z-index: 100;
        border-bottom: 1px solid var(--glass-border);
    }
    .logo { font-size: 1.5rem; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; }
    
    .nav-btn {
        background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
        color: #fff; padding: 8px 16px; border-radius: 12px; cursor: pointer;
        transition: 0.3s; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;
    }
    .nav-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }

    .hero-section {
        text-align: center; padding: 60px 20px 40px;
        max-width: 800px; margin: 0 auto;
    }
    .hero-title { font-size: 2.5rem; margin-bottom: 15px; line-height: 1.2; }
    .hero-subtitle { color: var(--text-muted); margin-bottom: 40px; font-weight: 300; }

    .search-box {
        position: relative; max-width: 600px; margin: 0 auto 50px;
    }
    .main-input {
        width: 100%; background: rgba(15, 23, 42, 0.8);
        border: 2px solid var(--glass-border); border-radius: 20px;
        padding: 18px 60px 18px 25px; font-size: 1.1rem; color: #fff;
        transition: 0.3s; box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    .main-input:focus { border-color: var(--primary); box-shadow: 0 0 30px var(--primary-glow); }
    
    .search-btn {
        position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
        background: var(--gradient); border: none; width: 45px; height: 45px;
        border-radius: 14px; color: #fff; cursor: pointer; font-size: 1.2rem;
        display: flex; align-items: center; justify-content: center;
        transition: 0.3s;
    }
    .search-btn:hover { transform: translateY(-50%) scale(1.05); }

    /* --- Results Grid --- */
    .results-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px; padding: 20px 5%;
    }

    .product-card {
        background: var(--bg-card); border: 1px solid var(--glass-border);
        border-radius: 24px; padding: 20px; position: relative;
        transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex; flex-direction: column; gap: 12px;
        overflow: hidden;
    }
    .product-card:hover { transform: translateY(-8px); border-color: var(--primary); }

    .product-card img {
        width: 100%; height: 180px; object-fit: contain;
        background: #fff; border-radius: 16px; padding: 10px;
        margin-bottom: 10px;
    }
    
    .product-card h3 {
        font-size: 1rem; line-height: 1.4; margin-bottom: 5px;
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }

    .price { font-size: 1.4rem; font-weight: 700; color: var(--success); }

    /* --- New Intelligent Layers Styles (ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§) --- */
    .decision-badge {
        position: absolute; top: 15px; right: 15px; 
        padding: 6px 14px; border-radius: 20px; 
        font-weight: 700; font-size: 0.75rem; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 10;
        display: flex; align-items: center; gap: 5px;
        backdrop-filter: blur(8px);
    }
    .tag-perfect { background: linear-gradient(135deg, #10b981, #047857); color: white; border: 1px solid rgba(255,255,255,0.2); }
    .tag-good { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: 1px solid rgba(255,255,255,0.2); }
    .tag-avoid { background: linear-gradient(135deg, #ef4444, #b91c1c); color: white; border: 1px solid rgba(255,255,255,0.2); }
    .tag-normal { background: rgba(255,255,255,0.1); color: var(--text-muted); }

    .specs-row {
        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 5px;
    }
    .spec-pill {
        background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.2);
        color: #c4b5fd; font-size: 0.65rem; padding: 3px 8px; border-radius: 6px;
        display: flex; align-items: center; gap: 4px;
    }

    .match-container { margin-top: 5px; }
    .match-label { font-size: 0.7rem; color: var(--text-muted); display: flex; justify-content: space-between; margin-bottom: 3px; }
    .match-score-bar {
        height: 5px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;
    }
    .match-fill { height: 100%; background: var(--gradient); width: 0%; transition: width 1s ease; border-radius: 10px; }

    .analysis-box {
        background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px;
        font-size: 0.8rem; line-height: 1.4; margin-top: 5px;
    }
    /* ---------------------------------------------------- */

    .btn-group { display: flex; gap: 8px; margin-top: auto; }
    .action-btn {
        flex: 1; border: none; padding: 10px; border-radius: 12px;
        cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: 0.2s;
        display: flex; justify-content: center; align-items: center; gap: 5px;
    }
    .buy-now { background: var(--gradient); color: white; }
    .watch-later { background: rgba(255,255,255,0.1); color: white; }
    .compare-btn { background: rgba(255,255,255,0.05); color: var(--text-muted); }

    /* Modals */
    .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.8);
        backdrop-filter: blur(8px); z-index: 1000;
        display: none; justify-content: center; align-items: center;
    }
    .modal-card {
        background: #1e293b; width: 90%; max-width: 400px; padding: 30px;
        border-radius: 24px; border: 1px solid var(--glass-border);
        text-align: center; position: relative;
    }
    .modal-input {
        width: 100%; padding: 12px; margin: 10px 0; background: rgba(0,0,0,0.3);
        border: 1px solid var(--glass-border); border-radius: 12px; color: white;
    }
    
    footer { text-align: center; padding: 40px; color: var(--text-muted); margin-top: 50px; border-top: 1px solid var(--glass-border); }
    .footer-pill-link { color: var(--text-muted); text-decoration: none; padding: 5px 15px; border-radius: 20px; background: rgba(255,255,255,0.03); transition: 0.3s; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; }
    .footer-pill-link:hover { background: rgba(255,255,255,0.1); color: #fff; }

    #status { display: none; text-align: center; margin: 20px; font-size: 1.1rem; color: var(--text-muted); }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo"><i class="fa-solid fa-brain"></i> Findly Sage</div>
        <div style="display:flex; gap:10px;">
            <button class="nav-btn" onclick="toggleSettings()"><i class="fa-solid fa-sliders"></i></button>
            <button class="nav-btn" id="auth-btn" onclick="toggleAuth()"><i class="fa-solid fa-user"></i></button>
        </div>
    </nav>

    <div class="hero-section">
        <h1 class="hero-title">Ù…Ø­Ø±Ùƒ Ù‚Ø±Ø§Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ <br><span style="color:var(--secondary)">Ø§Ù„Ø°ÙƒÙŠ ÙˆØ§Ù„Ù…ØªÙ‚Ø¯Ù…</span></h1>
        <p class="hero-subtitle">Ù„Ø§ Ù†Ù‚Ø§Ø±Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙ‚Ø·. Ù†Ø­Ù† Ù†Ø­Ù„Ù„ Ø§Ù„Ù…ÙˆØ§ØµÙØ§ØªØŒ Ù†Ù‚ÙŠÙ… Ø§Ù„Ø³ÙˆÙ‚ØŒ ÙˆÙ†ÙÙ‡Ù… Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ Ù„Ù†Ø¹Ø·ÙŠÙƒ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­.</p>
        
        <div class="search-box">
            <input type="text" id="s-input" class="main-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ (Ù…Ø«Ù„Ø§Ù‹: iPhone 15 Pro)..." onkeypress="if(event.key==='Enter') runSearch()">
            <button class="search-btn" onclick="runSearch()">
                <i class="fa-solid fa-search"></i>
            </button>
        </div>

        <div id="status"></div>
    </div>

    <div class="results-grid" id="results"></div>

    <div id="p-modal" class="modal-overlay">
        <div class="modal-card">
            <h3><i class="fa-solid fa-sliders"></i> ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:20px;">Ø­Ø¯Ø¯ Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ù† ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØµÙÙ‚Ø§Øª Ù„Ùƒ.</p>
            <input type="text" id="in-name" class="modal-input" placeholder="Ø§Ø³Ù…Ùƒ">
            <input type="number" id="in-budget" class="modal-input" placeholder="Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© (SAR)">
            <button class="action-btn buy-now" style="width:100%; margin-top:10px;" onclick="saveSet()">Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø±Ùƒ</button>
            <button class="action-btn" style="width:100%; margin-top:10px; background:transparent;" onclick="document.getElementById('p-modal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="auth-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <p style="margin:15px 0; color:var(--text-muted)">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„Ø§ØªÙƒ ÙˆØ³Ø¬Ù„ Ø§Ù„Ø¨Ø­Ø«</p>
            <button class="action-btn buy-now" style="width:100%" onclick="loginGoogle()">Google Login</button>
            <button class="action-btn" style="width:100%; margin-top:10px;" onclick="document.getElementById('auth-modal').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <footer>
        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
            <a href="#" class="footer-pill-link"><i class="fa-solid fa-shield-halved"></i> Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
            <a href="#" class="footer-pill-link"><i class="fa-solid fa-file-contract"></i> Ø§Ù„Ø´Ø±ÙˆØ·</a>
            <a href="#" class="footer-pill-link"><i class="fa-solid fa-circle-info"></i> Ø¹Ù† Findly</a>
        </div>
        <p style="color: var(--text-muted); font-size: 0.75rem; opacity: 0.6;">Â© 2026 Findly Sage. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
    </footer>

    <script>
    // --- Configuration ---
    const API = 'http://localhost:3000'; // ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø¯ÙŠÙƒ
    let currentUserUID = null;
    let attempts = localStorage.getItem('findly_attempts') || 10;
    const lang = 'ar';

    // --- Firebase Init (Placeholder - Use your own config) ---
    const firebaseConfig = { 
        apiKey: "YOUR_API_KEY", 
        authDomain: "YOUR_APP.firebaseapp.com", 
        projectId: "YOUR_APP" 
    };
    try {
        firebase.initializeApp(firebaseConfig);
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                currentUserUID = user.uid;
                document.getElementById('auth-btn').innerHTML = '<i class="fa-solid fa-check-circle"></i>';
            } else {
                currentUserUID = null;
                document.getElementById('auth-btn').innerHTML = '<i class="fa-solid fa-user"></i>';
            }
        });
    } catch(e) { console.log("Firebase not configured yet"); }

    // --- Helper Functions ---
    function toggleSettings() { document.getElementById('p-modal').style.display = 'flex'; }
    function toggleAuth() { if(!currentUserUID) document.getElementById('auth-modal').style.display = 'flex'; else alert("Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„"); }
    function extractPrice(p) { return parseFloat(p?.toString().replace(/[^0-9.]/g, '')) || 0; }
    async function loginGoogle() {
        // Implement Google Login logic here
        alert("Simulating Login...");
        currentUserUID = "user_12345"; // Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('auth-modal').style.display='none';
        document.getElementById('auth-btn').innerHTML = '<i class="fa-solid fa-check-circle"></i>';
    }

    // --- Core Functions (UPDATED FOR INTELLIGENCE LAYERS) ---

    // 1. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ù„ØªØ±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ù‚Ø© 2 (User Profile)
    async function saveSet() {
        const n = document.getElementById('in-name').value;
        const b = document.getElementById('in-budget').value;
        
        if(n) localStorage.setItem('fn', n);
        if(b) localStorage.setItem('fb', b);

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø°ÙƒÙŠ
        if (currentUserUID && b) {
            try {
                const btn = document.querySelector('#p-modal .buy-now');
                btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
                
                await fetch(`${API}/user/preferences`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        uid: currentUserUID, 
                        budget: parseFloat(b),
                        categories: [] 
                    })
                });
                console.log("âœ… Profile synced with Intelligent Engine");
                btn.innerHTML = 'Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø±Ùƒ';
            } catch (e) { console.warn("Sync failed, working locally"); }
        }

        document.getElementById('p-modal').style.display = 'none';
        alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‚Ø±Ø§Ø±");
    }

    // 2. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ù„ØªØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø¨Ù‚Ø§Øª 1, 4, 5
    async function runSearch() {  
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡ Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø²ÙˆØ§Ø±)
        if (!currentUserUID) { 
            // alert("ÙŠÙØ¶Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù…Ø®ØµØµØ© Ù„Ùƒ"); 
            // Ø³Ù†ÙƒÙ…Ù„ Ø§Ù„Ø¨Ø­Ø« Ù„ÙƒÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù† ØªÙƒÙˆÙ† Ù…Ø®ØµØµØ© 100%
        }  

        let q = document.getElementById('s-input').value;  
        const status = document.getElementById('status');  
        const resCon = document.getElementById('results');  
        
        if (!q) return;  

        status.style.display = "block";  
        status.innerHTML = '<i class="fa-solid fa-microchip fa-spin"></i> Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙŠØ­Ù„Ù„ Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„Ù…ÙˆØ§ØµÙØ§Øª...';  
        resCon.innerHTML = "";  

        try {  
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø­Ø¯Ø«
            const res = await fetch(`${API}/smart-search`, {  
                method: 'POST',  
                headers: { 'Content-Type': 'application/json' },  
                // Ù†Ø±Ø³Ù„ UID Ù„ÙŠØ¹Ø±Ù Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ù† Ù†Ø­Ù† ÙˆÙŠØ·Ø¨Ù‚ Ø§Ù„Ø·Ø¨Ù‚Ø© 2
                body: JSON.stringify({ query: q, lang: 'ar', uid: currentUserUID, filterType: 'smart' })  
            });  
            
            const data = await res.json();  
            status.style.display = "none";  

            if (data.products && data.products.length > 0) {  
                data.products.forEach((p, index) => {  
                    
                    // --- Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ (Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©) ---
                    const analysis = p.analysis || {};
                    const decisionTag = analysis.decisionTag || "Standard"; // Ø§Ù„Ø·Ø¨Ù‚Ø© 4
                    const userScore = analysis.userMatchScore || 50;       // Ø§Ù„Ø·Ø¨Ù‚Ø© 2
                    const specs = p.specs || {};                           // Ø§Ù„Ø·Ø¨Ù‚Ø© 1

                    // ØªØ­Ø¯ÙŠØ¯ Ø´ÙƒÙ„ Ø§Ù„ÙˆØ³Ù… (Badge)
                    let tagClass = "tag-normal";
                    let tagIcon = "";
                    if (decisionTag.includes("Ù…Ø«Ø§Ù„ÙŠ") || decisionTag.includes("Perfect")) { tagClass = "tag-perfect"; tagIcon = "âœ¨"; }
                    else if (decisionTag.includes("Ø£ÙØ¶Ù„") || decisionTag.includes("Best")) { tagClass = "tag-good"; tagIcon = "ğŸ”¥"; }
                    else if (decisionTag.includes("ØªØ¬Ù†Ø¨Ù‡") || decisionTag.includes("Avoid")) { tagClass = "tag-avoid"; tagIcon = "âš ï¸"; }

                    // ØªØ¬Ù‡ÙŠØ² Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª (Specs Pills)
                    let specsHTML = "";
                    if(specs.cpu) specsHTML += `<span class="spec-pill"><i class="fa-solid fa-microchip"></i> ${specs.cpu}</span>`;
                    if(specs.ram) specsHTML += `<span class="spec-pill">RAM ${specs.ram}GB</span>`;
                    if(specs.gpu) specsHTML += `<span class="spec-pill"><i class="fa-solid fa-display"></i> ${specs.gpu}</span>`;

                    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¢Ù…Ù†Ø©
                    const safeName = p.name.replace(/'/g, "\\'").replace(/"/g, "&quot;");
                    
                    setTimeout(() => {  
                        resCon.innerHTML += `  
                            <div class="product-card">  
                                <div class="decision-badge ${tagClass}">${tagIcon} ${decisionTag}</div>

                                <img src="${p.thumbnail || ''}" onerror="this.src='https://via.placeholder.com/150'">  
                                <h3>${p.name}</h3>  
                                
                                <div class="specs-row">${specsHTML}</div>

                                <div class="price">${p.price || 'N/A'}</div>  
                                
                                <div class="match-container">
                                    <div class="match-label">
                                        <span>Ù…Ø¯Ù‰ Ø§Ù„Ù…Ù„Ø§Ø¡Ù…Ø© Ù„Ùƒ</span>
                                        <span>${userScore}%</span>
                                    </div>
                                    <div class="match-score-bar"><div class="match-fill" style="width:${userScore}%"></div></div>
                                </div>

                                <div class="analysis-box">
                                    ${analysis.pros && analysis.pros.length > 0 ? `<div style="color:#10b981"><i class="fa-solid fa-check"></i> ${analysis.pros[0]}</div>` : ''}
                                    ${analysis.cons && analysis.cons.length > 0 ? `<div style="color:#ef4444; margin-top:4px;"><i class="fa-solid fa-xmark"></i> ${analysis.cons[0]}</div>` : ''}
                                </div>

                                <div class="btn-group">  
                                    <a href="${p.link}" target="_blank" class="action-btn buy-now">Ø´Ø±Ø§Ø¡ ğŸ›’</a>  
                                    <button class="action-btn watch-later" onclick="addToWatch('${safeName}', '${p.price}', '${p.link}')">ØªØªØ¨Ø¹ ğŸ””</button>
                                </div>
                            </div>
                        `;
                    }, 100 * index);
                });
            } else { 
                status.style.display = "block"; 
                status.innerHTML = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø°ÙƒÙŠØ©. Ø­Ø§ÙˆÙ„ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø«."; 
            }  
        } catch (e) { 
            status.style.display = "block"; 
            status.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø°ÙƒÙŠ."; 
            console.error(e); 
        }  
    }

    function addToWatch(name, price, link) {
        // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØªØ¨Ø¹ Ù‡Ù†Ø§
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØªØ¨Ø¹: " + name);
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    window.onload = function() {
        if(localStorage.getItem('fn')) document.getElementById('in-name').value = localStorage.getItem('fn');
        if(localStorage.getItem('fb')) document.getElementById('in-budget').value = localStorage.getItem('fb');
    }
    </script>
</body>
</html>
