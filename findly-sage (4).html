<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Findly Sage - Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø­ÙƒÙŠÙ… Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø°ÙƒÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-glow: rgba(139, 92, 246, 0.5);
            --secondary: #6366f1;
            --bg-dark: #020617;
            --bg-card: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --gradient: linear-gradient(135deg, #6366F1, #A855F7);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        .light-mode {
            --bg-dark: #f8fafc;
            --bg-card: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.05);
            --text: #1e293b;
            --text-muted: #64748b;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, transparent 50%);
            color: var(--text);
            font-family: 'Readex Pro', sans-serif;
            margin: 0;
            transition: background 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
            min-height: 100vh;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header-tools { display: flex; gap: 10px; }
        .tool-btn {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            color: var(--text);
            width: 42px;
            height: 42px;
            border-radius: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .tool-btn:hover { transform: translateY(-2px); border-color: var(--primary); }
        .lang-menu {
            display: none;
            position: absolute;
            top: 50px;
            left: 0;
            background: #1e293b;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            width: 140px;
            z-index: 2000;
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.4);
            overflow: hidden;
        }
        .lang-item {
            padding: 12px;
            font-size: 0.9rem;
            cursor: pointer;
            color: #e2e8f0;
            text-align: center;
            transition: 0.2s;
        }
        .lang-item:hover { background: var(--primary); color: white; }
        .search-area { padding: 40px 5%; text-align: center; max-width: 800px; margin: 0 auto; }
        .energy-box {
            background: rgba(168, 85, 247, 0.08);
            border: 1px solid rgba(168, 85, 247, 0.3);
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }
        h1#txt-title {
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
            font-size: 2.5rem;
        }
        .light-mode h1#txt-title {
            background: linear-gradient(to right, #1e293b, #475569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .ai-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 25px;
            justify-content: center;
            font-weight: 600;
            background: rgba(139, 92, 246, 0.05);
            padding: 8px 16px;
            border-radius: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .ai-toggle input { width: 20px; height: 20px; accent-color: var(--primary); cursor: pointer; }
        .search-wrapper { position: relative; max-width: 600px; margin: 0 auto 20px; }
        .search-input {
            width: 100%;
            padding: 18px 70px;
            border-radius: 24px;
            border: 2px solid var(--glass-border);
            background: var(--bg-card);
            color: var(--text);
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            text-align: center;
        }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.15); }
        .mic-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
            cursor: pointer;
            font-size: 1.4rem;
            background: none;
            border: none;
            padding: 10px;
            border-radius: 50%;
            transition: 0.3s;
            z-index: 10;
        }
        .mic-icon:hover { background: rgba(139, 92, 246, 0.1); }
        .mic-active { color: #ef4444 !important; background: rgba(239, 68, 68, 0.1) !important; animation: pulse 1s infinite; }
        .send-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gradient);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 18px;
            color: #fff;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .send-btn:hover { transform: translateY(-50%) scale(1.05); }
        .ai-options { display: flex; justify-content: center; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .ai-tag {
            font-size: 0.8rem; padding: 8px 16px; border-radius: 20px;
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            cursor: pointer; color: var(--text-muted); display: flex; align-items: center; gap: 8px;
            transition: 0.3s;
        }
        .ai-tag:hover { background: var(--bg-card); color: var(--primary); border-color: var(--primary); }
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; max-width: 600px; margin: 30px auto; }
        .cat-card {
            background: var(--bg-card); border: 1px solid var(--glass-border);
            padding: 15px 10px; border-radius: 20px; cursor: pointer;
            transition: 0.3s; display: flex; flex-direction: column; align-items: center; gap: 8px;
        }
        .cat-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .cat-card i { font-size: 1.5rem; color: var(--secondary); }
        .cat-card span { font-size: 0.75rem; font-weight: 600; }
        
        /* ========== Product Card with Tabs ========== */
        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 0;
            margin-top: 25px;
            text-align: right;
            max-width: 600px;
            margin-left: auto; margin-right: auto;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            animation: slideUp 0.5s ease;
        }
        .product-card.deal-strong { border-color: rgba(16, 185, 129, 0.5); }
        .product-card.deal-medium { border-color: rgba(245, 158, 11, 0.5); }
        .product-card.deal-weak { border-color: rgba(239, 68, 68, 0.5); }
        
        /* Deal Badge */
        .deal-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            z-index: 10;
        }
        .deal-badge.strong { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.5); }
        .deal-badge.medium { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.5); }
        .deal-badge.weak { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.5); }
        
        /* Tabs */
        .tabs-container { width: 100%; }
        .tabs-header {
            display: flex;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--glass-border);
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .tab-btn:hover { color: var(--text); background: rgba(255,255,255,0.02); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); background: rgba(139, 92, 246, 0.05); }
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        
        .product-card img { width: 100%; height: 200px; object-fit: contain; background: #fff; border-radius: 16px; margin-bottom: 15px; padding: 10px; }
        .product-card h3 { margin: 0 0 10px 0; font-size: 1.1rem; line-height: 1.5; color: var(--text); }
        .product-card .price { font-size: 1.4rem; font-weight: 800; color: #10b981; margin-bottom: 10px; }
        
        /* Quick Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 12px 0; }
        .stat-item {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
        }
        .stat-value { font-size: 1.2rem; font-weight: 800; }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }
        .stat-item.value .stat-value { color: #10b981; }
        .stat-item.trust .stat-value { color: #3b82f6; }
        .stat-item.deal .stat-value { color: #f59e0b; }
        
        /* Analysis Section */
        .analysis-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            padding: 14px;
            margin: 12px 0;
        }
        .analysis-section h4 {
            margin: 0 0 10px 0;
            font-size: 0.95rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .analysis-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 0.85rem;
        }
        .analysis-row span:first-child { color: var(--text-muted); }
        .analysis-row span:last-child { font-weight: 600; }
        
        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .progress-fill.high { background: linear-gradient(90deg, #10b981, #22c55e); }
        .progress-fill.medium { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .progress-fill.low { background: linear-gradient(90deg, #ef4444, #f87171); }
        
        /* AI Decision Box */
        .ai-decision {
            border-radius: 14px;
            padding: 16px;
            margin: 12px 0;
        }
        .ai-decision.buy { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); }
        .ai-decision.wait { background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); }
        .ai-decision.drop { background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); }
        .ai-decision.overpriced { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); }
        .ai-decision-icon { font-size: 2rem; margin-bottom: 8px; }
        .ai-decision-title { font-weight: 700; font-size: 1rem; margin-bottom: 6px; }
        .ai-decision.buy .ai-decision-title { color: #10b981; }
        .ai-decision.wait .ai-decision-title { color: #f59e0b; }
        .ai-decision.drop .ai-decision-title { color: #6366f1; }
        .ai-decision.overpriced .ai-decision-title { color: #ef4444; }
        .ai-decision-reason { font-size: 0.85rem; color: var(--text-muted); }
        
        /* Personality Badge */
        .personality-badge {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(99, 102, 241, 0.2));
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 14px;
            padding: 12px;
            margin: 12px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .personality-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        .personality-info h5 { margin: 0; font-size: 0.9rem; color: var(--primary); }
        .personality-info p { margin: 2px 0 0 0; font-size: 0.75rem; color: var(--text-muted); }
        
        /* Action Buttons */
        .action-btn {
            flex: 1; padding: 12px; border-radius: 14px; font-weight: 700;
            text-align: center; border: none; font-size: 0.9rem; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .buy-now { background: var(--gradient); color: #fff; text-decoration: none; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3); }
        .buy-now:hover { filter: brightness(1.1); }
        .watch-btn { background: #f59e0b; color: white; }
        .watch-btn:hover { filter: brightness(1.1); }
        
        /* ========== Auth Modal ========== */
        .modal {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.8); z-index: 3000;
            align-items: center; justify-content: center;
            backdrop-filter: blur(12px);
        }
        .modal.active { display: flex; }
        .modal-box {
            background: #0f172a; padding: 30px; border-radius: 30px;
            width: 85%; max-width: 420px;
            border: 1px solid var(--glass-border);
            text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            max-height: 80vh; overflow-y: auto;
            position: relative;
        }
        .modal-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
            border-radius: 30px 30px 0 0;
        }
        .auth-logo {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.6rem;
        }
        .modal-box h2 { margin: 0 0 5px 0; font-size: 1.5rem; }
        .modal-box .subtitle { color: var(--text-muted); font-size: 0.85rem; margin-bottom: 20px; }
        .modal-box input {
            width: 100%; padding: 14px; margin: 8px 0; border-radius: 14px;
            background: #1e293b; color: #fff; border: 1px solid var(--glass-border);
            text-align: center; font-family: inherit;
        }
        .modal-box input:focus { border-color: var(--primary); outline: none; }
        .modal-btn {
            width: 100%;
            padding: 14px;
            background: var(--gradient);
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .modal-btn:hover { filter: brightness(1.1); }
        .divider {
            display: flex;
            align-items: center;
            margin: 15px 0;
            color: var(--text-muted);
            font-size: 0.8rem;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .divider span { padding: 0 15px; }
        .google-btn {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            color: var(--text);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .google-btn:hover { background: rgba(255,255,255,0.1); }
        .google-btn img { width: 18px; height: 18px; }
        .switch-auth {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.08);
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .switch-auth a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
            cursor: pointer;
        }
        .switch-auth a:hover { color: #a855f7; }
        
        /* Auth Views */
        .auth-view { display: none; }
        .auth-view.active { display: block; animation: fadeIn 0.3s ease; }
        
        /* Invite Card */
        .invite-card {
            display: flex;
            align-items: center;
            gap: 14px;
            background: linear-gradient(135deg, rgba(40, 32, 90, 0.85), rgba(28, 22, 60, 0.9));
            border: 1px solid rgba(138, 99, 255, 0.35);
            border-radius: 16px;
            padding: 14px 16px;
            margin-top: 14px;
            cursor: pointer;
            transition: all 0.25s ease;
            justify-content: center;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .invite-card:hover { transform: translateY(-2px); }
        .invite-text { font-size: 14.5px; color: #e1dbff; line-height: 1.6; text-align: center; width: 100%; }
        
        /* Alert Box */
        .alert-box {
            padding: 12px 16px;
            border-radius: 12px;
            margin: 12px 0;
            font-size: 0.85rem;
        }
        .alert-box.error { background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; }
        .alert-box.success { background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); color: #10b981; }
        .alert-box.warning { background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.3); color: #f59e0b; }
        
        /* Technical Indicators */
        .tech-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .tech-item {
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        .tech-label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px; }
        .tech-value { font-size: 1.1rem; font-weight: 700; }
        .tech-value.oversold { color: #10b981; }
        .tech-value.overbought { color: #ef4444; }
        .tech-value.neutral { color: #f59e0b; }
        
        /* Fake Deal Alert */
        .fake-deal-alert {
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid rgba(239, 68, 68, 0.5);
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
        }
        .fake-deal-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .fake-deal-icon { font-size: 1.3rem; }
        .fake-deal-title { font-weight: 700; color: #ef4444; }
        .fake-deal-reasons { font-size: 0.8rem; color: var(--text-muted); padding-right: 15px; margin: 0; }
        .fake-deal-reasons li { margin: 4px 0; }
        
        /* Animations */
        @keyframes pulse { 0%, 100% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(1.1); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        /* Responsive */
        @media (max-width: 768px) {
            .cat-grid { grid-template-columns: repeat(3, 1fr); }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .tech-grid { grid-template-columns: 1fr; }
            h1#txt-title { font-size: 1.8rem; }
        }
        
        @media (max-width: 480px) {
            .modal-box { padding: 20px; }
            .product-card { border-radius: 16px; }
            .tab-btn { font-size: 0.8rem; padding: 10px; }
        }
    </style>
</head>
<body>

<!-- ========== Auth Modal ========== -->
<div id="auth-modal" class="modal active">
    <div class="modal-box">
        <!-- Login View -->
        <div id="login-view" class="auth-view active">
            <div class="auth-logo"><i class="fa-solid fa-user-astronaut"></i></div>
            <h2>Findly Sage</h2>
            <p class="subtitle" id="login-subtitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹! Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            
            <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            
            <button class="modal-btn" onclick="handleLogin()" id="btn-login">
                <i class="fa-solid fa-right-to-bracket"></i>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            </button>
            
            <div class="divider"><span>Ø£Ùˆ</span></div>
            
            <button class="google-btn" onclick="loginWithGoogle()" id="btn-google">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                <span>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬ÙˆØ¬Ù„</span>
            </button>
            
            <div class="switch-auth">
                Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ
                <a id="go-to-signup">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ <i class="fa-solid fa-arrow-left"></i></a>
            </div>
        </div>
        
        <!-- Signup View -->
        <div id="signup-view" class="auth-view">
            <div class="auth-logo"><i class="fa-solid fa-user-plus"></i></div>
            <h2>Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
            <p class="subtitle">Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠØ©</p>
            
            <input type="text" id="signup-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="email" id="signup-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="signup-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            
            <button class="modal-btn" onclick="handleRegister()" id="btn-register">
                <i class="fa-solid fa-user-plus"></i>
                <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
            </button>
            
            <div class="divider"><span>Ø£Ùˆ</span></div>
            
            <button class="google-btn" onclick="loginWithGoogle()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                <span>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬ÙˆØ¬Ù„</span>
            </button>
            
            <div class="switch-auth">
                Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
                <a id="go-to-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ <i class="fa-solid fa-arrow-left"></i></a>
            </div>
        </div>
    </div>
</div>

<!-- ========== Profile Modal ========== -->
<div id="profile-modal" class="modal">
    <div class="modal-box">
        <h2 style="margin-top:0;"><i class="fa-solid fa-user-gear"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
        <label style="font-size:0.85rem; display:block; margin-bottom:5px; opacity:0.7; text-align:right;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <input type="text" id="profile-name" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <label style="font-size:0.85rem; display:block; margin-top:15px; margin-bottom:5px; opacity:0.7; text-align:right;">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ($)</label>
        <input type="number" id="profile-budget" placeholder="0">
        <button class="modal-btn" onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…</button>
        <button onclick="toggleProfile()" style="background:none; color:var(--text-muted); border:none; margin-top:15px; cursor:pointer; font-size:0.9rem;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<!-- ========== Watch Price Modal ========== -->
<div id="watch-modal" class="modal">
    <div class="modal-box">
        <h2 style="margin-top:0;">ğŸ”” Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³Ø¹Ø±</h2>
        <p id="watch-product-name" style="color:var(--text-muted); font-size:0.85rem;"></p>
        <label style="font-size:0.85rem; display:block; margin-bottom:5px; opacity:0.7; text-align:right;">Ø£Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡</label>
        <input type="email" id="watch-email" placeholder="email@example.com">
        <button class="modal-btn watch-btn" onclick="submitWatchPrice()">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
        <button onclick="toggleWatchModal()" style="background:none; color:var(--text-muted); border:none; margin-top:15px; cursor:pointer; font-size:0.9rem;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<!-- ========== Header ========== -->
<header>
    <div class="logo-area">
        <div class="logo">Findly <i class="fa-solid fa-wand-magic-sparkles"></i></div>
    </div>
    <div class="header-tools">
        <button class="tool-btn" onclick="toggleMode()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹"><i class="fa-solid fa-circle-half-stroke"></i></button>
        <div style="position: relative;">
            <button class="tool-btn" onclick="toggleLangMenu()" title="Ø§Ù„Ù„ØºØ©"><i class="fa-solid fa-language"></i></button>
            <div id="lang-menu" class="lang-menu">
                <div class="lang-item" onclick="setLang('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                <div class="lang-item" onclick="setLang('en')">English</div>
                <div class="lang-item" onclick="setLang('fr')">FranÃ§ais</div>
                <div class="lang-item" onclick="setLang('de')">Deutsch</div>
                <div class="lang-item" onclick="setLang('es')">EspaÃ±ol</div>
                <div class="lang-item" onclick="setLang('tr')">TÃ¼rkÃ§e</div>
            </div>
        </div>
        <button class="tool-btn" onclick="toggleProfile()" title="Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ"><i class="fa-solid fa-user-gear"></i></button>
        <button class="tool-btn" onclick="logoutUser()" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"><i class="fa-solid fa-right-from-bracket"></i></button>
    </div>
</header>

<!-- ========== Main Content ========== -->
<main class="search-area">
    <div class="energy-box">
        <span id="txt-energy">Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù‚Ù„</span>
        <span id="energy-count" style="background:var(--primary); color:#fff; padding:3px 12px; border-radius:20px; font-weight:900; font-size: 0.9rem;">3</span>
        <i class="fa-solid fa-bolt" style="color:#FFD700;"></i>
    </div>
    
    <h2 id="greeting" style="color: var(--primary); font-size: 1.1rem; margin-bottom: 5px; font-weight: 600;">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ</h2>
    <h1 id="txt-title">Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø­ÙƒÙŠÙ…</h1>
    <p id="txt-sub" style="color: var(--text-muted); font-size: 0.95rem; margin-bottom: 30px;">Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ</p>
    
    <div class="search-wrapper">
        <input type="text" id="search-input" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeypress="if(event.key==='Enter')runSearch()">
        <button id="mic-btn" class="mic-icon" type="button" onclick="toggleVoiceSearch()"><i class="fa-solid fa-microphone"></i></button>
        <button class="send-btn" onclick="runSearch()"><i class="fa-solid fa-magnifying-glass"></i></button>
    </div>
    
    <div class="invite-card" onclick="copyInviteLink()">
        <div class="invite-text">Ø§Ø¯Ø¹Ù Ø£ØµØ¯Ù‚Ø§Ø¡Ùƒ Ø§Ù„Ø¢Ù† âœ¨ â€” Ù…ÙƒØ§ÙØ¢Øª Ù‚Ø§Ø¯Ù…Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§ ğŸ</div>
    </div>
    
    <div class="ai-options">
        <div class="ai-tag" onclick="quickFilter('cheap')"><i class="fa-solid fa-sack-dollar"></i> <span>Ø§Ù‚ØªØµØ§Ø¯ÙŠ</span></div>
        <div class="ai-tag" onclick="quickFilter('top')"><i class="fa-solid fa-star"></i> <span>Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</span></div>
        <div class="ai-tag" onclick="quickFilter('new')"><i class="fa-solid fa-fire"></i> <span>Ø­Ø¯ÙŠØ« Ø¬Ø¯Ø§Ù‹</span></div>
    </div>
    
    <div class="cat-grid">
        <div class="cat-card" onclick="quickSearch('Ø£Ù„Ø¹Ø§Ø¨')"><i class="fa-solid fa-gamepad"></i><span>Ø£Ù„Ø¹Ø§Ø¨</span></div>
        <div class="cat-card" onclick="quickSearch('Ø¬Ù…Ø§Ù„')"><i class="fa-solid fa-sparkles"></i><span>Ø¬Ù…Ø§Ù„</span></div>
        <div class="cat-card" onclick="quickSearch('Ù…Ù†Ø²Ù„ Ø°ÙƒÙŠ')"><i class="fa-solid fa-house-laptop"></i><span>Ù…Ù†Ø²Ù„ Ø°ÙƒÙŠ</span></div>
        <div class="cat-card" onclick="quickSearch('Ù‡ÙˆØ§ØªÙ')"><i class="fa-solid fa-mobile-screen-button"></i><span>Ù‡ÙˆØ§ØªÙ</span></div>
        <div class="cat-card" onclick="quickSearch('Ù„Ø§Ø¨ØªÙˆØ¨')"><i class="fa-solid fa-laptop"></i><span>Ù„Ø§Ø¨ØªÙˆØ¨</span></div>
        <div class="cat-card" onclick="quickSearch('Ø³Ø§Ø¹Ø§Øª')"><i class="fa-solid fa-stopwatch"></i><span>Ø³Ø§Ø¹Ø§Øª</span></div>
    </div>
    
    <div id="status" style="display:none; color:var(--primary); font-weight:bold; margin-top:30px; font-size: 1.1rem; text-align: center;"></div>
    
    <div id="personality-container" style="display: none; max-width: 600px; margin: 20px auto;"></div>
    
    <div id="results"></div>
</main>

<!-- ========== Firebase Module Script ========== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyCI_q5lkgRY4133ua4RlG5TeiCqJ5N5KTU",
    authDomain: "findly-ede17.firebaseapp.com",
    projectId: "findly-ede17",
    storageBucket: "findly-ede17.firebasestorage.app",
    messagingSenderId: "503212830017",
    appId: "1:503212830017:web:9afb64c19822bbe7f645c0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// ===== AUTH FUNCTIONS =====
window.loginWithGoogle = async () => {
    try { 
        await signInWithPopup(auth, provider); 
    } catch (error) { 
        alert("Error: " + error.message); 
    }
};

window.handleLogin = async () => {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    if (!email || !password) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
    try {
        await signInWithEmailAndPassword(auth, email, password);
    } catch (error) {
        let msg = 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
        if (error.code === 'auth/user-not-found') msg = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
        else if (error.code === 'auth/wrong-password') msg = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
        else if (error.code === 'auth/invalid-email') msg = 'ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
        else if (error.code === 'auth/invalid-credential') msg = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­Ø©';
        alert(msg);
    }
};

window.handleRegister = async () => {
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    const name = document.getElementById('signup-name').value;
    if (!email || !password) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
    if (password.length < 6) return alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
    try {
        await createUserWithEmailAndPassword(auth, email, password);
        if (name) localStorage.setItem('fn', name);
        alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
    } catch (error) {
        let msg = 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
        if (error.code === 'auth/email-already-in-use') msg = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„';
        else if (error.code === 'auth/weak-password') msg = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©';
        alert(msg);
    }
};

window.logoutUser = () => {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        signOut(auth).then(() => {
            sessionStorage.removeItem('welcome_shown');
            location.reload();
        });
    }
};

// ===== AUTH STATE LISTENER =====
onAuthStateChanged(auth, (user) => {
    const overlay = document.getElementById('auth-modal');
    if (user) {
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
        localStorage.setItem('findly_uid', user.uid);
        updateGreeting();
    } else {
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
});

// ===== GLOBAL AUTH FUNCTIONS =====
window.firebaseAuth = auth;
window.firebaseApp = app;

window.getAuthToken = async function() {
    const user = auth.currentUser;
    if (!user) return null;
    try {
        return await user.getIdToken();
    } catch (e) {
        return null;
    }
};

window.getCurrentUser = function() {
    return auth.currentUser;
};

console.log('ğŸ”¥ Firebase initialized');
</script>

<!-- ========== Main Application Script ========== -->
<script>
const API = "https://findly-api-production.up.railway.app";
let lang = localStorage.getItem('findly_lang') || 'ar';
let voiceRecognition = null;
let isListening = false;
let watchProductData = null;
let userBudget = parseFloat(localStorage.getItem('user_budget')) || 0;

// ===== PERSONALITY TYPES =====
const personalityTypes = {
    smartHunter: { name: 'ØµÙŠØ§Ø¯ Ø°ÙƒÙŠ', desc: 'ØªØ¨Ø­Ø« Ø¹Ù† Ø£ÙØ¶Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª', icon: 'ğŸ¯' },
    brandLover: { name: 'Ù…Ø­Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª', desc: 'ØªÙØ¶Ù„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚Ø©', icon: 'ğŸ’' },
    budgetSaver: { name: 'Ù…ÙˆÙØ± Ø°ÙƒÙŠ', desc: 'ØªØ±ÙƒØ² Ø¹Ù„Ù‰ ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø§Ù„', icon: 'ğŸ’°' },
    impulsive: { name: 'Ù…ØªØ³ÙˆÙ‚ Ø¹ÙÙˆÙŠ', desc: 'ØªØªØ®Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©', icon: 'âš¡' },
    researcher: { name: 'Ø¨Ø§Ø­Ø« Ø¯Ù‚ÙŠÙ‚', desc: 'ØªÙ‚Ø§Ø±Ù† Ù‚Ø¨Ù„ ÙƒÙ„ Ø´Ø±Ø§Ø¡', icon: 'ğŸ”¬' }
};

// ===== VOICE SEARCH =====
function initVoiceSearch() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const micBtn = document.getElementById('mic-btn');
    
    if (!SpeechRecognition) {
        micBtn.style.opacity = '0.5';
        micBtn.style.cursor = 'not-allowed';
        micBtn.title = 'Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ';
        return;
    }
    
    voiceRecognition = new SpeechRecognition();
    
    const langMap = {
        ar: 'ar-SA',
        en: 'en-US',
        fr: 'fr-FR',
        de: 'de-DE',
        es: 'es-ES',
        tr: 'tr-TR'
    };
    
    voiceRecognition.lang = langMap[lang] || 'ar-SA';
    voiceRecognition.interimResults = false;
    voiceRecognition.continuous = false;
    
    voiceRecognition.onstart = function() {
        isListening = true;
        micBtn.classList.add('mic-active');
        micBtn.innerHTML = '<i class="fa-solid fa-stop"></i>';
    };
    
    voiceRecognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('search-input').value = transcript;
        runSearch();
    };
    
    voiceRecognition.onerror = function(event) {
        console.error('Voice error:', event.error);
        if (event.error === 'not-allowed') {
            alert('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†.');
        }
        stopVoiceRecognition();
    };
    
    voiceRecognition.onend = function() {
        stopVoiceRecognition();
    };
}

function stopVoiceRecognition() {
    isListening = false;
    const micBtn = document.getElementById('mic-btn');
    micBtn.classList.remove('mic-active');
    micBtn.innerHTML = '<i class="fa-solid fa-microphone"></i>';
}

window.toggleVoiceSearch = async function() {
    if (!voiceRecognition) {
        alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ');
        return;
    }
    
    // Request microphone permission
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        stream.getTracks().forEach(track => track.stop());
    } catch (error) {
        alert('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.');
        return;
    }
    
    if (isListening) {
        voiceRecognition.stop();
    } else {
        try {
            voiceRecognition.start();
        } catch (e) {
            console.error('Voice start error:', e);
        }
    }
};

// ===== AUTH UI =====
window.toggleAuthView = function(view) {
    document.getElementById('login-view').classList.toggle('active', view === 'login');
    document.getElementById('signup-view').classList.toggle('active', view === 'signup');
};

document.getElementById('go-to-signup').addEventListener('click', () => toggleAuthView('signup'));
document.getElementById('go-to-login').addEventListener('click', () => toggleAuthView('login'));

// ===== PROFILE =====
window.toggleProfile = function() {
    const modal = document.getElementById('profile-modal');
    modal.classList.toggle('active');
    document.getElementById('profile-name').value = localStorage.getItem('fn') || '';
    document.getElementById('profile-budget').value = localStorage.getItem('user_budget') || '';
};

window.saveProfile = function() {
    const name = document.getElementById('profile-name').value;
    const budget = document.getElementById('profile-budget').value;
    localStorage.setItem('fn', name);
    localStorage.setItem('user_budget', budget);
    userBudget = parseFloat(budget) || 0;
    updateGreeting();
    toggleProfile();
};

function updateGreeting() {
    const name = localStorage.getItem('fn') || 'Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø¨Ø§Ø­Ø«';
    document.getElementById('greeting').textContent = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ' + name;
}

// ===== WATCH PRICE =====
window.toggleWatchModal = function() {
    document.getElementById('watch-modal').classList.toggle('active');
};

window.submitWatchPrice = async function() {
    const email = document.getElementById('watch-email').value;
    if (!email || !email.includes('@')) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
    if (!watchProductData) return;
    
    const priceVal = parseFloat(String(watchProductData.price).replace(/[^\d.]/g, '')) || 0;
    const uid = localStorage.getItem('findly_uid') || 'guest';
    
    try {
        const response = await fetch(API + '/alerts', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                email: email,
                productName: watchProductData.title,
                targetPrice: priceVal * 0.9,
                currentPrice: priceVal,
                productLink: watchProductData.link,
                lang: lang,
                uid: uid
            })
        });
        
        if (response.ok) {
            alert('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡! Ø³Ù†Ø®Ø¨Ø±Ùƒ Ø¹Ù†Ø¯ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø³Ø¹Ø±.');
            toggleWatchModal();
        } else {
            alert('âŒ Ø®Ø·Ø£: ' + response.status);
        }
    } catch (error) {
        alert('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
    }
};

// ===== UI FUNCTIONS =====
window.toggleMode = function() {
    document.body.classList.toggle('light-mode');
};

window.toggleLangMenu = function() {
    const menu = document.getElementById('lang-menu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
};

window.setLang = function(l) {
    lang = l;
    localStorage.setItem('findly_lang', l);
    document.getElementById('lang-menu').style.display = 'none';
    location.reload();
};

window.quickSearch = function(q) {
    document.getElementById('search-input').value = q;
    runSearch();
};

window.quickFilter = function(type) {
    const input = document.getElementById('search-input');
    input.value = input.value + ' ' + type;
};

window.copyInviteLink = function() {
    const uid = localStorage.getItem('findly_uid') || 'guest';
    const link = location.origin + location.pathname + '?ref=' + uid;
    navigator.clipboard.writeText(link).then(() => {
        alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© âœ¨');
    }).catch(() => {
        alert('Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©:\n' + link);
    });
};

// ===== RENDER PRODUCT CARD =====
function renderProductCard(product) {
    const intel = product.intelligence || {};
    const priceIntel = intel.priceIntel || { score: 0, label: '', avgPrice: 0 };
    const trendIntel = intel.trendIntel || { trend: 'stable', strength: 0 };
    const techInd = intel.technicalIndicators || { rsi: 50, volatility: 'Ù…ØªÙˆØ³Ø·' };
    const trustIntel = intel.trustIntel || { score: 50, risk: 'Ù…ØªÙˆØ³Ø·', riskScore: 50 };
    const aiAdvice = intel.aiAdvice || { advice: '', confidence: 50, tip: '' };
    const personalityIntel = intel.personalityIntel || { type: 'smartHunter', matchScore: 50 };
    const verdict = intel.finalVerdict || { decision: 'WAIT', reason: '', confidence: 50, emoji: 'ğŸ¤–' };
    const dealQuality = intel.dealQuality || { score: priceIntel.score || 50 };
    const merchantTrust = intel.merchantTrust || null;
    const fakeDeal = intel.fakeDeal || null;
    
    const priceVal = parseFloat(String(product.price).replace(/[^\d.]/g, '')) || 0;
    const isOverBudget = userBudget > 0 && priceVal > userBudget;
    
    // Deal badge
    let dealClass = 'weak';
    let dealText = 'ØµÙÙ‚Ø© Ø¶Ø¹ÙŠÙØ©';
    if (dealQuality.score >= 70) { dealClass = 'strong'; dealText = 'ØµÙÙ‚Ø© Ù‚ÙˆÙŠØ©'; }
    else if (dealQuality.score >= 40) { dealClass = 'medium'; dealText = 'ØµÙÙ‚Ø© Ù…ØªÙˆØ³Ø·Ø©'; }
    
    // Decision class
    let decisionClass = 'wait';
    if (verdict.decision === 'BUY_NOW') decisionClass = 'buy';
    else if (verdict.decision === 'WAIT_PRICE_DROP') decisionClass = 'drop';
    else if (verdict.decision === 'OVERPRICED') decisionClass = 'overpriced';
    
    // Trend icon
    let trendIcon = 'â¡ï¸';
    if (trendIntel.trend === 'up') trendIcon = 'ğŸ“ˆ';
    else if (trendIntel.trend === 'down') trendIcon = 'ğŸ“‰';
    
    // RSI color
    let rsiClass = 'neutral';
    if (techInd.rsi < 30) rsiClass = 'oversold';
    else if (techInd.rsi > 70) rsiClass = 'overbought';
    
    // Personality
    const persType = personalityTypes[personalityIntel.type] || personalityTypes.smartHunter;
    
    // Trust progress
    const trustClass = trustIntel.score >= 70 ? 'high' : trustIntel.score >= 40 ? 'medium' : 'low';
    
    // Card HTML
    let html = `
    <div class="product-card deal-${dealClass}">
        <div class="deal-badge ${dealClass}">${dealText}</div>
        ${isOverBudget ? '<div class="deal-badge weak" style="left:12px;right:auto;">âš ï¸ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</div>' : ''}
        
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="switchTab(this, 'product-tab')">Ø§Ù„Ù…Ù†ØªØ¬</button>
                <button class="tab-btn" onclick="switchTab(this, 'analysis-tab')">Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
                <button class="tab-btn" onclick="switchTab(this, 'decision-tab')">Ø§Ù„Ù‚Ø±Ø§Ø±</button>
            </div>
            
            <!-- Tab 1: Product -->
            <div id="product-tab" class="tab-content active">
                <img src="${product.thumbnail || ''}" onerror="this.src='https://via.placeholder.com/200?text=No+Image'" alt="${product.title}">
                <h3>${product.title || 'â€”'}</h3>
                <div class="price">$${priceVal.toFixed(2)}</div>
                <div style="font-size:0.85rem; color:var(--text-muted); margin-bottom:10px;">
                    ğŸª ${product.source || 'Ù…ØªØ¬Ø±'}
                    ${merchantTrust?.verified ? '<span style="color:#10b981; margin-right:8px;">âœ“ Ù…ÙˆØ«Ù‚</span>' : ''}
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item value">
                        <div class="stat-value">${priceIntel.score}%</div>
                        <div class="stat-label">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±</div>
                    </div>
                    <div class="stat-item trust">
                        <div class="stat-value">${trustIntel.score}%</div>
                        <div class="stat-label">Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©</div>
                    </div>
                    <div class="stat-item deal">
                        <div class="stat-value">${dealQuality.score}%</div>
                        <div class="stat-label">Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙÙ‚Ø©</div>
                    </div>
                </div>
                
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="action-btn watch-btn" onclick='watchProduct(${JSON.stringify(product).replace(/'/g, "\\'")})'>ğŸ”” Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³Ø¹Ø±</button>
                    ${product.link ? `<a class="action-btn buy-now" href="${API}/go?url=${encodeURIComponent(product.link)}" target="_blank">ğŸ›’ Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</a>` : '<button class="action-btn buy-now" disabled style="opacity:0.5">Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ØªÙˆÙØ±</button>'}
                </div>
            </div>
            
            <!-- Tab 2: Analysis -->
            <div id="analysis-tab" class="tab-content">
                <div class="analysis-section">
                    <h4>ğŸ’° ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±</h4>
                    <div class="analysis-row">
                        <span>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØµÙÙ‚Ø©</span>
                        <span>${priceIntel.score}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${trustClass}" style="width:${priceIntel.score}%"></div>
                    </div>
                    <div class="analysis-row" style="font-size:0.8rem;">
                        <span>${priceIntel.label || 'Ø§Ù„Ù‚ÙŠÙ…Ø©'}</span>
                        <span>Ù…ØªÙˆØ³Ø·: $${priceIntel.avgPrice?.toFixed(2) || '---'}</span>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h4>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚</h4>
                    <div class="tech-grid">
                        <div class="tech-item">
                            <div class="tech-label">Ø§Ù„Ø§ØªØ¬Ø§Ù‡</div>
                            <div class="tech-value">${trendIcon} ${trendIntel.trend === 'up' ? 'ØµØ¹ÙˆØ¯' : trendIntel.trend === 'down' ? 'Ù‡Ø¨ÙˆØ·' : 'Ù…Ø³ØªÙ‚Ø±'}</div>
                        </div>
                        <div class="tech-item">
                            <div class="tech-label">Ø§Ù„Ù‚ÙˆØ©</div>
                            <div class="tech-value">${trendIntel.strength}%</div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h4>ğŸ“ˆ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙÙ†ÙŠØ©</h4>
                    <div class="tech-grid">
                        <div class="tech-item">
                            <div class="tech-label">RSI (Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ©)</div>
                            <div class="tech-value ${rsiClass}">${techInd.rsi?.toFixed(1) || '50'}</div>
                        </div>
                        <div class="tech-item">
                            <div class="tech-label">Ø§Ù„ØªÙ‚Ù„Ø¨</div>
                            <div class="tech-value neutral">${techInd.volatility || 'Ù…ØªÙˆØ³Ø·'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h4>ğŸ›¡ï¸ Ø§Ù„Ø«Ù‚Ø© ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±</h4>
                    <div class="analysis-row">
                        <span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©</span>
                        <span>${trustIntel.score}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${trustClass}" style="width:${trustIntel.score}%"></div>
                    </div>
                    <div class="analysis-row" style="color: ${trustIntel.riskScore > 50 ? '#ef4444' : '#10b981'};">
                        <span>Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©</span>
                        <span>${trustIntel.risk || 'Ù…ØªÙˆØ³Ø·'}</span>
                    </div>
                </div>
                
                ${fakeDeal?.isSuspicious ? `
                <div class="fake-deal-alert">
                    <div class="fake-deal-header">
                        <span class="fake-deal-icon">ğŸš¨</span>
                        <span class="fake-deal-title">ØªÙ†Ø¨ÙŠÙ‡: ØµÙÙ‚Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø©!</span>
                    </div>
                    <ul class="fake-deal-reasons">
                        ${fakeDeal.reasons?.map(r => `<li>${r}</li>`).join('') || ''}
                    </ul>
                </div>
                ` : ''}
            </div>
            
            <!-- Tab 3: Decision -->
            <div id="decision-tab" class="tab-content">
                <div class="ai-decision ${decisionClass}">
                    <div class="ai-decision-icon">${verdict.emoji || 'ğŸ¤–'}</div>
                    <div class="ai-decision-title">
                        ${verdict.decision === 'BUY_NOW' ? 'Ù‚Ø±Ø§Ø± Ø°ÙƒÙŠ: Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†' :
                          verdict.decision === 'WAIT' ? 'ÙŠÙØ¶Ù„ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' :
                          verdict.decision === 'WAIT_PRICE_DROP' ? 'Ø§Ù†ØªØ¸Ø± Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø³Ø¹Ø±' : 'Ø§Ù„Ø³Ø¹Ø± Ù…Ø±ØªÙØ¹'}
                    </div>
                    <div class="ai-decision-reason">${verdict.reason || ''}</div>
                    ${verdict.savingsPercent ? `<div style="margin-top:8px; font-size:0.85rem;">ğŸ’° Ø§Ù„ØªÙˆÙÙŠØ±: <strong>${verdict.savingsPercent}%</strong></div>` : ''}
                    ${verdict.bestStore ? `<div style="font-size:0.85rem;">ğŸª Ø£ÙØ¶Ù„ Ù…ØªØ¬Ø±: <strong>${verdict.bestStore}</strong>${verdict.bestPrice ? ` - $${verdict.bestPrice}` : ''}</div>` : ''}
                </div>
                
                ${aiAdvice.advice ? `
                <div class="analysis-section" style="border-color: rgba(139,92,246,0.3);">
                    <h4>ğŸ¤– Ù†ØµÙŠØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h4>
                    <div style="background:rgba(255,255,255,0.03); border-radius:10px; padding:12px; margin-bottom:10px;">
                        ${aiAdvice.advice}
                    </div>
                    <div class="analysis-row">
                        <span>Ø§Ù„Ø«Ù‚Ø©</span>
                        <span>${aiAdvice.confidence}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill high" style="width:${aiAdvice.confidence}%"></div>
                    </div>
                    ${aiAdvice.tip ? `<div style="margin-top:10px; font-size:0.85rem; color:var(--text-muted);">ğŸ’¡ ${aiAdvice.tip}</div>` : ''}
                </div>
                ` : ''}
                
                <div class="personality-badge">
                    <div class="personality-icon">${persType.icon}</div>
                    <div class="personality-info">
                        <h5>${persType.name}</h5>
                        <p>${persType.desc} â€¢ ØªØ·Ø§Ø¨Ù‚ ${personalityIntel.matchScore}%</p>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <div class="analysis-row">
                        <span>Ø«Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø±</span>
                        <span>${verdict.confidence}%</span>
                    </div>
                    <div class="progress-bar" style="height:8px;">
                        <div class="progress-fill high" style="width:${verdict.confidence}%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>`;
    
    return html;
}

window.switchTab = function(btn, tabId) {
    const card = btn.closest('.tabs-container');
    card.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    card.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(tabId)?.classList.add('active');
};

window.watchProduct = function(product) {
    watchProductData = product;
    document.getElementById('watch-product-name').textContent = product.title;
    document.getElementById('watch-email').value = '';
    toggleWatchModal();
};

// ===== SEARCH FUNCTION =====
async function runSearch() {
    const q = document.getElementById('search-input').value.trim();
    const status = document.getElementById('status');
    const resultsBox = document.getElementById('results');
    const personalityContainer = document.getElementById('personality-container');
    
    if (!q) return;
    
    status.style.display = 'block';
    status.innerText = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
    resultsBox.innerHTML = '';
    personalityContainer.style.display = 'none';
    
    try {
        let token = null;
        try { 
            if (window.getAuthToken) token = await window.getAuthToken(); 
        } catch (e) {}
        
        const headers = { 'Content-Type': 'application/json' };
        if (token) headers['Authorization'] = 'Bearer ' + token;
        
        const res = await fetch(API + '/search?q=' + encodeURIComponent(q) + '&lang=' + lang, { headers });
        const data = await res.json().catch(() => ({}));
        
        if (res.status === 429 || data.error === 'ENERGY_EMPTY') {
            status.innerHTML = '<div class="alert-box error">âš ï¸ Ø§Ø³ØªÙ†ÙØ¯Øª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©! <button onclick="openUpgrade()" style="background:var(--primary); color:white; border:none; padding:8px 16px; border-radius:10px; cursor:pointer; margin-right:10px;">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¢Ù†</button></div>';
            return;
        }
        
        if (!res.ok) throw new Error(data.message || 'Server error: ' + res.status);
        status.style.display = 'none';
        
        if (!data.results || !data.results.length) {
            status.style.display = 'block';
            status.innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬';
            return;
        }
        
        // Update energy
        if (data.energy) {
            document.getElementById('energy-count').textContent = 
                typeof data.energy.left === 'number' ? data.energy.left : data.energy.left;
        }
        
        // Show personality
        if (data.personality) {
            const pType = personalityTypes[data.personality.type] || personalityTypes.smartHunter;
            personalityContainer.innerHTML = `
                <div class="personality-badge">
                    <div class="personality-icon">${pType.icon}</div>
                    <div class="personality-info">
                        <h5>${pType.name}</h5>
                        <p>${pType.desc}</p>
                    </div>
                </div>`;
            personalityContainer.style.display = 'block';
        }
        
        // Render products
        data.results.forEach(product => {
            const card = document.createElement('div');
            card.innerHTML = renderProductCard(product);
            resultsBox.appendChild(card.firstElementChild);
        });
        
    } catch (e) {
        status.style.display = 'block';
        status.innerHTML = '<div class="alert-box error">âŒ Ø®Ø·Ø£: ' + e.message + '</div>';
    }
}

window.runSearch = runSearch;

window.openUpgrade = async function() {
    const uid = localStorage.getItem('findly_uid') || 'guest_' + Date.now();
    try {
        const res = await fetch(API + '/create-payment', { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify({ uid: uid }) 
        });
        const data = await res.json();
        if (data.url) window.open(data.url, '_blank');
        else alert('âš ï¸ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯ÙØ¹ ØºÙŠØ± Ù…ØªØ§Ø­Ø©');
    } catch (e) { 
        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯ÙØ¹'); 
    }
};

// ===== INIT =====
window.onload = function() {
    updateGreeting();
    initVoiceSearch();
    
    // Check for upgrade success
    if (location.href.includes('upgrade-success')) {
        localStorage.setItem('findly_pro', 'true');
        alert('ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨Ù†Ø¬Ø§Ø­!');
    }
};

// Close lang menu on click outside
document.addEventListener('click', function(e) {
    const langMenu = document.getElementById('lang-menu');
    if (!e.target.closest('.header-tools')) {
        langMenu.style.display = 'none';
    }
});
</script>
</body>
</html>
