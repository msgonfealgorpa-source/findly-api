<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findly AI | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main-purple: #6366f1; --dark-bg: #0f172a; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--dark-bg); color: white; margin: 0; overflow-x: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¨Ø­Ø« (Ù…Ù† ÙˆØ­ÙŠ ØµÙˆØ±Ùƒ) */
        .hero-section {
            background: linear-gradient(180deg, var(--main-purple) 0%, #4f46e5 100%);
            border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;
            padding: 40px 20px 80px; position: relative; z-index: 10;
        }
        .search-container {
            background: white; border-radius: 100px; display: flex; align-items: center;
            padding: 5px; max-width: 500px; margin: 30px auto 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .search-input { flex: 1; border: none; outline: none; padding: 12px 20px; color: #333; font-weight: bold; font-size: 16px; background: transparent; }
        .search-btn { background: var(--main-purple); color: white; border-radius: 100px; padding: 12px 25px; font-weight: 900; cursor: pointer; border: none; transition: 0.3s; }
        
        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù‚Ø¦Ø§Øª (Cat-Grid) - ØªÙ…Øª Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        .cat-grid { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; 
            max-width: 500px; margin: -40px auto 0; padding: 0 20px; position: relative; z-index: 20; 
        }
        .cat-card { 
            background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; 
            padding: 20px; text-align: center; font-weight: bold; cursor: pointer; transition: 0.3s; 
        }
        .cat-card:hover { transform: translateY(-5px); background: var(--main-purple); border-color: white; }
        .pro-badge { background: #fbbf24; color: black; font-size: 9px; padding: 2px 6px; border-radius: 5px; margin-bottom: 5px; display: inline-block; }

        /* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ */
        .product-card { 
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 30px; padding: 20px; margin-bottom: 20px; animation: slideUp 0.4s ease;
        }
        .ai-recommendation-box {
            background: rgba(99, 102, 241, 0.15); border-right: 4px solid #fbbf24;
            padding: 12px; border-radius: 15px; margin-top: 10px; font-size: 12px; color: #d1d5db;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .mic-active { color: #ef4444 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
    </style>
</head>
<body>

<section id="app-view">
    <div class="hero-section text-center">
        <header class="flex justify-between items-center max-w-5xl mx-auto mb-8">
            <div class="text-2xl font-black italic">Findly<span class="text-yellow-400">.</span></div>
            <div id="greeting" class="bg-white/10 px-4 py-1 rounded-full text-[10px] border border-white/10">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</div>
        </header>

        <h1 class="text-4xl font-black mb-4">Ø§Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø®ÙŠØ§Ø±Ùƒ<br>Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ø¨Ø°ÙƒØ§Ø¡</h1>
        <p class="text-xs opacity-70 mb-8 max-w-xs mx-auto">Ù†Ø­Ù† Ù†Ø­Ù„Ù„ Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù†Ø¹Ø·ÙŠÙƒ Ø§Ù„Ø£ÙØ¶Ù„ Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©.</p>
        
        <div class="search-container">
            <button id="mic-btn" onclick="startVoice()" class="p-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-20a3 3 0 00-3 3v8a3 3 0 006 0V5a3 3 0 00-3-3z" />
                </svg>
            </button>
            <input type="text" id="search-q" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ´ØªØ±ÙŠØŸ" class="search-input">
            <button onclick="runSmartSearch()" class="search-btn">Ø¨Ø­Ø« Ø°ÙƒÙŠ</button>
        </div>
    </div>

    <div class="cat-grid">
        <div onclick="quickSearch('Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø³Ù„ÙƒÙŠØ©')" class="cat-card">ğŸ§ Ø³Ù…Ø§Ø¹Ø§Øª</div>
        <div onclick="quickSearch('Ù‡ÙˆØ§ØªÙ Ø°ÙƒÙŠØ©')" class="cat-card">ğŸ“± Ù‡ÙˆØ§ØªÙ</div>
        <div class="cat-card opacity-60">
            <span class="pro-badge">Ù‚Ø±ÙŠØ¨Ø§Ù‹</span><br>ğŸ”’ Ø§Ø®ØªÙŠØ§Ø± Ù…ØªÙ‚Ø¯Ù…
        </div>
        <div class="cat-card opacity-60">
            <span class="pro-badge">Ù‚Ø±ÙŠØ¨Ø§Ù‹</span><br>ğŸ”’ Ù…Ù‚Ø§Ø±Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        </div>
        <div onclick="quickSearch('Ù„Ø§Ø¨ØªÙˆØ¨')" class="cat-card">ğŸ’» Ù„Ø§Ø¨ØªÙˆØ¨</div>
        <div onclick="quickSearch('Ø³Ø§Ø¹Ø§Øª Ø°ÙƒÙŠØ©')" class="cat-card">âŒš Ø³Ø§Ø¹Ø§Øª</div>
    </div>

    <main class="max-w-4xl mx-auto mt-16 px-6 pb-20">
        <div id="status-msg" class="text-center font-bold text-indigo-400 mb-6"></div>
        <div id="results"></div>
    </main>
</section>

<script>
    const API_BASE = "https://findly-api.onrender.com";

    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ
    function startVoice() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ar-SA';
        recognition.onstart = () => document.getElementById('mic-btn').classList.add('mic-active');
        recognition.onend = () => document.getElementById('mic-btn').classList.remove('mic-active');
        recognition.onresult = (e) => {
            document.getElementById('search-q').value = e.results[0][0].transcript;
            runSmartSearch();
        };
        recognition.start();
    }

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù€ AI Ù„ØªÙˆÙ„ÙŠØ¯ Ø³Ø¨Ø¨ Ø§Ù„ØªØ±Ø´ÙŠØ­
    function getAIReason(item, index) {
        const rating = parseFloat(item.rating) || 4.0;
        if (index === 0) return "Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„ Ù„Ù€ Findly: ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… ÙˆØ£ÙØ¶Ù„ Ø³Ø¹Ø± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹.";
        if (rating >= 4.6) return "Ù…Ø±Ø´Ø­ Ø¨Ù‚ÙˆØ© Ø¨Ø³Ø¨Ø¨ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØµÙ†ÙŠØ¹ Ø§Ù„Ø¹Ø§Ù„ÙŠØ© ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø¬Ø¯Ø§Ù‹.";
        return "Ø®ÙŠØ§Ø± Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ù…Ù…ØªØ§Ø² ÙŠÙˆÙØ± Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ù…ÙˆØ«ÙˆÙ‚Ø©.";
    }

    async function runSmartSearch() {
        const query = document.getElementById('search-q').value.trim();
        const resultsDiv = document.getElementById('results');
        const status = document.getElementById('status-msg');
        
        if(!query) return;

        status.innerText = "â³ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶...";
        resultsDiv.innerHTML = '';

        try {
            const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            
            if (!data.top || data.top.length === 0) {
                status.innerText = "âŒ Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªÙ†Ø§Ø³Ø¨ Ø°ÙƒØ§Ø¡Ù†Ø§ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹.";
                return;
            }

            status.innerText = `âœ… ÙˆØ¬Ø¯Ù†Ø§ Ø£ÙØ¶Ù„ ${data.top.length} Ø®ÙŠØ§Ø±Ø§Øª Ù„Ùƒ:`;

            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
            const sorted = data.top.sort((a,b) => (parseFloat(b.rating)||0) - (parseFloat(a.rating)||0));

            sorted.forEach((item, index) => {
                const productLink = item.link.startsWith('http') ? item.link : `https://${item.link}`;
                const card = `
                <div class="product-card">
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div class="relative">
                            <img src="${item.image}" class="w-28 h-28 object-contain bg-white rounded-3xl p-3 shadow-lg">
                            <span class="absolute -top-2 -right-2 bg-indigo-600 text-[10px] px-2 py-1 rounded-full">#${index+1}</span>
                        </div>
                        <div class="flex-1 text-right w-full">
                            <h3 class="font-bold text-sm mb-1">${item.name}</h3>
                            <div class="text-yellow-400 text-xs font-bold mb-2">â­ ${item.rating || '4.5'} <span class="text-gray-500 text-[10px] mr-2">(+500 Ù…Ø±Ø§Ø¬Ø¹Ø©)</span></div>
                            <div class="ai-recommendation-box">
                                ğŸ’¡ <strong>Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ø§ Ø§Ù„Ø£ÙØ¶Ù„ØŸ</strong><br>
                                ${getAIReason(item, index)}
                            </div>
                        </div>
                        <div class="text-center w-full md:w-auto">
                            <div class="text-2xl font-black text-indigo-400 mb-3">${item.price}</div>
                            <a href="${productLink}" target="_blank" rel="noopener noreferrer" 
                               class="bg-indigo-600 text-white px-8 py-3 rounded-2xl font-black text-xs block shadow-lg hover:bg-indigo-500 transition-all active:scale-95">
                                Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù† ğŸ›’
                            </a>
                        </div>
                    </div>
                </div>`;
                resultsDiv.insertAdjacentHTML('beforeend', card);
            });
        } catch (e) { status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹."; }
    }

    function quickSearch(v) {
        document.getElementById('search-q').value = v;
        runSmartSearch();
    }
</script>
</body>
</html>
