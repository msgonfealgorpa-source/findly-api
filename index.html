<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findly AI - Smart Shopping Search</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø«ÙŠÙ…Ø§Øª (Dark/Light Mode) */
        body.dark-mode { --bg-color: #0f172a; --text-color: #f8fafc; --card-bg: rgba(255,255,255,0.05); --input-bg: #ffffff; }
        body.light-mode { --bg-color: #f1f5f9; --text-color: #1e293b; --card-bg: rgba(255,255,255,0.8); --input-bg: #ffffff; }

        body { 
            font-family: 'Cairo', 'Inter', sans-serif; 
            background: var(--bg-color);
            color: var(--text-color);
            transition: all 0.4s ease;
            min-height: 100vh;
        }

        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .gradient-header { background: var(--primary-gradient); }

        /* Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ÙŠÙ†Ø¨Ø¶ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
        .recording {
            animation: pulse 1.5s infinite;
            color: #ef4444 !important;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
    </style>
</head>

<body class="dark-mode">

<header class="gradient-header p-8 rounded-b-[3.5rem] shadow-2xl text-white">
    <div class="max-w-5xl mx-auto">
        
        <div class="flex justify-between items-center mb-10">
            <h1 class="text-4xl font-black tracking-tighter">Findly</h1>
            
            <div class="flex items-center gap-4">
                <button id="theme-toggle" class="p-2.5 bg-white/10 rounded-2xl hover:bg-white/20 transition-all shadow-inner">
                    <span id="theme-icon" class="text-xl">ğŸŒ™</span>
                </button>

                <select id="lang-select" class="bg-white/10 border border-white/20 text-white text-sm rounded-2xl p-2.5 outline-none backdrop-blur-md cursor-pointer">
                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="en">English</option>
                    <option value="fr">FranÃ§ais</option>
                    <option value="it">Italiano</option>
                    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="zh">ä¸­æ–‡</option>
                </select>
            </div>
        </div>

        <div class="text-center mb-10">
            <span class="bg-black/20 px-4 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest inline-block mb-3">Powered by Findly AI</span>
            <p class="text-xl font-light opacity-90 leading-relaxed" id="subtitle"></p>
        </div>

        <div class="relative max-w-2xl mx-auto group">
            <button id="voice-btn" class="absolute inset-y-0 ltr:left-4 rtl:right-4 text-gray-400 hover:text-purple-600 transition-colors z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                </svg>
            </button>

            <input id="search-input" type="text" autocomplete="off"
                class="w-full py-5 ltr:pl-14 ltr:pr-32 rtl:pr-14 rtl:pl-32 rounded-[2rem] text-gray-900 shadow-2xl outline-none text-lg focus:ring-4 ring-purple-500/30 transition-all">

            <button id="search-btn"
                class="absolute inset-y-2.5 ltr:right-2.5 rtl:left-2.5 bg-purple-700 hover:bg-purple-800 text-white px-8 rounded-full font-bold transition-all active:scale-95 shadow-lg">
                </button>
        </div>

        <p class="text-center text-sm mt-5 opacity-80" id="hint"></p>
        
        <div class="mt-8 grid grid-cols-3 md:grid-cols-5 gap-3 max-w-3xl mx-auto text-sm text-white" id="categories"></div>
    </div>
</header>

<main class="max-w-6xl mx-auto px-6 mt-16 pb-32">
    <div class="mb-10 border-b border-white/10 pb-6">
        <h2 class="text-3xl font-bold" id="results-title"></h2>
        <p class="text-md opacity-60 mt-2" id="status"></p>
    </div>
    
    <div id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        </div>
</main>

<script>
/* -----------------------------------------------------------
   1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø©
----------------------------------------------------------- */
const translations = {
    ar: { subtitle: "Ø§Ø¨Ø­Ø« Ø¨Ø·Ø±ÙŠÙ‚ØªÙƒØŒ ÙˆØ§ØªØ±Ùƒ Ø¹Ù„Ù‰ Findly Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ©.", search: "Ø¨Ø­Ø«", buy: "Ø´Ø±Ø§Ø¡", searching: "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...", noResults: "âŒ Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ØŒ Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰.", error: "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", found: (n) => `ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${n} Ù†ØªØ§Ø¦Ø¬`, minChar: "âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", cats: ["ğŸ“± Ù‡ÙˆØ§ØªÙ", "ğŸ§ Ø³Ù…Ø§Ø¹Ø§Øª", "âŒš Ø³Ø§Ø¹Ø§Øª", "ğŸ§¢ Ù…Ù„Ø§Ø¨Ø³", "ğŸ”Œ ØªÙ‚Ù†ÙŠØ©"] },
    en: { subtitle: "Search your way and let Findly handle the smart comparison.", search: "Search", buy: "Buy", searching: "â³ Searching...", noResults: "âŒ No results, try other words.", error: "âš ï¸ Connection error", found: (n) => `ğŸ” Found ${n} results`, minChar: "âš ï¸ Type at least 3 characters", cats: ["ğŸ“± Phones", "ğŸ§ Audio", "âŒš Watches", "ğŸ§¢ Fashion", "ğŸ”Œ Tech"] },
    fr: { subtitle: "Cherchez et laissez Findly gÃ©rer la comparaison.", search: "Chercher", buy: "Acheter", searching: "â³ Recherche...", noResults: "âŒ Aucun rÃ©sultat.", error: "âš ï¸ Erreur", found: (n) => `ğŸ” ${n} rÃ©sultats`, minChar: "âš ï¸ 3 caractÃ¨res minimum", cats: ["ğŸ“± Mobiles", "ğŸ§ Audio", "âŒš Montres", "ğŸ§¢ Mode", "ğŸ”Œ Tech"] },
    it: { subtitle: "Cerca e lascia que Findly gestisca il confronto.", search: "Cerca", buy: "Acquista", searching: "â³ Ricerca...", noResults: "âŒ Nessun risultato.", error: "âš ï¸ Errore", found: (n) => `ğŸ” ${n} risultati`, minChar: "âš ï¸ Minimo 3 caratteri", cats: ["ğŸ“± Telefoni", "ğŸ§ Audio", "âŒš Orologi", "ğŸ§¢ Moda", "ğŸ”Œ Tech"] },
    ru: { subtitle: "Ğ˜Ñ‰Ğ¸Ñ‚Ğµ, Ğ° Findly ÑĞ´ĞµĞ»Ğ°ĞµÑ‚ ÑƒĞ¼Ğ½Ğ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ° Ğ²Ğ°Ñ.", search: "ĞŸĞ¾Ğ¸ÑĞº", buy: "ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ", searching: "â³ ĞŸĞ¾Ğ¸ÑĞº...", noResults: "âŒ ĞĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ².", error: "âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ°", found: (n) => `ğŸ” ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾: ${n}`, minChar: "âš ï¸ ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 3 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°", cats: ["ğŸ“± Ğ¢ĞµĞ».", "ğŸ§ ĞÑƒĞ´Ğ¸Ğ¾", "âŒš Ğ§Ğ°ÑÑ‹", "ğŸ§¢ ĞœĞ¾Ğ´Ğ°", "ğŸ”Œ Ğ¢ĞµÑ…."] },
    zh: { subtitle: "ä»¥æ‚¨çš„æ–¹å¼æœç´¢ï¼Œè®© Findly è¿›è¡Œæ™ºèƒ½æ¯”è¾ƒã€‚", search: "æœç´¢", buy: "è´­ä¹°", searching: "â³ æ­£åœ¨æœç´¢...", noResults: "âŒ æ— ç»“æœ", error: "âš ï¸ é”™è¯¯", found: (n) => `ğŸ” æ‰¾åˆ° ${n} ä¸ªç»“æœ`, minChar: "âš ï¸ è‡³å°‘è¾“å…¥3ä¸ªå­—ç¬¦", cats: ["ğŸ“± æ‰‹æœº", "ğŸ§ è€³æœº", "âŒš æ‰‹è¡¨", "ğŸ§¢ æœè£…", "ğŸ”Œ ç§‘æŠ€"] }
};

// Ø®Ø±ÙŠØ·Ø© ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ÙŠØ© (Normalization)
const intentMap = {
    "Ø§ÙŠÙÙˆÙ†": "iphone", "Ø¢ÙŠÙÙˆÙ†": "iphone", "Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬": "samsung", "Ø³Ù…Ø§Ø¹Ø©": "headphone", "Ø³Ù…Ø§Ø¹Ø§Øª": "headphone",
    "Ø³Ø§Ø¹Ø©": "watch", "Ø³Ø§Ø¹Ø§Øª": "watch", "Ù‡Ø§ØªÙ": "phone", "Ø¬ÙˆØ§Ù„": "phone", "Ù„Ø§Ø¨ ØªÙˆØ¨": "laptop"
};

/* -----------------------------------------------------------
   2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (Ø§Ù„Ù„ØºØ©ØŒ Ø§Ù„Ø«ÙŠÙ…ØŒ Ø§Ù„ØµÙˆØª)
----------------------------------------------------------- */
let currentLang = localStorage.getItem('userLang') || (translations[navigator.language.split('-')[0]] ? navigator.language.split('-')[0] : 'ar');

function updateUI(lang) {
    currentLang = lang;
    localStorage.setItem('userLang', lang);
    const T = translations[lang];
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.documentElement.lang = lang;
    
    document.getElementById("subtitle").textContent = T.subtitle;
    document.getElementById("search-btn").textContent = T.search;
    document.getElementById("results-title").textContent = T.search; 
    document.getElementById("categories").innerHTML = T.cats.map(c => `<div class="glass py-3 rounded-2xl text-center cursor-pointer font-medium">${c}</div>`).join("");
}

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…
const themeToggle = document.getElementById('theme-toggle');
const themeIcon = document.getElementById('theme-icon');
function toggleTheme() {
    const isDark = document.body.classList.toggle('dark-mode');
    document.body.classList.toggle('light-mode', !isDark);
    themeIcon.textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
}
if (localStorage.getItem('theme') === 'light') toggleTheme();
themeToggle.onclick = toggleTheme;

/* -----------------------------------------------------------
   3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ (Smart Search Logic)
----------------------------------------------------------- */
const searchBtn = document.getElementById("search-btn");
const searchInput = document.getElementById("search-input");
const resultsDiv = document.getElementById("results");
const statusText = document.getElementById("status");

async function search() {
    const T = translations[currentLang];
    let query = searchInput.value.trim().toLowerCase();

    // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø©
    if (query.length < 3) {
        statusText.textContent = T.minChar;
        statusText.classList.add("text-yellow-500");
        return;
    }

    // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ÙŠØ© (Normalization)
    for (let key in intentMap) {
        if (query.includes(key)) { query = query.replace(key, intentMap[key]); break; }
    }

    // 3. ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    searchBtn.disabled = true;
    const originalText = T.search;
    searchBtn.textContent = "...";
    searchBtn.classList.add("btn-disabled");
    statusText.textContent = T.searching;
    statusText.classList.remove("text-yellow-500");
    resultsDiv.innerHTML = "";

    try {
        const res = await fetch(`https://findly-api.onrender.com/search?q=${encodeURIComponent(query)}`);
        const data = await res.json();

        searchBtn.disabled = false;
        searchBtn.textContent = originalText;
        searchBtn.classList.remove("btn-disabled");

        if (!data.top || data.top.length === 0) {
            statusText.textContent = T.noResults;
            return;
        }

        statusText.textContent = T.found(data.top.length);

        data.top.forEach(item => {
            resultsDiv.innerHTML += `
                <div class="glass rounded-[2.5rem] overflow-hidden group">
                    <div class="relative overflow-hidden h-52">
                        <img src="${item.image}" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700">
                        <div class="absolute top-4 right-4 bg-black/60 backdrop-blur-md text-white text-xs px-3 py-1 rounded-full">â˜… ${item.rating || '4.2'}</div>
                    </div>
                    <div class="p-6">
                        <h3 class="font-bold text-lg mb-3 truncate">${item.name}</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-2xl font-black text-purple-500">${item.price || "â€”"}</span>
                            <a href="${item.link}" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2.5 rounded-2xl text-sm font-bold transition shadow-lg shadow-purple-500/20">${T.buy}</a>
                        </div>
                    </div>
                </div>`;
        });
    } catch {
        searchBtn.disabled = false;
        searchBtn.textContent = originalText;
        searchBtn.classList.remove("btn-disabled");
        statusText.textContent = T.error;
    }
}

/* -----------------------------------------------------------
   4. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ ÙˆØ§Ù„Ø¨Ø¯Ø§ÙŠØ©
----------------------------------------------------------- */
if ('webkitSpeechRecognition' in window) {
    const recognition = new webkitSpeechRecognition();
    const voiceBtn = document.getElementById('voice-btn');
    
    voiceBtn.onclick = () => {
        recognition.lang = currentLang;
        recognition.start();
        voiceBtn.classList.add('recording');
    };

    recognition.onresult = (e) => {
        searchInput.value = e.results[0][0].transcript;
        voiceBtn.classList.remove('recording');
        search();
    };
    recognition.onend = () => voiceBtn.classList.remove('recording');
}

// ØªØ´ØºÙŠÙ„
searchBtn.onclick = search;
searchInput.onkeypress = (e) => e.key === "Enter" && search();
document.getElementById('lang-select').value = currentLang;
document.getElementById('lang-select').onchange = (e) => updateUI(e.target.value);
updateUI(currentLang);

</script>
</body>
</html>
