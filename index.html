const API_BASE = "https://findly-api.onrender.com";

    async function runSmartSearch() {
        const queryField = document.getElementById('search-q');
        const query = queryField.value.trim();
        const resultsDiv = document.getElementById('results');
        const status = document.getElementById('status-msg');
        const searchBtn = document.getElementById('main-search-btn');

        if(!query) return;

        status.innerText = "⏳ جاري البحث في AliExpress... انتظر 20 ثانية";
        resultsDiv.innerHTML = '';
        searchBtn.disabled = true;
        searchBtn.innerText = "جاري البحث...";

        try {
            // طلب البيانات
            const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            
            searchBtn.disabled = false;
            searchBtn.innerText = "بحث ذكي";

            if (!data.success || !data.top || data.top.length === 0) {
                status.innerHTML = "<span class='text-red-400'>❌ لم نجد نتائج حالياً، جرب كلمة أخرى.</span>";
                return;
            }

            status.innerText = "";
            data.top.forEach(item => {
                const card = `
                    <div class="product-card animate-fade-in shadow-xl">
                        <img src="${item.image}" class="w-20 h-20 object-contain bg-white rounded-3xl p-2 shadow-md">
                        <div class="flex-grow">
                            <h3 class="font-bold text-sm line-clamp-2">${item.name}</h3>
                            <div class="text-yellow-400 text-xs font-bold mt-1">⭐ ${item.rating}</div>
                        </div>
                        <div class="text-center min-w-[80px]">
                            <div class="text-indigo-400 font-black mb-2 text-sm">${item.price} ${item.currency}</div>
                            <a href="${item.link}" target="_blank" class="bg-indigo-500 px-4 py-2 rounded-xl text-[10px] font-black block shadow-lg hover:bg-indigo-400 transition">شراء</a>
                        </div>
                    </div>`;
                resultsDiv.insertAdjacentHTML('beforeend', card);
            });
        } catch (error) {
            status.innerText = "❌ السيرفر لا يستجيب، تأكد من تشغيل Render.";
            searchBtn.disabled = false;
            searchBtn.innerText = "بحث ذكي";
        }
    }
