<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Findly â€“ Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø°ÙƒÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4F46E5; 
            --bg: #F8FAFC; 
            --text: #1e293b; 
            --card: #ffffff; 
            --border: #e2e8f0;
        }
        .dark-mode {
            --bg: #0F172A; --text: #f1f5f9; --card: #1e293b; --border: #334155;
        }
        body { background-color: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; padding: 0; transition: 0.3s; overflow-x: hidden; }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--card); box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 1.2rem; font-weight: 900; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .controls { display: flex; gap: 10px; align-items: center; }
        select.lang-switch { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 5px; border-radius: 8px; font-size: 0.85rem; outline: none; }
        
        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .hero { text-align: center; padding: 2rem 1rem; }
        h1 { font-size: 1.5rem; margin-bottom: 10px; line-height: 1.4; }
        .sub-text { font-size: 0.9rem; opacity: 0.8; margin-bottom: 2rem; }
        
        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
        .search-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto 2rem; }
        .search-box { width: 100%; padding: 15px 20px; padding-inline-end: 50px; border-radius: 15px; border: 1px solid transparent; background: var(--card); box-shadow: 0 4px 15px rgba(0,0,0,0.05); font-size: 1rem; color: var(--text); outline: none; box-sizing: border-box; }
        .search-btn { position: absolute; top: 50%; transform: translateY(-50%); inset-inline-end: 15px; color: var(--primary); background: none; border: none; font-size: 1.2rem; cursor: pointer; }
        
        /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
        .categories { display: flex; justify-content: center; gap: 15px; margin-bottom: 2rem; flex-wrap: wrap; }
        .cat-item { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; min-width: 70px; }
        .cat-icon { width: 50px; height: 50px; background: var(--card); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .cat-item span { font-size: 0.8rem; font-weight: 600; }
        
        /* Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .results-area { padding: 0 15px 40px; max-width: 800px; margin: 0 auto; }
        .advisor-card { background: linear-gradient(135deg, #4F46E5, #06B6D4); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; display: none; font-size: 0.9rem; line-height: 1.6; }
        .product-card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 10px; }
        .btn-amazon { background: #FF9900; color: white; text-decoration: none; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 0.9rem; display: block; margin-top: 5px; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù‚ÙÙ„Ø© */
        .locked-area { display: flex; justify-content: center; gap: 10px; margin-top: 2rem; opacity: 0.5; padding-bottom: 2rem; }
        .locked-btn { border: 1px solid var(--text); padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; background: none; color: var(--text); display: flex; align-items: center; gap: 5px; }

        .loader { display: inline-block; animation: spin 1s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header>
        <div class="logo"><i class="fa-solid fa-robot"></i> Findly</div>
        <div class="controls">
            <select class="lang-switch" onchange="changeLanguage(this.value)">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
                <option value="fr">FranÃ§ais</option>
                <option value="tr">TÃ¼rkÃ§e</option>
                <option value="es">EspaÃ±ol</option>
            </select>
            <i class="fa-solid fa-moon" onclick="toggleTheme()" style="font-size: 1.2rem; cursor: pointer;"></i>
        </div>
    </header>

    <main class="hero">
        <h1 id="main-title">Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù…Ø¯Ø±ÙˆØ³ Ø¨Ø°ÙƒØ§Ø¡</h1>
        <p class="sub-text" id="main-sub">Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¨Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ØŒ ÙˆØ³Ø£Ø­Ù„Ù„ Ù„Ùƒ Ø§Ù„Ø³ÙˆÙ‚ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙØ¶Ù„ 3 Ø®ÙŠØ§Ø±Ø§Øª ØªÙ†Ø§Ø³Ø¨Ùƒ Ø¨Ø¯Ù‚Ø©.</p>

        <div class="search-container">
            <input type="text" class="search-box" id="search-input" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ S24...">
            <button class="search-btn" onclick="handleSearch()"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>

        <div class="categories">
            <div class="cat-item" onclick="quickSearch('Ù‡ÙˆØ§ØªÙ')">
                <div class="cat-icon"><i class="fa-solid fa-mobile-screen"></i></div><span id="cat-phones">Ù‡ÙˆØ§ØªÙ</span>
            </div>
            <div class="cat-item" onclick="quickSearch('Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª')">
                <div class="cat-icon"><i class="fa-solid fa-laptop"></i></div><span id="cat-laptops">Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª</span>
            </div>
            <div class="cat-item" onclick="quickSearch('Ø³Ù…Ø§Ø¹Ø§Øª')">
                <div class="cat-icon"><i class="fa-solid fa-headphones"></i></div><span id="cat-audio">Ø³Ù…Ø§Ø¹Ø§Øª</span>
            </div>
        </div>

        <div class="results-area">
            <div id="advisor-card" class="advisor-card">
                <strong><i class="fas fa-brain"></i> <span id="advisor-title">ØªØ­Ù„ÙŠÙ„ Findly Ø§Ù„Ø®Ø¨ÙŠØ±:</span></strong>
                <div id="advisor-text" style="margin-top: 10px;"></div>
            </div>
            <div id="products-list"></div>
        </div>
        
        <div class="locked-area">
            <button class="locked-btn"><i class="fa-solid fa-lock"></i> <span id="feat-1">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</span></button>
            <button class="locked-btn"><i class="fa-solid fa-lock"></i> <span id="feat-2">ØªØªØ¨Ø¹ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª</span></button>
        </div>
    </main>

    <script>
        const API_URL = "https://findly-api.onrender.com";
        let currentLang = 'ar';

        // 1. Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ù„ØºØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„ (Ù„Ù† ÙŠÙ†Ù‚Øµ Ø´ÙŠØ¦Ø§Ù‹ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©)
        const translations = {
            ar: { title: "Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù…Ø¯Ø±ÙˆØ³ Ø¨Ø°ÙƒØ§Ø¡", sub: "Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¨Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ØŒ ÙˆØ³Ø£Ø­Ù„Ù„ Ù„Ùƒ Ø§Ù„Ø³ÙˆÙ‚.", placeholder: "Ù…Ø«Ø§Ù„: Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ S24...", advisor: "ØªØ­Ù„ÙŠÙ„ Findly Ø§Ù„Ø®Ø¨ÙŠØ±:", catPhones: "Ù‡ÙˆØ§ØªÙ", catLaptops: "Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª", catAudio: "Ø³Ù…Ø§Ø¹Ø§Øª", feat1: "Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±", feat2: "ØªØªØ¨Ø¹ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª", buy: "Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù† ğŸš€", smart: "Ø®ÙŠØ§Ø± Ø°ÙƒÙŠ", loading: "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚...", dir: "rtl" },
            en: { title: "Your Smart Choice", sub: "Tell me what you need, I'll analyze the market.", placeholder: "Ex: Samsung S24...", advisor: "Findly Expert Analysis:", catPhones: "Phones", catLaptops: "Laptops", catAudio: "Audio", feat1: "Price Check", feat2: "Price Alert", buy: "Buy Now ğŸš€", smart: "Smart Pick", loading: "Analyzing market...", dir: "ltr" },
            fr: { title: "Choix Intelligent", sub: "Dites-moi vos besoins, j'analyse le marchÃ©.", placeholder: "Ex: iPhone 15...", advisor: "Analyse d'Expert:", catPhones: "Mobiles", catLaptops: "Laptops", catAudio: "Audio", feat1: "Prix", feat2: "Alertes", buy: "Acheter ğŸš€", smart: "Choix Smart", loading: "Analyse en cours...", dir: "ltr" },
            tr: { title: "AkÄ±llÄ± SeÃ§im", sub: "Ä°htiyacÄ±nÄ±zÄ± sÃ¶yleyin, piyasayÄ± analiz edelim.", placeholder: "Ã–rn: Samsung...", advisor: "Uzman Analizi:", catPhones: "Telefon", catLaptops: "Laptop", catAudio: "Ses", feat1: "Fiyatlar", feat2: "Ä°ndirimler", buy: "SatÄ±n Al ğŸš€", smart: "AkÄ±llÄ± SeÃ§im", loading: "Analiz ediliyor...", dir: "ltr" },
            es: { title: "ElecciÃ³n Inteligente", sub: "Dime quÃ© necesitas, analizo el mercado.", placeholder: "Ej: Samsung...", advisor: "AnÃ¡lisis Experto:", catPhones: "MÃ³viles", catLaptops: "PortÃ¡tiles", catAudio: "Audio", feat1: "Precios", feat2: "Alertas", buy: "Comprar ğŸš€", smart: "ElecciÃ³n Smart", loading: "Analizando...", dir: "ltr" }
        };

        // 2. Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© (Ù…Ø±ØªØ¨Ø·Ø© Ø¨ÙƒÙ„ Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„ØµÙØ­Ø©)
        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
            document.getElementById('main-title').innerText = t.title;
            document.getElementById('main-sub').innerText = t.sub;
            document.getElementById('search-input').placeholder = t.placeholder;
            document.getElementById('advisor-title').innerText = t.advisor;
            document.getElementById('cat-phones').innerText = t.catPhones;
            document.getElementById('cat-laptops').innerText = t.catLaptops;
            document.getElementById('cat-audio').innerText = t.catAudio;
            document.getElementById('feat-1').innerText = t.feat1;
            document.getElementById('feat-2').innerText = t.feat2;

            // ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡
            document.documentElement.dir = t.dir;
        }

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        // 4. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¹Ø¨Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
        function quickSearch(term) {
            document.getElementById('search-input').value = term;
            handleSearch();
        }

        // 5. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶)
        async function handleSearch() {
            const query = document.getElementById('search-input').value;
            const list = document.getElementById('products-list');
            const advisorCard = document.getElementById('advisor-card');
            const advisorText = document.getElementById('advisor-text');

            if (!query) return;

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            advisorCard.style.display = 'block';
            advisorText.innerHTML = `<i class="fa-solid fa-circle-notch loader"></i> ${translations[currentLang].loading}`;
            list.innerHTML = '';

            try {
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
                const res = await fetch(`${API_URL}/get-ai-advice`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, lang: currentLang })
                });

                const data = await res.json();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†ØµÙŠØ©
                advisorText.innerHTML = data.explanation.replace(/\n/g, '<br>');

                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                data.products.forEach(p => {
                    list.innerHTML += `
                        <div class="product-card">
                            <div style="display:flex; gap:15px; align-items:flex-start;">
                                <img src="${p.thumbnail}" style="width:80px; height:80px; object-fit:contain; border-radius:8px;" onerror="this.src='https://via.placeholder.com/80'">
                                <div style="flex:1;">
                                    <h4 style="margin:0 0 5px 0; font-size:0.9rem;">${p.name}</h4>
                                    <div style="font-size:0.75rem; color:green; background:#f0fdf4; padding:3px 6px; border-radius:4px; display:inline-block; margin-bottom:5px;">
                                        ğŸ’¡ ${p.recommendation_reason || translations[currentLang].smart}
                                    </div>
                                    <div style="font-weight:bold; color:var(--primary); font-size:0.9rem;">${p.features}</div>
                                </div>
                            </div>
                            <a href="${p.link}" target="_blank" class="btn-amazon">${translations[currentLang].buy}</a>
                        </div>
                    `;
                });

            } catch (err) {
                console.error(err);
                advisorText.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
            }
        }

        // ØªÙØ¹ÙŠÙ„ Ø²Ø± Enter Ù„Ù„Ø¨Ø­Ø«
        document.getElementById('search-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') handleSearch();
        });
    </script>
</body>
</html>
