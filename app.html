'use client'

import { useState, useEffect, useRef } from 'react'

// Types
interface User {
  uid: string
  email: string | null
  displayName: string | null
  photoURL: string | null
  energy: number
  maxEnergy: number
  isPro: boolean
}

interface Product {
  title: string
  price: string
  originalPrice?: string
  image: string
  link: string
  source: string
  rating?: string
  reviews?: number
  discount?: string
  shipping?: string
}

interface ChatMessage {
  role: 'user' | 'assistant'
  content: string
  timestamp: Date
}

interface Coupon {
  id: string
  code: string
  discount: string
  store: string
  expiresAt: string
  description: string
}

interface WatchlistItem {
  id: string
  productId: string
  title: string
  image: string
  targetPrice: number
  currentPrice: number
  link: string
}

// Translations
const translations: Record<string, Record<string, string>> = {
  ar: {
    searchPlaceholder: 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ù…Ù†ØªØ¬...',
    search: 'Ø¨Ø­Ø«',
    voiceSearch: 'Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ',
    chat: 'Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©',
    watchlist: 'Ø§Ù„Ù…ÙØ¶Ù„Ø©',
    coupons: 'Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…',
    affiliate: 'Ø§Ù„Ø´Ø±ÙƒØ§Ø¡',
    analysis: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„',
    settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
    logout: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
    login: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
    email: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
    password: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
    orContinueWith: 'Ø£Ùˆ ØªØ§Ø¨Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…',
    google: 'Ø¬ÙˆØ¬Ù„',
    noAccount: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ',
    signUp: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨',
    energy: 'Ø§Ù„Ø·Ø§Ù‚Ø©',
    pro: 'Ø§Ù„Ù…Ù…ÙŠØ²',
    free: 'Ù…Ø¬Ø§Ù†ÙŠ',
    welcome: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Findly Sage',
    tagline: 'Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªØ³ÙˆÙ‚',
    startChat: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©',
    typeMessage: 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...',
    send: 'Ø¥Ø±Ø³Ø§Ù„',
    trendingProducts: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¬Ø©',
    bestDeals: 'Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶',
    addToWatchlist: 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©',
    removeFromWatchlist: 'Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©',
    applyCoupon: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø©',
    copyCode: 'Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯',
    copied: 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!',
    priceAnalysis: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±',
    valueScore: 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ù‚ÙŠÙ…Ø©',
    trustScore: 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ù‚Ø©',
    forecast: 'Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª',
    verdict: 'Ø§Ù„Ø­ÙƒÙ…',
    buy: 'Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†',
    wait: 'Ø§Ù†ØªØ¸Ø±',
    overpriced: 'Ø³Ø¹Ø± Ù…Ø±ØªÙØ¹',
    privacy: 'Ø§Ù„Ø®ØµÙˆØµÙŠØ©',
    terms: 'Ø§Ù„Ø´Ø±ÙˆØ·',
    about: 'Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚',
    darkMode: 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†',
    language: 'Ø§Ù„Ù„ØºØ©',
    affiliateTitle: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡',
    affiliateDesc: 'Ø´Ø§Ø±Ùƒ Ø±ÙˆØ§Ø¨Ø·Ùƒ ÙˆØ§ÙƒØ³Ø¨ Ø¹Ù…ÙˆÙ„Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡',
    affiliateLink: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø±ÙŠÙƒ',
    generateLink: 'Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø·',
    yourEarnings: 'Ø£Ø±Ø¨Ø§Ø­Ùƒ',
    totalClicks: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø±Ø§Øª',
    conversions: 'Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª',
    upgradeToPro: 'ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…ÙŠØ²',
    proFeatures: 'Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©',
    unlimitedSearches: 'Ø¨Ø­Ø« ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯',
    advancedAnalysis: 'ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù…',
    prioritySupport: 'Ø¯Ø¹Ù… Ø°Ùˆ Ø£ÙˆÙ„ÙˆÙŠØ©',
    noAds: 'Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª',
    priceAlerts: 'ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±'
  },
  en: {
    searchPlaceholder: 'Search for any product...',
    search: 'Search',
    voiceSearch: 'Voice Search',
    chat: 'Chat',
    watchlist: 'Watchlist',
    coupons: 'Coupons',
    affiliate: 'Affiliate',
    analysis: 'Analysis',
    settings: 'Settings',
    logout: 'Logout',
    login: 'Login',
    email: 'Email',
    password: 'Password',
    orContinueWith: 'Or continue with',
    google: 'Google',
    noAccount: "Don't have an account?",
    signUp: 'Sign Up',
    energy: 'Energy',
    pro: 'Pro',
    free: 'Free',
    welcome: 'Welcome to Findly Sage',
    tagline: 'Your Smart Shopping Assistant',
    startChat: 'Start Chat',
    typeMessage: 'Type your message...',
    send: 'Send',
    trendingProducts: 'Trending Products',
    bestDeals: 'Best Deals',
    addToWatchlist: 'Add to Watchlist',
    removeFromWatchlist: 'Remove from Watchlist',
    applyCoupon: 'Apply Coupon',
    copyCode: 'Copy Code',
    copied: 'Copied!',
    priceAnalysis: 'Price Analysis',
    valueScore: 'Value Score',
    trustScore: 'Trust Score',
    forecast: 'Forecast',
    verdict: 'Verdict',
    buy: 'Buy Now',
    wait: 'Wait',
    overpriced: 'Overpriced',
    privacy: 'Privacy',
    terms: 'Terms',
    about: 'About',
    darkMode: 'Dark Mode',
    language: 'Language',
    affiliateTitle: 'Affiliate Program',
    affiliateDesc: 'Share your links and earn commission on every purchase',
    affiliateLink: 'Affiliate Link',
    generateLink: 'Generate Link',
    yourEarnings: 'Your Earnings',
    totalClicks: 'Total Clicks',
    conversions: 'Conversions',
    upgradeToPro: 'Upgrade to Pro',
    proFeatures: 'Pro Features',
    unlimitedSearches: 'Unlimited Searches',
    advancedAnalysis: 'Advanced Analysis',
    prioritySupport: 'Priority Support',
    noAds: 'No Ads',
    priceAlerts: 'Price Alerts'
  },
  fr: {
    searchPlaceholder: 'Rechercher un produit...',
    search: 'Rechercher',
    voiceSearch: 'Recherche Vocale',
    chat: 'Chat',
    watchlist: 'Favoris',
    coupons: 'Coupons',
    affiliate: 'Affiliation',
    analysis: 'Analyse',
    settings: 'ParamÃ¨tres',
    logout: 'DÃ©connexion',
    login: 'Connexion',
    email: 'Email',
    password: 'Mot de passe',
    orContinueWith: 'Ou continuer avec',
    google: 'Google',
    noAccount: 'Pas de compte?',
    signUp: 'Inscription',
    energy: 'Ã‰nergie',
    pro: 'Pro',
    free: 'Gratuit',
    welcome: 'Bienvenue sur Findly Sage',
    tagline: 'Votre Assistant Shopping Intelligent',
    startChat: 'DÃ©marrer le Chat',
    typeMessage: 'Tapez votre message...',
    send: 'Envoyer',
    trendingProducts: 'Produits Tendances',
    bestDeals: 'Meilleures Offres',
    addToWatchlist: 'Ajouter aux Favoris',
    removeFromWatchlist: 'Retirer des Favoris',
    applyCoupon: 'Appliquer le Coupon',
    copyCode: 'Copier le Code',
    copied: 'CopiÃ©!',
    priceAnalysis: 'Analyse des Prix',
    valueScore: 'Score de Valeur',
    trustScore: 'Score de Confiance',
    forecast: 'PrÃ©vision',
    verdict: 'Verdict',
    buy: 'Acheter',
    wait: 'Attendre',
    overpriced: 'Trop Cher',
    privacy: 'ConfidentialitÃ©',
    terms: 'Conditions',
    about: 'Ã€ Propos',
    darkMode: 'Mode Sombre',
    language: 'Langue',
    affiliateTitle: "Programme d'Affiliation",
    affiliateDesc: 'Partagez vos liens et gagnez des commissions',
    affiliateLink: "Lien d'Affiliation",
    generateLink: 'GÃ©nÃ©rer le Lien',
    yourEarnings: 'Vos Gains',
    totalClicks: 'Total des Clics',
    conversions: 'Conversions',
    upgradeToPro: 'Passer Ã  Pro',
    proFeatures: 'FonctionnalitÃ©s Pro',
    unlimitedSearches: 'Recherches IllimitÃ©es',
    advancedAnalysis: 'Analyse AvancÃ©e',
    prioritySupport: 'Support Prioritaire',
    noAds: 'Sans PublicitÃ©',
    priceAlerts: 'Alertes de Prix'
  },
  de: {
    searchPlaceholder: 'Produkt suchen...',
    search: 'Suchen',
    voiceSearch: 'Sprachsuche',
    chat: 'Chat',
    watchlist: 'Merkliste',
    coupons: 'Gutscheine',
    affiliate: 'Partner',
    analysis: 'Analyse',
    settings: 'Einstellungen',
    logout: 'Abmelden',
    login: 'Anmelden',
    email: 'E-Mail',
    password: 'Passwort',
    orContinueWith: 'Oder fortfahren mit',
    google: 'Google',
    noAccount: 'Kein Konto?',
    signUp: 'Registrieren',
    energy: 'Energie',
    pro: 'Pro',
    free: 'Kostenlos',
    welcome: 'Willkommen bei Findly Sage',
    tagline: 'Ihr intelligenter Einkaufsassistent',
    startChat: 'Chat Starten',
    typeMessage: 'Nachricht eingeben...',
    send: 'Senden',
    trendingProducts: 'Trendprodukte',
    bestDeals: 'Beste Angebote',
    addToWatchlist: 'Zur Merkliste',
    removeFromWatchlist: 'Von Merkliste entfernen',
    applyCoupon: 'Gutschein Anwenden',
    copyCode: 'Code Kopieren',
    copied: 'Kopiert!',
    priceAnalysis: 'Preisanalyse',
    valueScore: 'Wert-Score',
    trustScore: 'Vertrauens-Score',
    forecast: 'Prognose',
    verdict: 'Urteil',
    buy: 'Kaufen',
    wait: 'Warten',
    overpriced: 'Ãœberteuert',
    privacy: 'Datenschutz',
    terms: 'AGB',
    about: 'Ãœber Uns',
    darkMode: 'Dunkelmodus',
    language: 'Sprache',
    affiliateTitle: 'Partnerprogramm',
    affiliateDesc: 'Teilen Sie Ihre Links und verdienen Sie Provisionen',
    affiliateLink: 'Partner-Link',
    generateLink: 'Link Generieren',
    yourEarnings: 'Ihre Einnahmen',
    totalClicks: 'Gesamtklicks',
    conversions: 'Konversionen',
    upgradeToPro: 'Pro Upgrade',
    proFeatures: 'Pro Funktionen',
    unlimitedSearches: 'Unbegrenzte Suche',
    advancedAnalysis: 'Erweiterte Analyse',
    prioritySupport: 'PrioritÃ¤ts-Support',
    noAds: 'Keine Werbung',
    priceAlerts: 'Preisalarme'
  },
  es: {
    searchPlaceholder: 'Buscar producto...',
    search: 'Buscar',
    voiceSearch: 'BÃºsqueda por Voz',
    chat: 'Chat',
    watchlist: 'Lista de Deseos',
    coupons: 'Cupones',
    affiliate: 'Afiliados',
    analysis: 'AnÃ¡lisis',
    settings: 'Ajustes',
    logout: 'Cerrar SesiÃ³n',
    login: 'Iniciar SesiÃ³n',
    email: 'Correo ElectrÃ³nico',
    password: 'ContraseÃ±a',
    orContinueWith: 'O continuar con',
    google: 'Google',
    noAccount: 'Â¿No tienes cuenta?',
    signUp: 'Registrarse',
    energy: 'EnergÃ­a',
    pro: 'Pro',
    free: 'Gratis',
    welcome: 'Bienvenido a Findly Sage',
    tagline: 'Tu Asistente de Compras Inteligente',
    startChat: 'Iniciar Chat',
    typeMessage: 'Escribe tu mensaje...',
    send: 'Enviar',
    trendingProducts: 'Productos Populares',
    bestDeals: 'Mejores Ofertas',
    addToWatchlist: 'AÃ±adir a Lista',
    removeFromWatchlist: 'Quitar de Lista',
    applyCoupon: 'Aplicar CupÃ³n',
    copyCode: 'Copiar CÃ³digo',
    copied: 'Â¡Copiado!',
    priceAnalysis: 'AnÃ¡lisis de Precio',
    valueScore: 'PuntuaciÃ³n de Valor',
    trustScore: 'PuntuaciÃ³n de Confianza',
    forecast: 'PronÃ³stico',
    verdict: 'Veredicto',
    buy: 'Comprar',
    wait: 'Esperar',
    overpriced: 'Sobrecargado',
    privacy: 'Privacidad',
    terms: 'TÃ©rminos',
    about: 'Acerca de',
    darkMode: 'Modo Oscuro',
    language: 'Idioma',
    affiliateTitle: 'Programa de Afiliados',
    affiliateDesc: 'Comparte tus enlaces y gana comisiones',
    affiliateLink: 'Enlace de Afiliado',
    generateLink: 'Generar Enlace',
    yourEarnings: 'Tus Ganancias',
    totalClicks: 'Clics Totales',
    conversions: 'Conversiones',
    upgradeToPro: 'Actualizar a Pro',
    proFeatures: 'Funciones Pro',
    unlimitedSearches: 'BÃºsquedas Ilimitadas',
    advancedAnalysis: 'AnÃ¡lisis Avanzado',
    prioritySupport: 'Soporte Prioritario',
    noAds: 'Sin Anuncios',
    priceAlerts: 'Alertas de Precio'
  },
  tr: {
    searchPlaceholder: 'ÃœrÃ¼n ara...',
    search: 'Ara',
    voiceSearch: 'Sesli Arama',
    chat: 'Sohbet',
    watchlist: 'Ä°zleme Listesi',
    coupons: 'Kuponlar',
    affiliate: 'OrtaklÄ±k',
    analysis: 'Analiz',
    settings: 'Ayarlar',
    logout: 'Ã‡Ä±kÄ±ÅŸ Yap',
    login: 'GiriÅŸ Yap',
    email: 'E-posta',
    password: 'Åifre',
    orContinueWith: 'Veya ÅŸununla devam et',
    google: 'Google',
    noAccount: 'HesabÄ±n yok mu?',
    signUp: 'KayÄ±t Ol',
    energy: 'Enerji',
    pro: 'Pro',
    free: 'Ãœcretsiz',
    welcome: "Findly Sage'e HoÅŸ Geldiniz",
    tagline: 'AkÄ±llÄ± AlÄ±ÅŸveriÅŸ AsistanÄ±nÄ±z',
    startChat: 'Sohbete BaÅŸla',
    typeMessage: 'MesajÄ±nÄ±zÄ± yazÄ±n...',
    send: 'GÃ¶nder',
    trendingProducts: 'Trend ÃœrÃ¼nler',
    bestDeals: 'En Ä°yi FÄ±rsatlar',
    addToWatchlist: 'Listeye Ekle',
    removeFromWatchlist: 'Listeden Ã‡Ä±kar',
    applyCoupon: 'Kuponu Uygula',
    copyCode: 'Kodu Kopyala',
    copied: 'KopyalandÄ±!',
    priceAnalysis: 'Fiyat Analizi',
    valueScore: 'DeÄŸer PuanÄ±',
    trustScore: 'GÃ¼ven PuanÄ±',
    forecast: 'Tahmin',
    verdict: 'Karar',
    buy: 'SatÄ±n Al',
    wait: 'Bekle',
    overpriced: 'PahalÄ±',
    privacy: 'Gizlilik',
    terms: 'Åartlar',
    about: 'HakkÄ±nda',
    darkMode: 'KaranlÄ±k Mod',
    language: 'Dil',
    affiliateTitle: 'OrtaklÄ±k ProgramÄ±',
    affiliateDesc: 'BaÄŸlantÄ±larÄ±nÄ±zÄ± paylaÅŸÄ±n ve komisyon kazanÄ±n',
    affiliateLink: 'OrtaklÄ±k BaÄŸlantÄ±sÄ±',
    generateLink: 'BaÄŸlantÄ± OluÅŸtur',
    yourEarnings: 'KazanÃ§larÄ±nÄ±z',
    totalClicks: 'Toplam TÄ±klama',
    conversions: 'DÃ¶nÃ¼ÅŸÃ¼mler',
    upgradeToPro: "Pro'ya YÃ¼kselt",
    proFeatures: 'Pro Ã–zellikleri',
    unlimitedSearches: 'SÄ±nÄ±rsÄ±z Arama',
    advancedAnalysis: 'GeliÅŸmiÅŸ Analiz',
    prioritySupport: 'Ã–ncelikli Destek',
    noAds: 'ReklamsÄ±z',
    priceAlerts: 'Fiyat UyarÄ±larÄ±'
  }
}

const languages = [
  { code: 'ar', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
  { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'fr', name: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·' },
  { code: 'de', name: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª' },
  { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
  { code: 'tr', name: 'TÃ¼rkÃ§e', flag: 'ğŸ‡¹ğŸ‡·' }
]

export default function Home() {
  // State
  const [user, setUser] = useState<User | null>(null)
  const [isLoggedIn, setIsLoggedIn] = useState(false)
  const [showLoginModal, setShowLoginModal] = useState(false)
  const [showSettingsModal, setShowSettingsModal] = useState(false)
  const [showAnalysisModal, setShowAnalysisModal] = useState(false)
  const [showAffiliateModal, setShowAffiliateModal] = useState(false)
  const [showProModal, setShowProModal] = useState(false)
  const [darkMode, setDarkMode] = useState(true)
  const [language, setLanguage] = useState('ar')
  const [isRTL, setIsRTL] = useState(true)
  
  // Auth
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [isSignUp, setIsSignUp] = useState(false)
  
  // Search & Products
  const [searchQuery, setSearchQuery] = useState('')
  const [products, setProducts] = useState<Product[]>([])
  const [isLoading, setIsLoading] = useState(false)
  const [activeTab, setActiveTab] = useState<'search' | 'chat' | 'watchlist' | 'coupons'>('search')
  
  // Chat
  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([])
  const [chatInput, setChatInput] = useState('')
  const [isChatLoading, setIsChatLoading] = useState(false)
  const chatEndRef = useRef<HTMLDivElement>(null)
  
  // Watchlist & Coupons
  const [watchlist, setWatchlist] = useState<WatchlistItem[]>([])
  const [coupons] = useState<Coupon[]>([
    { id: '1', code: 'SAVE20', discount: '20%', store: 'Amazon', expiresAt: '2025-02-01', description: 'Save 20% on electronics' },
    { id: '2', code: 'FREESHIP', discount: 'Free Shipping', store: 'eBay', expiresAt: '2025-01-20', description: 'Free shipping on orders over $50' },
    { id: '3', code: 'DEAL15', discount: '15%', store: 'AliExpress', expiresAt: '2025-01-25', description: '15% off all products' }
  ])
  
  // Analysis
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null)
  const [analysisData, setAnalysisData] = useState({
    valueScore: 85,
    trustScore: 92,
    priceForecast: 'stable',
    verdict: 'buy'
  })
  
  // Affiliate
  const [affiliateLink, setAffiliateLink] = useState('')
  const [affiliateStats, setAffiliateStats] = useState({
    earnings: 0,
    clicks: 0,
    conversions: 0
  })
  
  // Voice
  const [isListening, setIsListening] = useState(false)
  
  const t = translations[language] || translations.en
  
  // Effects
  useEffect(() => {
    setIsRTL(language === 'ar')
    document.documentElement.dir = language === 'ar' ? 'rtl' : 'ltr'
  }, [language])
  
  useEffect(() => {
    chatEndRef.current?.scrollIntoView({ behavior: 'smooth' })
  }, [chatMessages])
  
  // Handlers
  const handleLogin = async () => {
    setUser({
      uid: 'user_' + Date.now(),
      email: email || 'user@example.com',
      displayName: 'User',
      photoURL: null,
      energy: 50,
      maxEnergy: 100,
      isPro: false
    })
    setIsLoggedIn(true)
    setShowLoginModal(false)
    setEmail('')
    setPassword('')
  }
  
  const handleGoogleLogin = async () => {
    setUser({
      uid: 'google_' + Date.now(),
      email: 'user@gmail.com',
      displayName: 'Google User',
      photoURL: 'https://ui-avatars.com/api/?name=User&background=6366f1&color=fff',
      energy: 50,
      maxEnergy: 100,
      isPro: false
    })
    setIsLoggedIn(true)
    setShowLoginModal(false)
  }
  
  const handleLogout = () => {
    setUser(null)
    setIsLoggedIn(false)
    setChatMessages([])
    setWatchlist([])
    setActiveTab('search')
    setShowSettingsModal(false)
    setShowAffiliateModal(false)
  }
  
  const handleSearch = async () => {
    if (!searchQuery.trim()) return
    setIsLoading(true)
    
    try {
      const response = await fetch('/api/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: searchQuery })
      })
      const data = await response.json()
      setProducts(data.products || [])
    } catch {
      setProducts([
        {
          title: 'Apple iPhone 15 Pro Max 256GB',
          price: '$1,199',
          originalPrice: '$1,299',
          image: 'https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=200',
          link: 'https://amazon.com',
          source: 'Amazon',
          rating: '4.8',
          reviews: 2341,
          discount: '8%',
          shipping: 'Free Shipping'
        },
        {
          title: 'Samsung Galaxy S24 Ultra',
          price: '$1,099',
          originalPrice: '$1,199',
          image: 'https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=200',
          link: 'https://ebay.com',
          source: 'eBay',
          rating: '4.7',
          reviews: 1823,
          discount: '10%',
          shipping: 'Free Shipping'
        },
        {
          title: 'Sony WH-1000XM5 Headphones',
          price: '$348',
          originalPrice: '$399',
          image: 'https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=200',
          link: 'https://aliexpress.com',
          source: 'AliExpress',
          rating: '4.9',
          reviews: 5621,
          discount: '13%',
          shipping: 'Free Shipping'
        }
      ])
    }
    setIsLoading(false)
  }
  
  const handleChat = async () => {
    if (!chatInput.trim() || isChatLoading) return
    
    const userMessage: ChatMessage = {
      role: 'user',
      content: chatInput,
      timestamp: new Date()
    }
    
    setChatMessages(prev => [...prev, userMessage])
    setChatInput('')
    setIsChatLoading(true)
    
    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          message: chatInput,
          language,
          history: chatMessages.slice(-10)
        })
      })
      const data = await response.json()
      
      const assistantMessage: ChatMessage = {
        role: 'assistant',
        content: data.response || 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ.',
        timestamp: new Date()
      }
      setChatMessages(prev => [...prev, assistantMessage])
    } catch {
      const errorMessage: ChatMessage = {
        role: 'assistant',
        content: language === 'ar' 
          ? 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Findly SageØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªØ³ÙˆÙ‚.'
          : "Hello! I'm Findly Sage, your smart shopping assistant.",
        timestamp: new Date()
      }
      setChatMessages(prev => [...prev, errorMessage])
    }
    setIsChatLoading(false)
  }
  
  const handleAnalysis = (product: Product) => {
    setSelectedProduct(product)
    setAnalysisData({
      valueScore: Math.floor(Math.random() * 30) + 70,
      trustScore: Math.floor(Math.random() * 20) + 80,
      priceForecast: ['rising', 'stable', 'dropping'][Math.floor(Math.random() * 3)],
      verdict: ['buy', 'wait', 'overpriced'][Math.floor(Math.random() * 3)]
    })
    setShowAnalysisModal(true)
  }
  
  const addToWatchlistHandler = (product: Product) => {
    const newItem: WatchlistItem = {
      id: 'wl_' + Date.now(),
      productId: product.title,
      title: product.title,
      image: product.image,
      targetPrice: parseFloat(product.price.replace(/[^0-9.]/g, '')) * 0.9,
      currentPrice: parseFloat(product.price.replace(/[^0-9.]/g, '')),
      link: product.link
    }
    setWatchlist(prev => [...prev, newItem])
  }
  
  const removeFromWatchlist = (id: string) => {
    setWatchlist(prev => prev.filter(item => item.id !== id))
  }
  
  const copyCouponCode = (code: string) => {
    navigator.clipboard.writeText(code)
  }
  
  const generateAffiliateLink = () => {
    const link = `https://findly.app/ref/${user?.uid || 'guest'}?utm_source=affiliate`
    setAffiliateLink(link)
    setAffiliateStats({
      earnings: 127.50,
      clicks: 342,
      conversions: 12
    })
  }
  
  const startVoiceSearch = () => {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = (window as any).webkitSpeechRecognition || (window as any).SpeechRecognition
      const recognition = new SpeechRecognition()
      recognition.lang = language === 'ar' ? 'ar-SA' : 'en-US'
      recognition.continuous = false
      recognition.onstart = () => setIsListening(true)
      recognition.onend = () => setIsListening(false)
      recognition.onresult = (event: any) => {
        const transcript = event.results[0][0].transcript
        setSearchQuery(transcript)
        setIsListening(false)
      }
      recognition.onerror = () => setIsListening(false)
      recognition.start()
    }
  }
  
  const getVerdictColor = (verdict: string) => {
    switch (verdict) {
      case 'buy': return 'text-emerald-400'
      case 'wait': return 'text-amber-400'
      case 'overpriced': return 'text-red-400'
      default: return 'text-gray-400'
    }
  }
  
  const getVerdictText = (verdict: string) => {
    switch (verdict) {
      case 'buy': return t.buy
      case 'wait': return t.wait
      case 'overpriced': return t.overpriced
      default: return verdict
    }
  }

  return (
    <div className={`min-h-screen transition-all duration-500 ${darkMode ? 'bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900' : 'bg-gradient-to-br from-slate-50 via-purple-50 to-slate-50'}`}>
      {/* Animated Background Orbs */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className={`absolute -top-40 -right-40 w-96 h-96 rounded-full blur-3xl animate-pulse ${darkMode ? 'bg-purple-500/20' : 'bg-purple-300/40'}`} />
        <div className={`absolute top-1/2 -left-40 w-80 h-80 rounded-full blur-3xl animate-pulse ${darkMode ? 'bg-cyan-500/20' : 'bg-cyan-300/40'}`} style={{animationDelay: '1s'}} />
        <div className={`absolute -bottom-40 right-1/3 w-72 h-72 rounded-full blur-3xl animate-pulse ${darkMode ? 'bg-pink-500/20' : 'bg-pink-300/40'}`} style={{animationDelay: '0.5s'}} />
      </div>

      {/* Header */}
      <header className={`sticky top-0 z-50 backdrop-blur-xl border-b ${darkMode ? 'bg-slate-900/70 border-white/10' : 'bg-white/70 border-gray-200'}`}>
        <div className="max-w-7xl mx-auto px-4 py-3">
          <div className="flex items-center justify-between">
            {/* Logo */}
            <div className="flex items-center gap-3">
              <div className="relative">
                <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-violet-500 via-purple-500 to-fuchsia-500 flex items-center justify-center shadow-lg shadow-purple-500/25">
                  <svg className="w-7 h-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                </div>
                <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-400 rounded-full border-2 border-slate-900" />
              </div>
              <div>
                <h1 className="text-xl font-bold bg-gradient-to-r from-violet-400 via-purple-400 to-fuchsia-400 bg-clip-text text-transparent">
                  Findly Sage
                </h1>
                <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.tagline}</p>
              </div>
            </div>

            {/* Navigation */}
            <nav className="hidden md:flex items-center gap-2">
              {[
                { id: 'search', icon: 'ğŸ”', label: t.search },
                { id: 'chat', icon: 'ğŸ’¬', label: t.chat },
                { id: 'watchlist', icon: 'â¤ï¸', label: t.watchlist },
                { id: 'coupons', icon: 'ğŸ«', label: t.coupons }
              ].map((tab) => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id as any)}
                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${
                    activeTab === tab.id
                      ? 'bg-gradient-to-r from-violet-500 to-purple-500 text-white shadow-lg shadow-purple-500/25'
                      : darkMode ? 'text-gray-300 hover:bg-white/10' : 'text-gray-600 hover:bg-black/5'
                  }`}
                >
                  <span className="mr-2">{tab.icon}</span>
                  {tab.label}
                </button>
              ))}
            </nav>

            {/* User Section */}
            <div className="flex items-center gap-3">
              {isLoggedIn && user ? (
                <>
                  {/* Energy Badge */}
                  <div className={`hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-xl ${darkMode ? 'bg-white/10' : 'bg-black/5'}`}>
                    <span className="text-lg">âš¡</span>
                    <span className={`text-sm font-medium ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                      {user.energy}/{user.maxEnergy}
                    </span>
                    {user.isPro && (
                      <span className="px-2 py-0.5 bg-gradient-to-r from-amber-400 to-orange-400 text-xs font-bold text-slate-900 rounded-full">
                        PRO
                      </span>
                    )}
                  </div>

                  {/* Affiliate Button */}
                  <button
                    onClick={() => setShowAffiliateModal(true)}
                    className={`p-2 rounded-xl transition-all duration-300 ${darkMode ? 'hover:bg-white/10 text-gray-300' : 'hover:bg-black/5 text-gray-600'}`}
                    title={t.affiliate}
                  >
                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                  </button>

                  {/* Settings Button */}
                  <button
                    onClick={() => setShowSettingsModal(true)}
                    className={`p-2 rounded-xl transition-all duration-300 ${darkMode ? 'hover:bg-white/10 text-gray-300' : 'hover:bg-black/5 text-gray-600'}`}
                    title={t.settings}
                  >
                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                  </button>

                  {/* User Avatar & Logout */}
                  <div className="relative group">
                    <button className="flex items-center gap-2">
                      <div className="w-9 h-9 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center text-white font-bold shadow-lg shadow-purple-500/25">
                        {user.displayName?.[0] || user.email?.[0]?.toUpperCase() || 'U'}
                      </div>
                    </button>
                    
                    {/* Dropdown */}
                    <div className={`absolute ${isRTL ? 'left-0' : 'right-0'} top-full mt-2 w-48 rounded-2xl overflow-hidden shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 ${darkMode ? 'bg-slate-800 border border-white/10' : 'bg-white border border-gray-200'}`}>
                      <div className={`p-3 border-b ${darkMode ? 'border-white/10' : 'border-gray-100'}`}>
                        <p className={`text-sm font-medium ${darkMode ? 'text-white' : 'text-gray-800'}`}>{user.displayName || 'User'}</p>
                        <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{user.email}</p>
                      </div>
                      <button
                        onClick={handleLogout}
                        className={`w-full flex items-center gap-2 px-4 py-3 text-sm transition-colors ${darkMode ? 'text-red-400 hover:bg-red-500/10' : 'text-red-500 hover:bg-red-50'}`}
                      >
                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        {t.logout}
                      </button>
                    </div>
                  </div>
                </>
              ) : (
                <button
                  onClick={() => setShowLoginModal(true)}
                  className="px-5 py-2.5 bg-gradient-to-r from-violet-500 to-purple-500 text-white text-sm font-medium rounded-xl shadow-lg shadow-purple-500/25 hover:shadow-purple-500/40 transition-all duration-300 hover:scale-105"
                >
                  {t.login}
                </button>
              )}
            </div>
          </div>

          {/* Mobile Navigation */}
          <div className="flex md:hidden gap-2 mt-3 overflow-x-auto pb-2">
            {[
              { id: 'search', icon: 'ğŸ”', label: t.search },
              { id: 'chat', icon: 'ğŸ’¬', label: t.chat },
              { id: 'watchlist', icon: 'â¤ï¸', label: t.watchlist },
              { id: 'coupons', icon: 'ğŸ«', label: t.coupons }
            ].map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id as any)}
                className={`flex-shrink-0 px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${
                  activeTab === tab.id
                    ? 'bg-gradient-to-r from-violet-500 to-purple-500 text-white shadow-lg'
                    : darkMode ? 'text-gray-300 bg-white/5' : 'text-gray-600 bg-black/5'
                }`}
              >
                <span className="mr-1">{tab.icon}</span>
                {tab.label}
              </button>
            ))}
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="relative max-w-7xl mx-auto px-4 py-8">
        {/* Search Tab */}
        {activeTab === 'search' && (
          <div className="space-y-8">
            {/* Search Box */}
            <div className={`p-6 rounded-3xl backdrop-blur-xl ${darkMode ? 'bg-white/5 border border-white/10' : 'bg-white/50 border border-gray-200'}`}>
              <div className="flex gap-3">
                <div className="flex-1 relative">
                  <input
                    type="text"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                    placeholder={t.searchPlaceholder}
                    className={`w-full px-5 py-4 rounded-2xl text-lg outline-none transition-all duration-300 ${
                      darkMode 
                        ? 'bg-white/10 text-white placeholder-gray-400 border border-white/10 focus:border-purple-500' 
                        : 'bg-white text-gray-800 placeholder-gray-400 border border-gray-200 focus:border-purple-500'
                    }`}
                    dir={isRTL ? 'rtl' : 'ltr'}
                  />
                </div>
                <button
                  onClick={handleSearch}
                  disabled={isLoading}
                  className="px-6 py-4 bg-gradient-to-r from-violet-500 to-purple-500 text-white rounded-2xl font-medium shadow-lg shadow-purple-500/25 hover:shadow-purple-500/40 transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {isLoading ? (
                    <svg className="w-6 h-6 animate-spin" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                    </svg>
                  ) : (
                    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                  )}
                </button>
                <button
                  onClick={startVoiceSearch}
                  className={`p-4 rounded-2xl transition-all duration-300 ${
                    isListening 
                      ? 'bg-red-500 text-white animate-pulse' 
                      : darkMode ? 'bg-white/10 text-gray-300 hover:bg-white/20' : 'bg-black/5 text-gray-600 hover:bg-black/10'
                  }`}
                  title={t.voiceSearch}
                >
                  <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                  </svg>
                </button>
              </div>
            </div>

            {/* Products Grid */}
            {products.length > 0 && (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {products.map((product, index) => (
                  <div
                    key={index}
                    className={`group rounded-3xl overflow-hidden backdrop-blur-xl transition-all duration-500 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/20 ${
                      darkMode ? 'bg-white/5 border border-white/10 hover:border-purple-500/50' : 'bg-white/70 border border-gray-200 hover:border-purple-500/50 shadow-lg'
                    }`}
                  >
                    <div className="relative aspect-square overflow-hidden">
                      <img
                        src={product.image}
                        alt={product.title}
                        className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                      />
                      {product.discount && (
                        <div className="absolute top-3 left-3 px-3 py-1 bg-gradient-to-r from-rose-500 to-pink-500 text-white text-sm font-bold rounded-full shadow-lg">
                          -{product.discount}
                        </div>
                      )}
                      <div className="absolute top-3 right-3 px-3 py-1 bg-white/90 backdrop-blur text-gray-800 text-xs font-medium rounded-full">
                        {product.source}
                      </div>
                    </div>
                    <div className="p-5">
                      <h3 className={`font-semibold mb-2 line-clamp-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                        {product.title}
                      </h3>
                      <div className="flex items-center gap-2 mb-3">
                        <span className="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                          {product.price}
                        </span>
                        {product.originalPrice && (
                          <span className={`text-sm line-through ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                            {product.originalPrice}
                          </span>
                        )}
                      </div>
                      {product.rating && (
                        <div className="flex items-center gap-2 mb-4">
                          <div className="flex items-center">
                            {[...Array(5)].map((_, i) => (
                              <svg key={i} className={`w-4 h-4 ${i < Math.floor(parseFloat(product.rating || '0')) ? 'text-amber-400' : darkMode ? 'text-gray-600' : 'text-gray-300'}`} fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                              </svg>
                            ))}
                          </div>
                          <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            {product.rating} ({product.reviews?.toLocaleString()})
                          </span>
                        </div>
                      )}
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleAnalysis(product)}
                          className="flex-1 py-2.5 bg-gradient-to-r from-violet-500 to-purple-500 text-white text-sm font-medium rounded-xl hover:shadow-lg hover:shadow-purple-500/25 transition-all duration-300"
                        >
                          {t.analysis}
                        </button>
                        <button
                          onClick={() => addToWatchlistHandler(product)}
                          className={`p-2.5 rounded-xl transition-all duration-300 ${
                            darkMode ? 'bg-white/10 text-gray-300 hover:bg-white/20' : 'bg-black/5 text-gray-600 hover:bg-black/10'
                          }`}
                        >
                          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* Empty State */}
            {products.length === 0 && !isLoading && (
              <div className="text-center py-20">
                <div className="w-24 h-24 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-violet-500/20 to-purple-500/20 flex items-center justify-center">
                  <svg className={`w-12 h-12 ${darkMode ? 'text-purple-400' : 'text-purple-500'}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                </div>
                <h2 className={`text-2xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  {t.welcome}
                </h2>
                <p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                  {t.searchPlaceholder}
                </p>
              </div>
            )}
          </div>
        )}

        {/* Chat Tab */}
        {activeTab === 'chat' && (
          <div className={`h-[600px] rounded-3xl overflow-hidden backdrop-blur-xl flex flex-col ${
            darkMode ? 'bg-white/5 border border-white/10' : 'bg-white/70 border border-gray-200'
          }`}>
            {/* Chat Header */}
            <div className={`p-4 border-b ${darkMode ? 'border-white/10' : 'border-gray-200'}`}>
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center">
                  <span className="text-lg">ğŸ¤–</span>
                </div>
                <div>
                  <h3 className={`font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Findly Sage AI</h3>
                  <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.tagline}</p>
                </div>
              </div>
            </div>

            {/* Chat Messages */}
            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {chatMessages.length === 0 && (
                <div className="text-center py-10">
                  <div className="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-violet-500/20 to-purple-500/20 flex items-center justify-center">
                    <span className="text-4xl">ğŸ›’</span>
                  </div>
                  <p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                    {language === 'ar' ? 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªØ³ÙˆÙ‚.' : "Hello! I'm your smart shopping assistant."}
                  </p>
                </div>
              )}
              {chatMessages.map((msg, index) => (
                <div
                  key={index}
                  className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div className={`max-w-[80%] p-4 rounded-2xl ${
                    msg.role === 'user'
                      ? 'bg-gradient-to-r from-violet-500 to-purple-500 text-white rounded-br-sm'
                      : darkMode ? 'bg-white/10 text-white rounded-bl-sm' : 'bg-gray-100 text-gray-800 rounded-bl-sm'
                  }`}>
                    <p className="text-sm whitespace-pre-wrap">{msg.content}</p>
                  </div>
                </div>
              ))}
              {isChatLoading && (
                <div className="flex justify-start">
                  <div className={`p-4 rounded-2xl ${darkMode ? 'bg-white/10' : 'bg-gray-100'}`}>
                    <div className="flex gap-1">
                      <div className="w-2 h-2 rounded-full bg-purple-500 animate-bounce" style={{animationDelay: '0ms'}} />
                      <div className="w-2 h-2 rounded-full bg-purple-500 animate-bounce" style={{animationDelay: '150ms'}} />
                      <div className="w-2 h-2 rounded-full bg-purple-500 animate-bounce" style={{animationDelay: '300ms'}} />
                    </div>
                  </div>
                </div>
              )}
              <div ref={chatEndRef} />
            </div>

            {/* Chat Input */}
            <div className={`p-4 border-t ${darkMode ? 'border-white/10' : 'border-gray-200'}`}>
              <div className="flex gap-3">
                <input
                  type="text"
                  value={chatInput}
                  onChange={(e) => setChatInput(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && handleChat()}
                  placeholder={t.typeMessage}
                  className={`flex-1 px-4 py-3 rounded-xl outline-none transition-all duration-300 ${
                    darkMode 
                      ? 'bg-white/10 text-white placeholder-gray-400 border border-white/10 focus:border-purple-500' 
                      : 'bg-gray-100 text-gray-800 placeholder-gray-400 border border-transparent focus:border-purple-500'
                  }`}
                  dir={isRTL ? 'rtl' : 'ltr'}
                />
                <button
                  onClick={handleChat}
                  disabled={isChatLoading || !chatInput.trim()}
                  className="px-5 py-3 bg-gradient-to-r from-violet-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-purple-500/25 hover:shadow-purple-500/40 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Watchlist Tab */}
        {activeTab === 'watchlist' && (
          <div className="space-y-6">
            {watchlist.length === 0 ? (
              <div className="text-center py-20">
                <div className="w-24 h-24 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-rose-500/20 to-pink-500/20 flex items-center justify-center">
                  <svg className={`w-12 h-12 ${darkMode ? 'text-rose-400' : 'text-rose-500'}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                </div>
                <h2 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  {language === 'ar' ? 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ©' : 'Your watchlist is empty'}
                </h2>
                <p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                  {language === 'ar' ? 'Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'Add products to track'}
                </p>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {watchlist.map((item) => (
                  <div
                    key={item.id}
                    className={`p-4 rounded-2xl flex gap-4 ${
                      darkMode ? 'bg-white/5 border border-white/10' : 'bg-white border border-gray-200 shadow-lg'
                    }`}
                  >
                    <img src={item.image} alt={item.title} className="w-20 h-20 rounded-xl object-cover" />
                    <div className="flex-1 min-w-0">
                      <h3 className={`font-medium mb-1 truncate ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                        {item.title}
                      </h3>
                      <p className="text-emerald-400 font-bold">${item.currentPrice}</p>
                      <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                        {language === 'ar' ? `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: $${item.targetPrice.toFixed(2)}` : `Target: $${item.targetPrice.toFixed(2)}`}
                      </p>
                    </div>
                    <button
                      onClick={() => removeFromWatchlist(item.id)}
                      className="self-start p-2 rounded-lg text-red-400 hover:bg-red-500/10 transition-colors"
                    >
                      <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                    </button>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* Coupons Tab */}
        {activeTab === 'coupons' && (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {coupons.map((coupon) => (
              <div
                key={coupon.id}
                className={`p-5 rounded-2xl ${
                  darkMode ? 'bg-white/5 border border-white/10' : 'bg-white border border-gray-200 shadow-lg'
                }`}
              >
                <div className="flex items-center justify-between mb-3">
                  <span className="px-3 py-1 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white text-sm font-bold rounded-full">
                    {coupon.discount}
                  </span>
                  <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{coupon.store}</span>
                </div>
                <p className={`mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>{coupon.description}</p>
                <div className={`flex items-center justify-between p-3 rounded-xl ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                  <code className={`font-mono font-bold ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>{coupon.code}</code>
                  <button
                    onClick={() => copyCouponCode(coupon.code)}
                    className="text-sm text-purple-400 hover:text-purple-300 transition-colors"
                  >
                    {t.copyCode}
                  </button>
                </div>
                <p className={`text-xs mt-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                  {language === 'ar' ? `ÙŠÙ†ØªÙ‡ÙŠ: ${coupon.expiresAt}` : `Expires: ${coupon.expiresAt}`}
                </p>
              </div>
            ))}
          </div>
        )}
      </main>

      {/* Login Modal */}
      {showLoginModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
          <div className={`w-full max-w-md p-6 rounded-3xl relative ${
            darkMode ? 'bg-slate-900 border border-white/10' : 'bg-white border border-gray-200 shadow-2xl'
          }`}>
            <div className="text-center mb-6">
              <div className="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center">
                <svg className="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
              <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                {isSignUp ? t.signUp : t.login}
              </h2>
            </div>

            <div className="space-y-4">
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  {t.email}
                </label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className={`w-full px-4 py-3 rounded-xl outline-none transition-all ${
                    darkMode 
                      ? 'bg-white/10 text-white border border-white/10 focus:border-purple-500' 
                      : 'bg-gray-100 text-gray-800 border border-transparent focus:border-purple-500'
                  }`}
                  dir="ltr"
                />
              </div>
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                  {t.password}
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className={`w-full px-4 py-3 rounded-xl outline-none transition-all ${
                    darkMode 
                      ? 'bg-white/10 text-white border border-white/10 focus:border-purple-500' 
                      : 'bg-gray-100 text-gray-800 border border-transparent focus:border-purple-500'
                  }`}
                  dir="ltr"
                />
              </div>

              <button
                onClick={handleLogin}
                className="w-full py-3 bg-gradient-to-r from-violet-500 to-purple-500 text-white font-medium rounded-xl shadow-lg shadow-purple-500/25 hover:shadow-purple-500/40 transition-all"
              >
                {isSignUp ? t.signUp : t.login}
              </button>

              <div className="relative my-6">
                <div className={`absolute inset-0 flex items-center ${darkMode ? 'text-gray-600' : 'text-gray-300'}`}>
                  <div className="w-full border-t"></div>
                </div>
                <div className="relative flex justify-center text-sm">
                  <span className={`px-4 ${darkMode ? 'bg-slate-900 text-gray-400' : 'bg-white text-gray-500'}`}>
                    {t.orContinueWith}
                  </span>
                </div>
              </div>

              <button
                onClick={handleGoogleLogin}
                className={`w-full py-3 rounded-xl font-medium flex items-center justify-center gap-3 transition-all ${
                  darkMode ? 'bg-white/10 text-white hover:bg-white/20' : 'bg-gray-100 text-gray-800 hover:bg-gray-200'
                }`}
              >
                <svg className="w-5 h-5" viewBox="0 0 24 24">
                  <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                  <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                  <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                  <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                {t.google}
              </button>

              <p className={`text-center text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                {t.noAccount}{' '}
                <button onClick={() => setIsSignUp(!isSignUp)} className="text-purple-400 hover:text-purple-300 font-medium">
                  {t.signUp}
                </button>
              </p>
            </div>

            <button
              onClick={() => setShowLoginModal(false)}
              className={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'} p-2 rounded-lg transition-colors ${
                darkMode ? 'hover:bg-white/10 text-gray-400' : 'hover:bg-gray-100 text-gray-500'
              }`}
            >
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      )}

      {/* Settings Modal */}
      {showSettingsModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
          <div className={`w-full max-w-md p-6 rounded-3xl relative ${
            darkMode ? 'bg-slate-900 border border-white/10' : 'bg-white border border-gray-200 shadow-2xl'
          }`}>
            <h2 className={`text-xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
              {t.settings}
            </h2>

            <div className="space-y-4">
              {/* Dark Mode Toggle */}
              <div className={`flex items-center justify-between p-4 rounded-xl ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <span className={darkMode ? 'text-white' : 'text-gray-800'}>{t.darkMode}</span>
                <button
                  onClick={() => setDarkMode(!darkMode)}
                  className={`w-14 h-7 rounded-full transition-colors ${darkMode ? 'bg-purple-500' : 'bg-gray-300'}`}
                >
                  <div className={`w-5 h-5 rounded-full bg-white shadow-md transition-transform ${darkMode ? 'translate-x-8' : 'translate-x-1'}`} />
                </button>
              </div>

              {/* Language Selector */}
              <div className={`p-4 rounded-xl ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <span className={`block mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>{t.language}</span>
                <div className="grid grid-cols-2 gap-2">
                  {languages.map((lang) => (
                    <button
                      key={lang.code}
                      onClick={() => setLanguage(lang.code)}
                      className={`px-3 py-2 rounded-xl text-sm font-medium transition-all ${
                        language === lang.code
                          ? 'bg-gradient-to-r from-violet-500 to-purple-500 text-white'
                          : darkMode ? 'bg-white/10 text-gray-300 hover:bg-white/20' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                      }`}
                    >
                      {lang.flag} {lang.name}
                    </button>
                  ))}
                </div>
              </div>

              {/* Pro Upgrade */}
              {!user?.isPro && (
                <button
                  onClick={() => {
                    setShowSettingsModal(false)
                    setShowProModal(true)
                  }}
                  className="w-full p-4 rounded-xl bg-gradient-to-r from-amber-500 to-orange-500 text-white font-medium"
                >
                  â­ {t.upgradeToPro}
                </button>
              )}
            </div>

            <button
              onClick={() => setShowSettingsModal(false)}
              className={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'} p-2 rounded-lg transition-colors ${
                darkMode ? 'hover:bg-white/10 text-gray-400' : 'hover:bg-gray-100 text-gray-500'
              }`}
            >
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      )}

      {/* Analysis Modal */}
      {showAnalysisModal && selectedProduct && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
          <div className={`w-full max-w-lg p-6 rounded-3xl relative ${
            darkMode ? 'bg-slate-900 border border-white/10' : 'bg-white border border-gray-200 shadow-2xl'
          }`}>
            <h2 className={`text-xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
              {t.priceAnalysis}
            </h2>

            <div className="flex gap-4 mb-6">
              <img src={selectedProduct.image} alt="" className="w-24 h-24 rounded-xl object-cover" />
              <div>
                <h3 className={`font-medium mb-1 ${darkMode ? 'text-white' : 'text-gray-800'}`}>{selectedProduct.title}</h3>
                <p className="text-2xl font-bold text-emerald-400">{selectedProduct.price}</p>
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4 mb-6">
              <div className={`p-4 rounded-xl text-center ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <p className={`text-sm mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.valueScore}</p>
                <p className="text-3xl font-bold text-emerald-400">{analysisData.valueScore}%</p>
              </div>
              <div className={`p-4 rounded-xl text-center ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <p className={`text-sm mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.trustScore}</p>
                <p className="text-3xl font-bold text-cyan-400">{analysisData.trustScore}%</p>
              </div>
            </div>

            <div className={`p-4 rounded-xl mb-6 ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
              <p className={`text-sm mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.forecast}</p>
              <div className="flex items-center gap-3">
                {analysisData.priceForecast === 'dropping' && (
                  <svg className="w-6 h-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                  </svg>
                )}
                {analysisData.priceForecast === 'rising' && (
                  <svg className="w-6 h-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                )}
                {analysisData.priceForecast === 'stable' && (
                  <svg className="w-6 h-6 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 12h14" />
                  </svg>
                )}
                <span className={`font-medium ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  {analysisData.priceForecast === 'dropping' 
                    ? (language === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù†Ø®ÙØ§Ø¶' : 'Price dropping')
                    : analysisData.priceForecast === 'rising'
                    ? (language === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ø±ØªÙØ§Ø¹' : 'Price rising')
                    : (language === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø± Ù…Ø³ØªÙ‚Ø±' : 'Price stable')}
                </span>
              </div>
            </div>

            <div className={`p-6 rounded-xl text-center ${
              analysisData.verdict === 'buy' 
                ? 'bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30'
                : analysisData.verdict === 'wait'
                ? 'bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30'
                : 'bg-gradient-to-r from-red-500/20 to-rose-500/20 border border-red-500/30'
            }`}>
              <p className={`text-sm mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.verdict}</p>
              <p className={`text-3xl font-bold ${getVerdictColor(analysisData.verdict)}`}>
                {getVerdictText(analysisData.verdict)}
              </p>
            </div>

            <button
              onClick={() => setShowAnalysisModal(false)}
              className={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'} p-2 rounded-lg transition-colors ${
                darkMode ? 'hover:bg-white/10 text-gray-400' : 'hover:bg-gray-100 text-gray-500'
              }`}
            >
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      )}

      {/* Affiliate Modal */}
      {showAffiliateModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
          <div className={`w-full max-w-md p-6 rounded-3xl relative ${
            darkMode ? 'bg-slate-900 border border-white/10' : 'bg-white border border-gray-200 shadow-2xl'
          }`}>
            <h2 className={`text-xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
              {t.affiliateTitle}
            </h2>

            <p className={`mb-6 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
              {t.affiliateDesc}
            </p>

            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className={`p-4 rounded-xl text-center ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <p className={`text-sm mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.yourEarnings}</p>
                <p className="text-2xl font-bold text-emerald-400">${affiliateStats.earnings.toFixed(2)}</p>
              </div>
              <div className={`p-4 rounded-xl text-center ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <p className={`text-sm mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.totalClicks}</p>
                <p className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{affiliateStats.clicks}</p>
              </div>
              <div className={`p-4 rounded-xl text-center ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <p className={`text-sm mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.conversions}</p>
                <p className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{affiliateStats.conversions}</p>
              </div>
            </div>

            {affiliateLink ? (
              <div className={`p-4 rounded-xl ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                <p className={`text-sm mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{t.affiliateLink}</p>
                <div className="flex items-center gap-2">
                  <code className={`flex-1 text-sm truncate ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>
                    {affiliateLink}
                  </code>
                  <button
                    onClick={() => navigator.clipboard.writeText(affiliateLink)}
                    className="px-3 py-1.5 bg-purple-500 text-white text-sm rounded-lg"
                  >
                    {t.copyCode}
                  </button>
                </div>
              </div>
            ) : (
              <button
                onClick={generateAffiliateLink}
                className="w-full py-3 bg-gradient-to-r from-violet-500 to-purple-500 text-white font-medium rounded-xl"
              >
                {t.generateLink}
              </button>
            )}

            <button
              onClick={() => setShowAffiliateModal(false)}
              className={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'} p-2 rounded-lg transition-colors ${
                darkMode ? 'hover:bg-white/10 text-gray-400' : 'hover:bg-gray-100 text-gray-500'
              }`}
            >
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      )}

      {/* Pro Modal */}
      {showProModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
          <div className={`w-full max-w-md p-6 rounded-3xl relative overflow-hidden ${
            darkMode ? 'bg-slate-900 border border-white/10' : 'bg-white border border-gray-200 shadow-2xl'
          }`}>
            <div className="absolute top-0 left-0 right-0 h-32 bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 opacity-20" />
            
            <div className="relative">
              <div className="text-center mb-6">
                <div className="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg shadow-orange-500/25">
                  <span className="text-3xl">â­</span>
                </div>
                <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  {t.upgradeToPro}
                </h2>
              </div>

              <div className="space-y-3 mb-6">
                {[
                  { icon: 'ğŸ”', text: t.unlimitedSearches },
                  { icon: 'ğŸ“Š', text: t.advancedAnalysis },
                  { icon: 'ğŸ””', text: t.priceAlerts },
                  { icon: 'ğŸš€', text: t.prioritySupport },
                  { icon: 'ğŸš«', text: t.noAds }
                ].map((feature, i) => (
                  <div key={i} className={`flex items-center gap-3 p-3 rounded-xl ${darkMode ? 'bg-white/5' : 'bg-gray-50'}`}>
                    <span className="text-xl">{feature.icon}</span>
                    <span className={darkMode ? 'text-white' : 'text-gray-800'}>{feature.text}</span>
                  </div>
                ))}
              </div>

              <button className="w-full py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl shadow-lg shadow-orange-500/25 hover:shadow-orange-500/40 transition-all">
                {language === 'ar' ? 'ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¢Ù† - $9.99/Ø´Ù‡Ø±' : 'Upgrade Now - $9.99/month'}
              </button>

              <button
                onClick={() => setShowProModal(false)}
                className={`w-full mt-3 py-3 rounded-xl font-medium transition-colors ${
                  darkMode ? 'text-gray-400 hover:bg-white/5' : 'text-gray-500 hover:bg-gray-50'
                }`}
              >
                {language === 'ar' ? 'Ø±Ø¨Ù…Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹' : 'Maybe later'}
              </button>
            </div>

            <button
              onClick={() => setShowProModal(false)}
              className={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'} p-2 rounded-lg transition-colors ${
                darkMode ? 'hover:bg-white/10 text-gray-400' : 'hover:bg-gray-100 text-gray-500'
              }`}
            >
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      )}

      {/* Footer */}
      <footer className={`relative mt-20 py-8 border-t ${darkMode ? 'border-white/10' : 'border-gray-200'}`}>
        <div className="max-w-7xl mx-auto px-4">
          <div className="flex flex-col md:flex-row items-center justify-between gap-4">
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center">
                <svg className="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>
              <span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Findly Sage</span>
            </div>

            <div className="flex items-center gap-6">
              <a href="#" className={`text-sm hover:text-purple-400 transition-colors ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                {t.privacy}
              </a>
              <a href="#" className={`text-sm hover:text-purple-400 transition-colors ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                {t.terms}
              </a>
              <a href="#" className={`text-sm hover:text-purple-400 transition-colors ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                {t.about}
              </a>
            </div>

            <p className={`text-sm ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
              Â© 2025 Findly Sage. All rights reserved.
            </p>
          </div>
        </div>
      </footer>
    </div>
  )
}
