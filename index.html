<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Findly AI | Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --p: #7c3aed; --s: #4f46e5; }
        body { font-family: 'Cairo', sans-serif; transition: 0.3s; overflow-x: hidden; }
        body.dark-mode { background: #0f172a; color: #f1f5f9; --card: rgba(30,41,59,0.7); }
        .hero-gradient { background: linear-gradient(135deg, var(--s) 0%, var(--p) 100%); }
        .glass { background: var(--card); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .interest-chip.selected { background: var(--p); color: white; border-color: var(--p); }
        .hidden { display: none !important; }
        /* Smooth Fade In */
        .view-fade { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .ai-badge { background: linear-gradient(90deg, #f59e0b, #fbbf24); color: #000; font-weight: 800; font-size: 10px; padding: 2px 8px; border-radius: 6px; }
    </style>
</head>
<body class="dark-mode">

<section id="view-auth" class="min-h-screen flex items-center justify-center p-6 view-fade">
    <div class="glass p-8 rounded-[2.5rem] w-full max-w-md shadow-2xl border border-purple-500/20">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-black text-white tracking-tighter">Findly<span class="text-yellow-400">.</span></h1>
            <p class="text-gray-400 text-sm mt-2" id="auth-subtitle">Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø¹ÙŠ</p>
        </div>
        <div id="auth-error" class="hidden mb-4 p-3 rounded-xl bg-red-500/20 text-red-400 text-xs text-center"></div>
        <form id="auth-form" class="space-y-4">
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 text-white outline-none focus:border-purple-500 transition">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 text-white outline-none focus:border-purple-500 transition">
            <div id="interests-box" class="hidden space-y-3 pt-2">
                <p class="text-xs font-bold text-purple-400">Ù…Ø§ Ù‡ÙŠ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ø§Ù„ØªÙ‚Ù†ÙŠØ©ØŸ</p>
                <div class="flex flex-wrap gap-2">
                    <button type="button" class="interest-chip px-3 py-1 rounded-full text-xs border border-white/10" onclick="handleInterest(this, 'Ù‡ÙˆØ§ØªÙ')">ğŸ“± Ù‡ÙˆØ§ØªÙ</button>
                    <button type="button" class="interest-chip px-3 py-1 rounded-full text-xs border border-white/10" onclick="handleInterest(this, 'Ø³Ù…Ø§Ø¹Ø§Øª')">ğŸ§ Ø³Ù…Ø§Ø¹Ø§Øª</button>
                    <button type="button" class="interest-chip px-3 py-1 rounded-full text-xs border border-white/10" onclick="handleInterest(this, 'Ø³Ø§Ø¹Ø§Øª')">âŒš Ø³Ø§Ø¹Ø§Øª</button>
                    <button type="button" class="interest-chip px-3 py-1 rounded-full text-xs border border-white/10" onclick="handleInterest(this, 'Ø­ÙˆØ§Ø³ÙŠØ¨')">ğŸ’» Ø­ÙˆØ§Ø³ÙŠØ¨</button>
                </div>
            </div>
            <button type="submit" id="submit-btn" class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold shadow-lg hover:bg-purple-700 transition active:scale-95">Ø¯Ø®ÙˆÙ„</button>
        </form>
        <button onclick="toggleAuthMode()" id="switch-mode-btn" class="w-full mt-6 text-sm text-gray-400 hover:text-purple-400 transition">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
    </div>
</section>

<section id="view-app" class="hidden min-h-screen view-fade">
    <header class="hero-gradient text-white pb-28 pt-8 rounded-b-[3.5rem] shadow-2xl">
        <div class="max-w-6xl mx-auto px-6">
            <nav class="flex justify-between items-center mb-12">
                <div class="text-3xl font-black">Findly<span class="text-yellow-400">.</span></div>
                <div class="flex items-center gap-3">
                    <button onclick="switchView('view-profile')" class="bg-white/10 px-4 py-2 rounded-xl text-sm font-bold hover:bg-white/20 transition">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</button>
                    <button onclick="toggleTheme()" class="bg-white/10 p-2 rounded-xl">ğŸŒ™</button>
                </div>
            </nav>
            <div class="text-center max-w-2xl mx-auto">
                <span class="bg-white/10 text-yellow-300 text-[10px] px-3 py-1 rounded-full font-bold uppercase tracking-widest">Powered by AI</span>
                <h1 class="text-4xl font-extrabold mb-8 mt-2">Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« Ø§Ù„ÙŠÙˆÙ…ØŸ</h1>
                <div class="relative bg-white p-2 rounded-[2.5rem] flex items-center shadow-2xl transition-focus-within ring-4 ring-purple-500/20">
                    <input id="search-input" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§..." class="w-full py-3 px-6 text-gray-900 outline-none text-lg">
                    <button onclick="performAISearch()" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-[1.8rem] font-bold shadow-lg transition active:scale-95">Ø¨Ø­Ø« Ø°ÙƒÙŠ</button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 -mt-16 relative z-10">
        <div id="cats-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-16"></div>
        
        <div id="ai-status" class="hidden mb-6 text-center animate-pulse text-purple-400 font-bold"></div>
        <div id="results-header" class="hidden mb-6 p-4 glass rounded-2xl border-l-4 border-yellow-400">
            <p class="text-sm italic" id="ai-intro"></p>
        </div>
        <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </main>
</section>

<section id="view-profile" class="hidden min-h-screen p-6 view-fade">
    <div class="max-w-xl mx-auto glass p-8 rounded-[3rem] shadow-2xl text-center">
        <button onclick="switchView('view-app')" class="mb-8 text-purple-400 font-bold flex items-center gap-2 mx-auto">â† Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø­Ø«</button>
        <div class="w-24 h-24 bg-gradient-to-tr from-purple-600 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl shadow-xl">ğŸ‘¤</div>
        <h2 class="text-3xl font-black mb-1" id="profile-email">â€”</h2>
        <p class="text-xs text-gray-500 mb-8 uppercase tracking-widest">Ø¹Ø¶Ùˆ Ù…ØªÙ…ÙŠØ² ÙÙŠ Findly</p>
        
        <div class="bg-white/5 rounded-3xl p-6 text-right mb-8">
            <h3 class="font-bold text-yellow-400 mb-4 flex items-center gap-2">â­ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
            <div id="profile-interests" class="flex flex-wrap gap-2"></div>
        </div>

        <button onclick="handleLogout()" class="w-full py-4 bg-red-500/10 text-red-500 rounded-2xl font-bold border border-red-500/20 hover:bg-red-500 hover:text-white transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
</section>

<script>
// --- Configuration & Constants ---
const API_URL = "https://findly-api.onrender.com";
let isLoginMode = true;
let userInterests = [];
let userData = null;

// --- View Manager (SPA Logic) ---
function switchView(viewId) {
    document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
    document.getElementById(viewId).classList.remove('hidden');
    window.scrollTo(0, 0);
}

// --- Auth Engine ---
function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    document.getElementById('auth-subtitle').innerText = isLoginMode ? "Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø¹ÙŠ" : "Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ ÙˆØ®ØµØµ ØªØ¬Ø±Ø¨ØªÙƒ";
    document.getElementById('interests-box').classList.toggle('hidden', isLoginMode);
    document.getElementById('submit-btn').innerText = isLoginMode ? "Ø¯Ø®ÙˆÙ„" : "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨";
    document.getElementById('switch-mode-btn').innerText = isLoginMode ? "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯" : "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ";
}

function handleInterest(btn, val) {
    btn.classList.toggle('selected');
    if (userInterests.includes(val)) userInterests = userInterests.filter(i => i !== val);
    else userInterests.push(val);
}

document.getElementById('auth-form').onsubmit = async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const path = isLoginMode ? '/login' : '/register';
    const body = isLoginMode ? { email, password } : { email, password, interests: userInterests };

    try {
        const res = await fetch(`${API_URL}${path}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const data = await res.json();
        if (res.ok) {
            if (isLoginMode) {
                localStorage.setItem('f_token', data.token);
                loadUserData();
            } else {
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.");
                toggleAuthMode();
            }
        } else { showError(data.message); }
    } catch { showError("Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹."); }
};

async function loadUserData() {
    const token = localStorage.getItem('f_token');
    if (!token) { switchView('view-auth'); return; }
    try {
        const res = await fetch(`${API_URL}/me`, { headers: { 'Authorization': `Bearer ${token}` } });
        if (res.ok) {
            userData = await res.json();
            document.getElementById('profile-email').innerText = userData.email;
            document.getElementById('profile-interests').innerHTML = userData.interests.map(i => 
                `<span class="bg-purple-500/20 text-purple-300 px-3 py-1 rounded-lg text-xs font-bold border border-purple-500/10">${i}</span>`
            ).join('');
            switchView('view-app');
            initAppContent();
        } else { handleLogout(); }
    } catch { switchView('view-app'); initAppContent(); }
}

function handleLogout() { localStorage.removeItem('f_token'); location.reload(); }
function showError(msg) { const err = document.getElementById('auth-error'); err.innerText = msg; err.classList.remove('hidden'); }

// --- AI Search Engine ---
function initAppContent() {
    const cats = ["ğŸ“± Ù‡ÙˆØ§ØªÙ", "ğŸ§ Ø³Ù…Ø§Ø¹Ø§Øª", "âŒš Ø³Ø§Ø¹Ø§Øª", "ğŸ’» Ø­ÙˆØ§Ø³ÙŠØ¨"];
    document.getElementById('cats-container').innerHTML = cats.map(c => `
        <button onclick="quickSearch('${c.split(' ')[1]}')" class="glass p-5 rounded-3xl text-center font-bold hover:bg-purple-600 hover:text-white transition group">
            <div class="text-2xl mb-1 group-hover:scale-125 transition">${c.split(' ')[0]}</div>
            <div class="text-xs opacity-80">${c.split(' ')[1]}</div>
        </button>`).join('');
}

async function performAISearch() {
    const q = document.getElementById('search-input').value.trim();
    if (!q) return;

    const status = document.getElementById('ai-status');
    const grid = document.getElementById('results-grid');
    const header = document.getElementById('results-header');

    status.innerText = "âœ¨ Findly AI ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ù„ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…ØªØ§Ø­Ø©...";
    status.classList.remove('hidden');
    grid.innerHTML = "";
    header.classList.add('hidden');

    try {
        const res = await fetch(`${API_URL}/search?q=${q}`);
        const data = await res.json();
        status.classList.add('hidden');

        if (!data.top || data.top.length === 0) {
            grid.innerHTML = `<div class="col-span-full text-center p-12 glass rounded-3xl">Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø°ÙƒØ§Ø¡ Findly Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø§ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø¨Ø³Ø·.</div>`;
            return;
        }

        // Ø¥Ø¨Ø±Ø§Ø² Ø°ÙƒØ§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        header.classList.remove('hidden');
        document.getElementById('ai-intro').innerText = `Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙØ¶ÙŠÙ„Ø§ØªÙƒ ÙÙŠ ${userData?.interests.join(' Ùˆ ') || 'Ø§Ù„ØªØ³ÙˆÙ‚'}ØŒ Ù‚Ù…Ù†Ø§ Ø¨ØªØ­Ù„ÙŠÙ„ 24 Ù…ÙˆÙ‚Ø¹Ø§Ù‹ ÙˆÙˆØ¬Ø¯Ù†Ø§ Ø£Ù† Ù‡Ø°Ù‡ Ù‡ÙŠ Ø£ÙØ¶Ù„ 6 Ø®ÙŠØ§Ø±Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø³Ø¹Ø±:`;

        data.top.forEach((p, index) => {
            const aiAnalysis = getAIAnalysis(p, index);
            grid.innerHTML += `
                <div class="glass p-5 rounded-[2.5rem] flex flex-col h-full border border-white/5 relative overflow-hidden group hover:border-purple-500/50 transition">
                    <div class="absolute top-4 right-4 z-10">${aiAnalysis.badge}</div>
                    <img src="${p.image}" class="w-full h-44 object-contain mb-4 bg-white/5 rounded-2xl group-hover:scale-105 transition">
                    <div class="mb-3">
                        <div class="flex items-center gap-1 text-yellow-400 text-xs mb-1">
                            ${'â­'.repeat(Math.round(p.rating || 4))} <span class="text-gray-500 ml-1">(${p.rating || '4.5'})</span>
                        </div>
                        <h3 class="font-bold text-sm leading-tight line-clamp-2">${p.name}</h3>
                    </div>
                    
                    <div class="bg-purple-500/10 p-3 rounded-2xl mb-4 text-[11px] border border-purple-500/10">
                        <p class="text-purple-300 font-bold mb-1 italic">ğŸ’¡ ØªØ­Ù„ÙŠÙ„ Findly:</p>
                        <p class="opacity-80">${aiAnalysis.reason}</p>
                    </div>

                    <div class="mt-auto flex justify-between items-center gap-2">
                        <div>
                            <p class="text-[10px] opacity-50 uppercase font-bold">ğŸ¥‡ Ø£ÙØ¶Ù„ Ø³Ø¹Ø±</p>
                            <span class="text-xl font-black text-purple-400">${p.price || 'â€”'}</span>
                        </div>
                        <button onclick="window.open('${p.link}', '_blank')" class="bg-purple-600 text-white px-6 py-3 rounded-xl text-xs font-bold hover:bg-purple-700 transition active:scale-95">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
                    </div>
                </div>`;
        });
    } catch { status.innerText = "âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø«."; }
}

// Ø¯Ø§Ù„Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªØ±Ø´ÙŠØ­
function getAIAnalysis(product, index) {
    const reasons = [
        "ØªÙ… ØªØ±Ø´ÙŠØ­Ù‡ ÙƒØ£ÙØ¶Ù„ Ù‚ÙŠÙ…Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø³Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡.",
        "Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±.",
        "ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ø¨Ø³Ø¨Ø¨ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØªÙˆÙØ± Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…Ø­Ù„ÙŠ.",
        "ØµÙÙ‚Ø© Ø°ÙƒÙŠØ©: Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ù‚Ù„ Ø¨Ù€ 15% Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù….",
        "Ù…ÙˆØµÙ‰ Ø¨Ù‡ Ù„Ùƒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ø¨Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©.",
        "Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ ÙˆØ§Ù„Ø£Ø·ÙˆÙ„ Ø¹Ù…Ø±Ø§Ù‹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª."
    ];
    
    if (index === 0) return { badge: '<span class="ai-badge">ğŸ¥‡ Ø§Ø®ØªÙŠØ§Ø± Ø°ÙƒÙŠ</span>', reason: reasons[0] };
    if (index === 1) return { badge: '<span class="ai-badge">â­ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</span>', reason: reasons[1] };
    if (index === 2) return { badge: '<span class="ai-badge">ğŸ›¡ï¸ Ø¶Ù…Ø§Ù† Ù…ÙˆØ«ÙˆÙ‚</span>', reason: reasons[2] };
    
    return { badge: '', reason: reasons[Math.floor(Math.random() * reasons.length)] };
}

function quickSearch(v) { document.getElementById('search-input').value = v; performAISearch(); }
function toggleTheme() { document.body.classList.toggle('dark-mode'); document.body.classList.toggle('light-mode'); }

// Start logic
if (localStorage.getItem('f_token')) loadUserData();
else switchView('view-auth');

</script>
</body>
</html>
